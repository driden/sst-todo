"use strict";var Zs=Object.create;var gr=Object.defineProperty;var _s=Object.getOwnPropertyDescriptor;var ea=Object.getOwnPropertyNames;var ta=Object.getPrototypeOf,ra=Object.prototype.hasOwnProperty;var ia=(r,e,i)=>e in r?gr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i;var oa=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),on=(r,e)=>{for(var i in e)gr(r,i,{get:e[i],enumerable:!0})},Ln=(r,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of ea(e))!ra.call(r,a)&&a!==i&&gr(r,a,{get:()=>e[a],enumerable:!(n=_s(e,a))||n.enumerable});return r};var Rn=(r,e,i)=>(i=r!=null?Zs(ta(r)):{},Ln(e||!r||!r.__esModule?gr(i,"default",{value:r,enumerable:!0}):i,r)),na=r=>Ln(gr({},"__esModule",{value:!0}),r);var Kt=(r,e,i)=>(ia(r,typeof e!="symbol"?e+"":e,i),i),nn=(r,e,i)=>{if(!e.has(r))throw TypeError("Cannot "+i)};var t=(r,e,i)=>(nn(r,e,"read from private field"),i?i.call(r):e.get(r)),s=(r,e,i)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,i)},u=(r,e,i,n)=>(nn(r,e,"write to private field"),n?n.call(r,i):e.set(r,i),i);var h=(r,e,i)=>(nn(r,e,"access private method"),i);var Qn=oa((Ci,Fn)=>{(function(r,e){typeof Ci=="object"&&typeof Fn<"u"?e(Ci):typeof define=="function"&&define.amd?define(["exports"],e):e(r.ULID={})})(Ci,function(r){"use strict";function e(g){var T=new Error(g);return T.source="ulid",T}var i="0123456789ABCDEFGHJKMNPQRSTVWXYZ",n=i.length,a=Math.pow(2,48)-1,c=10,C=16;function B(g,T,I){return T>g.length-1?g:g.substr(0,T)+I+g.substr(T+1)}function Pe(g){for(var T=void 0,I=g.length,qe=void 0,Z=void 0,Mt=n-1;!T&&I-->=0;){if(qe=g[I],Z=i.indexOf(qe),Z===-1)throw e("incorrectly encoded string");if(Z===Mt){g=B(g,I,i[0]);continue}T=B(g,I,i[Z+1])}if(typeof T=="string")return T;throw e("cannot increment this string")}function xi(g){var T=Math.floor(g()*n);return T===n&&(T=n-1),i.charAt(T)}function vt(g,T){if(isNaN(g))throw new Error(g+" must be a number");if(g>a)throw e("cannot encode time greater than "+a);if(g<0)throw e("time must be positive");if(Number.isInteger(g)===!1)throw e("time must be an integer");for(var I=void 0,qe="";T>0;T--)I=g%n,qe=i.charAt(I)+qe,g=(g-I)/n;return qe}function xr(g,T){for(var I="";g>0;g--)I=xi(T)+I;return I}function gi(g){if(g.length!==c+C)throw e("malformed ulid");var T=g.substr(0,c).split("").reverse().reduce(function(I,qe,Z){var Mt=i.indexOf(qe);if(Mt===-1)throw e("invalid character found: "+qe);return I+=Mt*Math.pow(n,Z)},0);if(T>a)throw e("malformed ulid, timestamp too large");return T}function rn(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,T=arguments[1];T||(T=typeof window<"u"?window:null);var I=T&&(T.crypto||T.msCrypto);if(I)return function(){var Z=new Uint8Array(1);return I.getRandomValues(Z),Z[0]/255};try{var qe=require("crypto");return function(){return qe.randomBytes(1).readUInt8()/255}}catch{}if(g){try{console.error("secure crypto unusable, falling back to insecure Math.random()!")}catch{}return function(){return Math.random()}}throw e("secure crypto unusable, insecure Math.random not allowed")}function Bn(g){return g||(g=rn()),function(I){return isNaN(I)&&(I=Date.now()),vt(I,c)+xr(C,g)}}function $s(g){g||(g=rn());var T=0,I=void 0;return function(Z){if(isNaN(Z)&&(Z=Date.now()),Z<=T){var Mt=I=Pe(I);return vt(T,c)+Mt}T=Z;var Xs=I=xr(C,g);return vt(Z,c)+Xs}}var Ys=Bn();r.replaceCharAt=B,r.incrementBase32=Pe,r.randomChar=xi,r.encodeTime=vt,r.encodeRandom=xr,r.decodeTime=gi,r.detectPrng=rn,r.factory=Bn,r.monotonicFactory=$s,r.ulid=Ys,Object.defineProperty(r,"__esModule",{value:!0})})});var Ra={};on(Ra,{main:()=>La});module.exports=na(Ra);var Hs=Rn(Qn(),1);var wi={};on(wi,{Todo:()=>wi,create:()=>Da,list:()=>Ba});var wr={};on(wr,{DB:()=>Sa,SQL:()=>wr});var Gs=Rn(require("aws-sdk/clients/rdsdataservice"),1);function xe(r){return typeof r=="string"}function Vn(r){return typeof r=="number"}function bi(r){return typeof r=="boolean"}function vi(r){return r===null}function Pn(r){return r instanceof Date}function Un(r){return typeof r=="bigint"}function Ie(r){return typeof r=="function"}function Ue(r){return typeof r=="object"&&r!==null}function Ti(r){return r[r.length-1]}function o(r){return Object.freeze(r)}function ut(r){return Array.isArray(r)}function Cr(r){return r}var y=o({is(r){return r.kind==="IdentifierNode"},create(r){return o({kind:"IdentifierNode",identifier:r})}});var ae=o({is(r){return r.kind==="TableNode"},create(r){return o({kind:"TableNode",table:y.create(r)})},createWithSchema(r,e){return o({kind:"TableNode",schema:y.create(r),table:y.create(e)})}});var V=o({is(r){return r.kind==="AlterTableNode"},create(r){return o({kind:"AlterTableNode",table:ae.create(r)})},cloneWith(r,e){return o({...r,...e})}});var $e=o({is(r){return r.kind==="CreateIndexNode"},create(r){return o({kind:"CreateIndexNode",name:y.create(r)})},cloneWith(r,e){return o({...r,...e})}});var Wi=o({is(r){return r.kind==="CreateSchemaNode"},create(r,e){return o({kind:"CreateSchemaNode",schema:y.create(r),...e})},cloneWith(r,e){return o({...r,...e})}});var Ae=o({is(r){return r.kind==="CreateTableNode"},create(r){return o({kind:"CreateTableNode",table:r,columns:o([])})},cloneWithColumn(r,e){return o({...r,columns:o([...r.columns,e])})},cloneWithConstraint(r,e){return o({...r,constraints:r.constraints?o([...r.constraints,e]):o([e])})},cloneWith(r,e){return o({...r,...e})}});var br=o({is(r){return r.kind==="DropIndexNode"},create(r,e){return o({kind:"DropIndexNode",name:y.create(r),...e})},cloneWith(r,e){return o({...r,...e})}});var Oi=o({is(r){return r.kind==="DropSchemaNode"},create(r,e){return o({kind:"DropSchemaNode",schema:y.create(r),...e})},cloneWith(r,e){return o({...r,...e})}});var qi=o({is(r){return r.kind==="DropTableNode"},create(r,e){return o({kind:"DropTableNode",table:r,...e})},cloneWith(r,e){return o({...r,...e})}});var ze=o({is(r){return r.kind==="AliasNode"},create(r,e){return o({kind:"AliasNode",node:r,alias:e})}});function ge(r){return Ue(r)&&Ie(r.toOperationNode)}var Gt=o({is(r){return r.kind==="AndNode"},create(r,e){return o({kind:"AndNode",left:r,right:e})}});var jt=o({is(r){return r.kind==="OrNode"},create(r,e){return o({kind:"OrNode",left:r,right:e})}});var Ht=o({is(r){return r.kind==="OnNode"},create(r){return o({kind:"OnNode",on:r})},cloneWithFilter(r,e,i){return o({...r,on:e==="And"?Gt.create(r.on,i):jt.create(r.on,i)})}});var le=o({is(r){return r.kind==="JoinNode"},create(r,e){return o({kind:"JoinNode",joinType:r,table:e,on:void 0})},createWithOn(r,e,i){return o({kind:"JoinNode",joinType:r,table:e,on:Ht.create(i)})},cloneWithOn(r,e){return o({...r,on:r.on?Ht.cloneWithFilter(r.on,"And",e):Ht.create(e)})},cloneWithOrOn(r,e){return o({...r,on:r.on?Ht.cloneWithFilter(r.on,"Or",e):Ht.create(e)})}});var Tt=o({is(r){return r.kind==="FromNode"},create(r){return o({kind:"FromNode",froms:o(r)})},cloneWithFroms(r,e){return o({...r,froms:o([...r.froms,...e])})}});var sn=o({is(r){return r.kind==="GroupByNode"},create(r){return o({kind:"GroupByNode",items:o(r)})},cloneWithItems(r,e){return o({...r,items:o([...r.items,...e])})}});var vr=o({is(r){return r.kind==="HavingNode"},create(r){return o({kind:"HavingNode",having:r})},cloneWithFilter(r,e,i){return o({...r,having:e==="And"?Gt.create(r.having,i):jt.create(r.having,i)})}});var $t=o({is(r){return r.kind==="OrderByNode"},create(r){return o({kind:"OrderByNode",items:o([r])})},cloneWithItem(r,e){return o({...r,items:o([...r.items,e])})}});var W=o({is(r){return r.kind==="SelectQueryNode"},create(r,e){return o({kind:"SelectQueryNode",from:Tt.create(r),...e&&{with:e}})},cloneWithSelections(r,e){return o({...r,selections:r.selections?o([...r.selections,...e]):o(e)})},cloneWithDistinctOnSelections(r,e){return o({...r,distinctOnSelections:r.distinctOnSelections?o([...r.distinctOnSelections,...e]):o(e)})},cloneWithModifier(r,e){return o({...r,modifiers:r.modifiers?o([...r.modifiers,e]):o([e])})},cloneWithOrderByItem(r,e){return o({...r,orderBy:r.orderBy?$t.cloneWithItem(r.orderBy,e):$t.create(e)})},cloneWithGroupByItems(r,e){return o({...r,groupBy:r.groupBy?sn.cloneWithItems(r.groupBy,e):sn.create(e)})},cloneWithLimit(r,e){return o({...r,limit:e})},cloneWithOffset(r,e){return o({...r,offset:e})},cloneWithHaving(r,e){return o({...r,having:r.having?vr.cloneWithFilter(r.having,"And",e):vr.create(e)})},cloneWithOrHaving(r,e){return o({...r,having:r.having?vr.cloneWithFilter(r.having,"Or",e):vr.create(e)})},cloneWithDistinct(r){return o({...r,distinct:!0})},cloneWithUnion(r,e){return o({...r,union:r.union?o([...r.union,e]):o([e])})}});var Tr=o({is(r){return r.kind==="FilterNode"},create(r,e,i){return o({kind:"FilterNode",left:r,op:e,right:i})}});var E=o({is(r){return r.kind==="RawNode"},create(r,e){return o({kind:"RawNode",sqlFragments:o(r),parameters:o(e)})},createWithSql(r){return E.create([r],[])},createWithChild(r){return E.create(["",""],[r])},createWithChildren(r){return E.create(new Array(r.length+1).fill(""),r)}});var zn=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","ilike","not ilike","@>","<@","?","?","?&","!<","!>","<=>","!~","~","~*","!~*","exists","not exists","&&","||","@@","@@@","!!","<->"],an=o({is(r){return r.kind==="OperatorNode"},create(r){return o({kind:"OperatorNode",operator:r})}});var Ii=o({is(r){return r.kind==="ParensNode"},create(r){return o({kind:"ParensNode",node:r})}});var v=o({is(r){return r.kind==="ColumnNode"},create(r){return o({kind:"ColumnNode",column:y.create(r)})}});var Yt=o({is(r){return r.kind==="SelectAllNode"},create(){return o({kind:"SelectAllNode"})}});var Wt=o({is(r){return r.kind==="ReferenceNode"},create(r,e){return o({kind:"ReferenceNode",table:r,column:e})},createSelectAll(r){return o({kind:"ReferenceNode",table:ae.create(r),column:Yt.create()})}});var Xt,ki=class{constructor(e){s(this,Xt,void 0);u(this,Xt,e)}get dynamicReference(){return t(this,Xt)}get refType(){}toOperationNode(){return Ce(t(this,Xt))}};Xt=new WeakMap;function Ei(r){return Ue(r)&&ge(r)&&xe(r.dynamicReference)}function Jn(r){return ut(r)?r.map(e=>Ye(e)):[Ye(r)]}function Ye(r){return xe(r)?Ce(r):Ei(r)?r.toOperationNode():Zt(r)}function Ce(r){let e=".";if(r.includes(e)){let i=r.split(e).map(Kn);if(i.length===3)return sa(i);if(i.length===2)return aa(i);throw new Error(`invalid column reference ${r}`)}else return v.create(r)}function Mn(r){let e=" as ";if(r.includes(e)){let[i,n]=r.split(e).map(Kn);return ze.create(Ce(i),y.create(n))}else return Ce(r)}function Wr(r){return v.create(r)}function sa(r){let[e,i,n]=r;return Wt.create(ae.createWithSchema(e,i),v.create(n))}function aa(r){let[e,i]=r;return Wt.create(ae.create(e),v.create(i))}function Kn(r){return r.trim()}var Ai=o({is(r){return r.kind==="PrimitiveValueListNode"},create(r){return o({kind:"PrimitiveValueListNode",values:o([...r])})}});var Si=o({is(r){return r.kind==="ValueListNode"},create(r){return o({kind:"ValueListNode",values:o(r)})}});var ke=o({is(r){return r.kind==="ValueNode"},create(r){return o({kind:"ValueNode",value:r})},createImmediate(r){return o({kind:"ValueNode",value:r,immediate:!0})}});function un(r){return ut(r)?ua(r):Xe(r)}function Xe(r){return Or(r)?Zt(r):ke.create(r)}function ua(r){return r.some(Or)?Si.create(r.map(e=>Xe(e))):Ai.create(r)}function me(r){return ln("where",r)}function cn(r){return ln("having",r)}function hn(r){return ln("on",r)}function P(r,e,i){return Tr.create(Ye(r),mn(e),Ye(i))}function j(r){return Gn("exists",r)}function H(r){return Gn("not exists",r)}function ln(r,e){if(e.length===3)return da(e[0],e[1],e[2]);if(e.length===1)return ha(r,e[0]);throw jn(r,e)}function da(r,e,i){return(e==="is"||e==="is not")&&(vi(i)||bi(i))?ca(r,e,i):Tr.create(Ye(r),mn(e),un(i))}function ca(r,e,i){return Tr.create(Ye(r),mn(e),ke.createImmediate(i))}function mn(r){if(xe(r)&&zn.includes(r))return an.create(r);if(ge(r))return r.toOperationNode();throw new Error(`invalid comparison operator ${JSON.stringify(r)} passed to a filter method`)}function Gn(r,e){return Tr.create(void 0,an.create(r),un(e))}function ha(r,e){if(Ie(e))return la[r](e);if(ge(e)){let i=e.toOperationNode();if(E.is(i))return i}throw jn(r,e)}function jn(r,e){return new Error(`invalid arguments passed to a '${r}' method: ${JSON.stringify(e)}`)}var la=o({where(r){let i=r(dn()).toOperationNode();if(!i.where)throw new Error("no `where` methods called insided a group callback");return Ii.create(i.where.where)},having(r){let i=r(dn()).toOperationNode();if(!i.having)throw new Error("no `having` methods called insided a group callback");return Ii.create(i.having.having)},on(r){let i=r(Di("InnerJoin","table")).toOperationNode();if(!i.on)throw new Error("no `on` methods called insided a group callback");return Ii.create(i.on.on)}});function _(r,e){if(e.length===3)return pa(r,e[0],e[1],e[2]);if(e.length===2)return ma(r,e[0],e[1]);throw new Error("not implemented")}function ma(r,e,i){return i(Di(r,e)).toOperationNode()}function pa(r,e,i,n){return le.createWithOn(r,Ze(e),P(i,"=",n))}var _t=o({is(r){return r.kind==="SelectionNode"},create(r){return o({kind:"SelectionNode",selection:r})},createSelectAll(){return o({kind:"SelectionNode",selection:Yt.create()})},createSelectAllFromTable(r){return o({kind:"SelectionNode",selection:Wt.createSelectAll(r)})}});function _e(r){return ut(r)?r.map(e=>Hn(e)):[Hn(r)]}function Hn(r){return xe(r)?_t.create(Mn(r)):Ei(r)?_t.create(r.toOperationNode()):_t.create(Bi(r))}function dt(r){return r?Array.isArray(r)?r.map($n):[$n(r)]:[_t.createSelectAll()]}function $n(r){if(xe(r))return _t.createSelectAllFromTable(r);throw new Error(`invalid value selectAll expression: ${JSON.stringify(r)}`)}var be=o({is(r){return r.kind==="InsertQueryNode"},create(r,e){return o({kind:"InsertQueryNode",into:r,...e&&{with:e}})},cloneWith(r,e){return o({...r,...e})}});var Ot=o({is(r){return r.kind==="UpdateQueryNode"},create(r,e){return o({kind:"UpdateQueryNode",table:r,...e&&{with:e}})},cloneWithFromItems(r,e){return o({...r,from:r.from?Tt.cloneWithFroms(r.from,e):Tt.create(e)})},cloneWithUpdates(r,e){return o({...r,updates:r.updates?o([...r.updates,...e]):e})}});var qt=o({is(r){return r.kind==="DeleteQueryNode"},create(r,e){return o({kind:"DeleteQueryNode",from:Tt.create([r]),...e&&{with:e}})},cloneWithOrderByItem(r,e){return o({...r,orderBy:r.orderBy?$t.cloneWithItem(r.orderBy,e):$t.create(e)})},cloneWithLimit(r,e){return o({...r,limit:e})}});var pe=o({is(r){return r.kind==="WhereNode"},create(r){return o({kind:"WhereNode",where:r})},cloneWithFilter(r,e,i){return o({...r,where:e==="And"?Gt.create(r.where,i):jt.create(r.where,i)})}});var pn=o({is(r){return r.kind==="ReturningNode"},create(r){return o({kind:"ReturningNode",selections:o(r)})},cloneWithSelections(r,e){return o({...r,selections:r.selections?o([...r.selections,...e]):o(e)})}});var l=o({is(r){return qt.is(r)||be.is(r)||Ot.is(r)||W.is(r)},cloneWithWhere(r,e){return o({...r,where:r.where?pe.cloneWithFilter(r.where,"And",e):pe.create(e)})},cloneWithOrWhere(r,e){return o({...r,where:r.where?pe.cloneWithFilter(r.where,"Or",e):pe.create(e)})},cloneWithJoin(r,e){return o({...r,joins:r.joins?o([...r.joins,e]):o([e])})},cloneWithReturning(r,e){return o({...r,returning:r.returning?pn.cloneWithSelections(r.returning,e):pn.create(e)})}});var Yn=o({is(r){return r.kind==="OrderByItemNode"},create(r,e){return o({kind:"OrderByItemNode",orderBy:r,direction:e})}});function Li(r,e){return Yn.create(fa(r),Na(e))}function fa(r){return Ye(r)}function Na(r){if(!!r)return r==="asc"||r==="desc"?E.createWithSql(r):r.toOperationNode()}function f(r,e){Object.defineProperties(r.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var Ri=o({is(r){return r.kind==="LimitNode"},create(r){return o({kind:"LimitNode",limit:ke.create(r)})}});var Xn=o({is(r){return r.kind==="OffsetNode"},create(r){return o({kind:"OffsetNode",offset:ke.create(r)})}});var Zn=o({is(r){return r.kind==="GroupByItemNode"},create(r){return o({kind:"GroupByItemNode",groupBy:r})}});function _n(r){return Jn(r).map(Zn.create)}var Fi=o({is(r){return r.kind==="UnionNode"},create(r,e){return o({kind:"UnionNode",union:r,all:e})}});function fn(r,e){return Fi.create(r.toOperationNode(),e)}var Je=class extends Error{node;constructor(e){super("no result"),this.node=e}};var d,N=class{constructor(e){s(this,d,void 0);u(this,d,o(e))}where(...e){return new N({...t(this,d),queryNode:l.cloneWithWhere(t(this,d).queryNode,me(e))})}whereRef(e,i,n){return new N({...t(this,d),queryNode:l.cloneWithWhere(t(this,d).queryNode,P(e,i,n))})}orWhere(...e){return new N({...t(this,d),queryNode:l.cloneWithOrWhere(t(this,d).queryNode,me(e))})}orWhereRef(e,i,n){return new N({...t(this,d),queryNode:l.cloneWithOrWhere(t(this,d).queryNode,P(e,i,n))})}whereExists(e){return new N({...t(this,d),queryNode:l.cloneWithWhere(t(this,d).queryNode,j(e))})}whereNotExists(e){return new N({...t(this,d),queryNode:l.cloneWithWhere(t(this,d).queryNode,H(e))})}orWhereExists(e){return new N({...t(this,d),queryNode:l.cloneWithOrWhere(t(this,d).queryNode,j(e))})}orWhereNotExists(e){return new N({...t(this,d),queryNode:l.cloneWithOrWhere(t(this,d).queryNode,H(e))})}having(...e){return new N({...t(this,d),queryNode:W.cloneWithHaving(t(this,d).queryNode,cn(e))})}havingRef(e,i,n){return new N({...t(this,d),queryNode:W.cloneWithHaving(t(this,d).queryNode,P(e,i,n))})}orHaving(...e){return new N({...t(this,d),queryNode:W.cloneWithOrHaving(t(this,d).queryNode,cn(e))})}orHavingRef(e,i,n){return new N({...t(this,d),queryNode:W.cloneWithOrHaving(t(this,d).queryNode,P(e,i,n))})}havingExists(e){return new N({...t(this,d),queryNode:W.cloneWithHaving(t(this,d).queryNode,j(e))})}havingNotExist(e){return new N({...t(this,d),queryNode:W.cloneWithHaving(t(this,d).queryNode,H(e))})}orHavingExists(e){return new N({...t(this,d),queryNode:W.cloneWithOrHaving(t(this,d).queryNode,j(e))})}orHavingNotExists(e){return new N({...t(this,d),queryNode:W.cloneWithOrHaving(t(this,d).queryNode,H(e))})}select(e){return new N({...t(this,d),queryNode:W.cloneWithSelections(t(this,d).queryNode,_e(e))})}distinctOn(e){return new N({...t(this,d),queryNode:W.cloneWithDistinctOnSelections(t(this,d).queryNode,_e(e))})}distinct(){return new N({...t(this,d),queryNode:W.cloneWithDistinct(t(this,d).queryNode)})}forUpdate(){return new N({...t(this,d),queryNode:W.cloneWithModifier(t(this,d).queryNode,"ForUpdate")})}forShare(){return new N({...t(this,d),queryNode:W.cloneWithModifier(t(this,d).queryNode,"ForShare")})}forKeyShare(){return new N({...t(this,d),queryNode:W.cloneWithModifier(t(this,d).queryNode,"ForKeyShare")})}forNoKeyUpdate(){return new N({...t(this,d),queryNode:W.cloneWithModifier(t(this,d).queryNode,"ForNoKeyUpdate")})}skipLocked(){return new N({...t(this,d),queryNode:W.cloneWithModifier(t(this,d).queryNode,"SkipLocked")})}noWait(){return new N({...t(this,d),queryNode:W.cloneWithModifier(t(this,d).queryNode,"NoWait")})}selectAll(e){return new N({...t(this,d),queryNode:W.cloneWithSelections(t(this,d).queryNode,dt(e))})}innerJoin(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,_("InnerJoin",e))})}leftJoin(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,_("LeftJoin",e))})}rightJoin(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,_("RightJoin",e))})}fullJoin(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,_("FullJoin",e))})}innerJoinLateral(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,_("LateralInnerJoin",e))})}leftJoinLateral(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,_("LateralLeftJoin",e))})}orderBy(e,i){return new N({...t(this,d),queryNode:W.cloneWithOrderByItem(t(this,d).queryNode,Li(e,i))})}groupBy(e){return new N({...t(this,d),queryNode:W.cloneWithGroupByItems(t(this,d).queryNode,_n(e))})}limit(e){return new N({...t(this,d),queryNode:W.cloneWithLimit(t(this,d).queryNode,Ri.create(e))})}offset(e){return new N({...t(this,d),queryNode:W.cloneWithOffset(t(this,d).queryNode,Xn.create(e))})}union(e){return new N({...t(this,d),queryNode:W.cloneWithUnion(t(this,d).queryNode,fn(e,!1))})}unionAll(e){return new N({...t(this,d),queryNode:W.cloneWithUnion(t(this,d).queryNode,fn(e,!0))})}call(e){return e(this)}if(e,i){return e?i(this):new N({...t(this,d)})}as(e){return new Nn(this,e)}castTo(){return new N(t(this,d))}withPlugin(e){return new N({...t(this,d),executor:t(this,d).executor.withPlugin(e)})}toOperationNode(){return t(this,d).executor.transformQuery(t(this,d).queryNode,t(this,d).queryId)}compile(){return t(this,d).executor.compileQuery(this.toOperationNode(),t(this,d).queryId)}async execute(){let e=this.compile(),i=e.query;return(await t(this,d).executor.executeQuery(e,t(this,d).queryId)).rows}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Je){let i=await this.executeTakeFirst();if(i===void 0)throw new e(this.toOperationNode());return i}},et=N;d=new WeakMap;f(et,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var qr,er,Nn=class{constructor(e,i){s(this,qr,void 0);s(this,er,void 0);u(this,qr,e),u(this,er,i)}get alias(){return t(this,er)}toOperationNode(){let e=t(this,qr).toOperationNode();return ze.create(e,y.create(t(this,er)))}};qr=new WeakMap,er=new WeakMap;var Qi,tr=class{constructor(){Kt(this,"nodeStack",[]);s(this,Qi,o({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),FilterNode:this.transformFilter.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),UnionNode:this.transformUnion.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this)}));Kt(this,"transformNode",e=>{if(!e)return;this.nodeStack.push(e);let i=t(this,Qi)[e.kind](e);return this.nodeStack.pop(),o(i)})}transformNodeList(e){return e&&o(e.map(this.transformNode))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOnSelections:this.transformNodeList(e.distinctOnSelections),distinct:e.distinct,joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),modifiers:e.modifiers,limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),union:this.transformNodeList(e.union)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",schema:this.transformNode(e.schema),table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",table:this.transformNode(e.table),column:this.transformNode(e.column)}}transformFilter(e){return{kind:"FilterNode",left:this.transformNode(e.left),op:this.transformNode(e.op),right:this.transformNode(e.right)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:o([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated)}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),expression:this.transformNode(e.expression),unique:e.unique,using:this.transformNode(e.using)}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformUnion(e){return{kind:"UnionNode",union:this.transformNode(e.union),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema)}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),renameColumn:this.transformNode(e.renameColumn),addColumn:this.transformNode(e.addColumn),dropColumn:this.transformNode(e.dropColumn),alterColumn:this.transformNode(e.alterColumn),modifyColumn:this.transformNode(e.modifyColumn),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}};Qi=new WeakMap;var kr,It,fe,Ee,Pi,es,Ui,ts,zi,rs,kt,Ir,Ji,is,Vi=class extends tr{constructor(i){super();s(this,fe);s(this,Pi);s(this,Ui);s(this,zi);s(this,kt);s(this,Ji);s(this,kr,void 0);s(this,It,new Set);u(this,kr,i)}transformSelectQuery(i){return h(this,fe,Ee).call(this,i,n=>super.transformSelectQuery(n))}transformInsertQuery(i){return h(this,fe,Ee).call(this,i,n=>super.transformInsertQuery(n))}transformUpdateQuery(i){return h(this,fe,Ee).call(this,i,n=>super.transformUpdateQuery(n))}transformDeleteQuery(i){return h(this,fe,Ee).call(this,i,n=>super.transformDeleteQuery(n))}transformCreateTable(i){return h(this,fe,Ee).call(this,i,n=>super.transformCreateTable(n))}transformDropTable(i){return h(this,fe,Ee).call(this,i,n=>super.transformDropTable(n))}transformCreateIndex(i){return h(this,fe,Ee).call(this,i,n=>super.transformCreateIndex(n))}transformDropIndex(i){return h(this,fe,Ee).call(this,i,n=>super.transformDropIndex(n))}transformCreateView(i){return h(this,fe,Ee).call(this,i,n=>super.transformCreateView(n))}transformDropView(i){return h(this,fe,Ee).call(this,i,n=>super.transformDropView(n))}transformAlterTable(i){return h(this,fe,Ee).call(this,i,n=>super.transformAlterTable(n))}transformTable(i){let n=super.transformTable(i);return n.schema||!t(this,It).has(i.table.identifier)?n:{...n,schema:{kind:"IdentifierNode",identifier:t(this,kr)}}}};kr=new WeakMap,It=new WeakMap,fe=new WeakSet,Ee=function(i,n){let a=h(this,Pi,es).call(this,i);for(let C of a)t(this,It).add(C);let c=n(i);for(let C of a)t(this,It).delete(C);return c},Pi=new WeakSet,es=function(i){let n=new Set;return"from"in i&&i.from&&h(this,Ui,ts).call(this,i.from.froms,n),"into"in i&&i.into&&h(this,kt,Ir).call(this,i.into,n),"table"in i&&i.table&&h(this,kt,Ir).call(this,i.table,n),"joins"in i&&i.joins&&h(this,zi,rs).call(this,i.joins,n),"with"in i&&i.with&&h(this,Ji,is).call(this,i.with,n),n},Ui=new WeakSet,ts=function(i,n){for(let a of i)h(this,kt,Ir).call(this,a,n)},zi=new WeakSet,rs=function(i,n){for(let a of i)h(this,kt,Ir).call(this,a.table,n)},kt=new WeakSet,Ir=function(i,n){let a=ae.is(i)?i:ze.is(i)&&ae.is(i.node)?i.node:null;a&&!t(this,It).has(a.table.identifier)&&n.add(a.table.identifier)},Ji=new WeakSet,is=function(i,n){for(let a of i.expressions)n.delete(a.name.table.table.identifier)};var Er,Me=class{constructor(e){s(this,Er,void 0);u(this,Er,new Vi(e))}transformQuery(e){return t(this,Er).transformNode(e.node)}async transformResult(e){return e.result}};Er=new WeakMap;var os=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function ns(r){let e="";for(let i=0;i<r;++i)e+=ya();return e}function ya(){return os[~~(Math.random()*os.length)]}function q(){return new yn}var rr,yn=class{constructor(){s(this,rr,void 0)}get queryId(){return t(this,rr)===void 0&&u(this,rr,ns(8)),t(this,rr)}};rr=new WeakMap;var wa=o([]),Et,Mi,ss,ir=class{constructor(e=wa){s(this,Mi);s(this,Et,void 0);u(this,Et,e)}get plugins(){return t(this,Et)}transformQuery(e,i){for(let n of t(this,Et)){let a=n.transformQuery({node:e,queryId:i});if(a.kind===e.kind)e=a;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${a.kind}`].join(" "))}return e}async executeQuery(e,i){return await this.provideConnection(async n=>{let a=await n.executeQuery(e);return h(this,Mi,ss).call(this,a,i)})}};Et=new WeakMap,Mi=new WeakSet,ss=async function(e,i){for(let n of t(this,Et))e=await n.transformResult({result:e,queryId:i});return e};var ct=class extends ir{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new ct([...this.plugins,e])}withPlugins(e){return new ct([...this.plugins,...e])}withPluginAtFront(e){return new ct([e,...this.plugins])}withoutPlugins(){return new ct([])}},At=new ct;var te,Ar,wn,Ki,as,Gi=class{constructor(e){s(this,Ar);s(this,Ki);s(this,te,void 0);u(this,te,o(e))}as(e){return new xn(this,e)}castTo(){return new Gi({...t(this,te)})}withPlugin(e){return new Gi({...t(this,te),plugins:t(this,te).plugins!==void 0?o([...t(this,te).plugins,e]):o([e])})}toOperationNode(){let e=t(this,te).plugins!==void 0?At.withPlugins(t(this,te).plugins):At;return h(this,Ar,wn).call(this,e)}async execute(e){let i=t(this,te).plugins!==void 0?e.getExecutor().withPlugins(t(this,te).plugins):e.getExecutor();return i.executeQuery(h(this,Ki,as).call(this,i),t(this,te).queryId)}},ee=Gi;te=new WeakMap,Ar=new WeakSet,wn=function(e){return e.transformQuery(t(this,te).rawNode,t(this,te).queryId)},Ki=new WeakSet,as=function(e){return e.compileQuery(h(this,Ar,wn).call(this,e),t(this,te).queryId)};f(ee,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var Sr,ht,xn=class{constructor(e,i){s(this,Sr,void 0);s(this,ht,void 0);u(this,Sr,e),u(this,ht,i)}get alias(){return t(this,ht)}toOperationNode(){return ze.create(t(this,Sr).toOperationNode(),ge(t(this,ht))?t(this,ht).toOperationNode():y.create(t(this,ht)))}};Sr=new WeakMap,ht=new WeakMap;var lt,or,nr=class{constructor(){s(this,lt);this.min=this.min.bind(this),this.max=this.max.bind(this),this.avg=this.avg.bind(this),this.sum=this.sum.bind(this),this.count=this.count.bind(this)}max(e){return h(this,lt,or).call(this,"max",e)}min(e){return h(this,lt,or).call(this,"min",e)}avg(e){return h(this,lt,or).call(this,"avg",e)}sum(e){return h(this,lt,or).call(this,"sum",e)}count(e){return h(this,lt,or).call(this,"count",e)}};lt=new WeakSet,or=function(e,i){return new ee({queryId:q(),rawNode:E.create([`${e}(`,")"],[Ce(i)])})};var mt,gn=class{constructor(e){s(this,mt,void 0);u(this,mt,o(e))}get fn(){return new nr}selectFrom(e){return new et({queryId:q(),executor:t(this,mt).executor,queryNode:W.create(pt(e))})}withSchema(e){return new gn({...t(this,mt),executor:t(this,mt).executor.withPluginAtFront(new Me(e))})}ref(e){return new ee({queryId:q(),plugins:t(this,mt).executor.plugins,rawNode:E.createWithChild(Ce(e))})}},ji=gn;mt=new WeakMap;var L,Se=class{constructor(e){s(this,L,void 0);u(this,L,o(e))}on(...e){return new Se({...t(this,L),joinNode:le.cloneWithOn(t(this,L).joinNode,hn(e))})}orOn(...e){return new Se({...t(this,L),joinNode:le.cloneWithOrOn(t(this,L).joinNode,hn(e))})}onRef(e,i,n){return new Se({...t(this,L),joinNode:le.cloneWithOn(t(this,L).joinNode,P(e,i,n))})}orOnRef(e,i,n){return new Se({...t(this,L),joinNode:le.cloneWithOrOn(t(this,L).joinNode,P(e,i,n))})}onExists(e){return new Se({...t(this,L),joinNode:le.cloneWithOn(t(this,L).joinNode,j(e))})}onNotExists(e){return new Se({...t(this,L),joinNode:le.cloneWithOn(t(this,L).joinNode,H(e))})}orOnExists(e){return new Se({...t(this,L),joinNode:le.cloneWithOrOn(t(this,L).joinNode,j(e))})}orOnNotExists(e){return new Se({...t(this,L),joinNode:le.cloneWithOrOn(t(this,L).joinNode,H(e))})}onTrue(){return new Se({...t(this,L),joinNode:le.cloneWithOn(t(this,L).joinNode,E.createWithSql("true"))})}toOperationNode(){return t(this,L).joinNode}},Dr=Se;L=new WeakMap;f(Dr,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");var us=o({is(r){return r.kind==="ValuesNode"},create(r){return o({kind:"ValuesNode",values:o(r)})}});function ds(r){return xa(Array.isArray(r)?r:[r])}function xa(r){let e=ga(r);return[o([...e.keys()].map(v.create)),us.create(r.map(i=>Ca(i,e)))]}function ga(r){let e=new Map;for(let i of r){let n=Object.keys(i);for(let a of n)!e.has(a)&&i[a]!==void 0&&e.set(a,e.size)}return e}function Ca(r,e){let i=Object.keys(r),n=new Array(e.size).fill(null);for(let a of i){let c=e.get(a),C=r[a];c!==void 0&&(n[c]=C)}return n.some(Or)?Si.create(n.map(a=>Xe(a))):Ai.create(n)}var cs=o({is(r){return r.kind==="ColumnUpdateNode"},create(r,e){return o({kind:"ColumnUpdateNode",column:r,value:e})}});function sr(r){return Object.entries(r).filter(([e,i])=>i!==void 0).map(([e,i])=>cs.create(v.create(e),Xe(i)))}var hs=o({is(r){return r.kind==="OnDuplicateKeyNode"},create(r){return o({kind:"OnDuplicateKeyNode",updates:r})}});var Br,Hi=class{constructor(e){s(this,Br,void 0);u(this,Br,e)}get insertId(){return t(this,Br)}};Br=new WeakMap;var A=o({is(r){return r.kind==="OnConflictNode"},create(){return o({kind:"OnConflictNode"})},cloneWith(r,e){return o({...r,...e})},cloneWithIndexWhere(r,e){return o({...r,indexWhere:r.indexWhere?pe.cloneWithFilter(r.indexWhere,"And",e):pe.create(e)})},cloneWithIndexOrWhere(r,e){return o({...r,indexWhere:r.indexWhere?pe.cloneWithFilter(r.indexWhere,"Or",e):pe.create(e)})},cloneWithUpdateWhere(r,e){return o({...r,updateWhere:r.updateWhere?pe.cloneWithFilter(r.updateWhere,"And",e):pe.create(e)})},cloneWithUpdateOrWhere(r,e){return o({...r,updateWhere:r.updateWhere?pe.cloneWithFilter(r.updateWhere,"Or",e):pe.create(e)})}});var b,Ne=class{constructor(e){s(this,b,void 0);u(this,b,o(e))}column(e){let i=v.create(e);return new Ne({...t(this,b),onConflictNode:A.cloneWith(t(this,b).onConflictNode,{columns:t(this,b).onConflictNode.columns?o([...t(this,b).onConflictNode.columns,i]):o([i])})})}columns(e){let i=e.map(v.create);return new Ne({...t(this,b),onConflictNode:A.cloneWith(t(this,b).onConflictNode,{columns:t(this,b).onConflictNode.columns?o([...t(this,b).onConflictNode.columns,...i]):o(i)})})}constraint(e){return new Ne({...t(this,b),onConflictNode:A.cloneWith(t(this,b).onConflictNode,{constraint:y.create(e)})})}expression(e){return new Ne({...t(this,b),onConflictNode:A.cloneWith(t(this,b).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new Ne({...t(this,b),onConflictNode:A.cloneWithIndexWhere(t(this,b).onConflictNode,me(e))})}whereRef(e,i,n){return new Ne({...t(this,b),onConflictNode:A.cloneWithIndexWhere(t(this,b).onConflictNode,P(e,i,n))})}orWhere(...e){return new Ne({...t(this,b),onConflictNode:A.cloneWithIndexOrWhere(t(this,b).onConflictNode,me(e))})}orWhereRef(e,i,n){return new Ne({...t(this,b),onConflictNode:A.cloneWithIndexOrWhere(t(this,b).onConflictNode,P(e,i,n))})}whereExists(e){return new Ne({...t(this,b),onConflictNode:A.cloneWithIndexWhere(t(this,b).onConflictNode,j(e))})}whereNotExists(e){return new Ne({...t(this,b),onConflictNode:A.cloneWithIndexWhere(t(this,b).onConflictNode,H(e))})}orWhereExists(e){return new Ne({...t(this,b),onConflictNode:A.cloneWithIndexOrWhere(t(this,b).onConflictNode,j(e))})}orWhereNotExists(e){return new Ne({...t(this,b),onConflictNode:A.cloneWithIndexOrWhere(t(this,b).onConflictNode,H(e))})}doNothing(){return new $i({...t(this,b),onConflictNode:A.cloneWith(t(this,b).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new Yi({...t(this,b),onConflictNode:A.cloneWith(t(this,b).onConflictNode,{updates:sr(e)})})}},Lr=Ne;b=new WeakMap;f(Lr,"don't await OnConflictBuilder instances.");var Rr,$i=class{constructor(e){s(this,Rr,void 0);u(this,Rr,o(e))}toOperationNode(){return t(this,Rr).onConflictNode}};Rr=new WeakMap;f($i,"don't await OnConflictDoNothingBuilder instances.");var U,Ke=class{constructor(e){s(this,U,void 0);u(this,U,o(e))}where(...e){return new Ke({...t(this,U),onConflictNode:A.cloneWithUpdateWhere(t(this,U).onConflictNode,me(e))})}whereRef(e,i,n){return new Ke({...t(this,U),onConflictNode:A.cloneWithUpdateWhere(t(this,U).onConflictNode,P(e,i,n))})}orWhere(...e){return new Ke({...t(this,U),onConflictNode:A.cloneWithUpdateOrWhere(t(this,U).onConflictNode,me(e))})}orWhereRef(e,i,n){return new Ke({...t(this,U),onConflictNode:A.cloneWithUpdateOrWhere(t(this,U).onConflictNode,P(e,i,n))})}whereExists(e){return new Ke({...t(this,U),onConflictNode:A.cloneWithUpdateWhere(t(this,U).onConflictNode,j(e))})}whereNotExists(e){return new Ke({...t(this,U),onConflictNode:A.cloneWithUpdateWhere(t(this,U).onConflictNode,H(e))})}orWhereExists(e){return new Ke({...t(this,U),onConflictNode:A.cloneWithUpdateOrWhere(t(this,U).onConflictNode,j(e))})}orWhereNotExists(e){return new Ke({...t(this,U),onConflictNode:A.cloneWithUpdateOrWhere(t(this,U).onConflictNode,H(e))})}toOperationNode(){return t(this,U).onConflictNode}},Yi=Ke;U=new WeakMap;f(Yi,"don't await OnConflictUpdateBuilder instances.");var O,ve=class{constructor(e){s(this,O,void 0);u(this,O,o(e))}values(e){let[i,n]=ds(e);return new ve({...t(this,O),queryNode:be.cloneWith(t(this,O).queryNode,{columns:i,values:n})})}columns(e){return new ve({...t(this,O),queryNode:be.cloneWith(t(this,O).queryNode,{columns:o(e.map(v.create))})})}expression(e){return new ve({...t(this,O),queryNode:be.cloneWith(t(this,O).queryNode,{values:Zt(e)})})}ignore(){return new ve({...t(this,O),queryNode:be.cloneWith(t(this,O).queryNode,{ignore:!0})})}onConflict(e){return new ve({...t(this,O),queryNode:be.cloneWith(t(this,O).queryNode,{onConflict:e(new Lr({onConflictNode:A.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new ve({...t(this,O),queryNode:be.cloneWith(t(this,O).queryNode,{onDuplicateKey:hs.create(sr(e))})})}returning(e){return new ve({...t(this,O),queryNode:l.cloneWithReturning(t(this,O).queryNode,_e(e))})}returningAll(){return new ve({...t(this,O),queryNode:l.cloneWithReturning(t(this,O).queryNode,dt())})}call(e){return e(this)}if(e,i){return e?i(this):new ve({...t(this,O)})}castTo(){return new ve(t(this,O))}withPlugin(e){return new ve({...t(this,O),executor:t(this,O).executor.withPlugin(e)})}toOperationNode(){return t(this,O).executor.transformQuery(t(this,O).queryNode,t(this,O).queryId)}compile(){return t(this,O).executor.compileQuery(this.toOperationNode(),t(this,O).queryId)}async execute(){let e=this.compile(),i=e.query,n=await t(this,O).executor.executeQuery(e,t(this,O).queryId);return t(this,O).executor.adapter.supportsReturning&&i.returning?n.rows:[new Hi(n.insertId)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Je){let i=await this.executeTakeFirst();if(i===void 0)throw new e(this.toOperationNode());return i}},Fr=ve;O=new WeakMap;f(Fr,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var Qr,Xi=class{constructor(e){s(this,Qr,void 0);u(this,Qr,e)}get numDeletedRows(){return t(this,Qr)}};Qr=new WeakMap;var m,z=class{constructor(e){s(this,m,void 0);u(this,m,o(e))}where(...e){return new z({...t(this,m),queryNode:l.cloneWithWhere(t(this,m).queryNode,me(e))})}whereRef(e,i,n){return new z({...t(this,m),queryNode:l.cloneWithWhere(t(this,m).queryNode,P(e,i,n))})}orWhere(...e){return new z({...t(this,m),queryNode:l.cloneWithOrWhere(t(this,m).queryNode,me(e))})}orWhereRef(e,i,n){return new z({...t(this,m),queryNode:l.cloneWithOrWhere(t(this,m).queryNode,P(e,i,n))})}whereExists(e){return new z({...t(this,m),queryNode:l.cloneWithWhere(t(this,m).queryNode,j(e))})}whereNotExists(e){return new z({...t(this,m),queryNode:l.cloneWithWhere(t(this,m).queryNode,H(e))})}orWhereExists(e){return new z({...t(this,m),queryNode:l.cloneWithOrWhere(t(this,m).queryNode,j(e))})}orWhereNotExists(e){return new z({...t(this,m),queryNode:l.cloneWithOrWhere(t(this,m).queryNode,H(e))})}innerJoin(...e){return new z({...t(this,m),queryNode:l.cloneWithJoin(t(this,m).queryNode,_("InnerJoin",e))})}leftJoin(...e){return new z({...t(this,m),queryNode:l.cloneWithJoin(t(this,m).queryNode,_("LeftJoin",e))})}rightJoin(...e){return new z({...t(this,m),queryNode:l.cloneWithJoin(t(this,m).queryNode,_("RightJoin",e))})}fullJoin(...e){return new z({...t(this,m),queryNode:l.cloneWithJoin(t(this,m).queryNode,_("FullJoin",e))})}returning(e){return new z({...t(this,m),queryNode:l.cloneWithReturning(t(this,m).queryNode,_e(e))})}returningAll(){return new z({...t(this,m),queryNode:l.cloneWithReturning(t(this,m).queryNode,dt())})}orderBy(e,i){return new z({...t(this,m),queryNode:qt.cloneWithOrderByItem(t(this,m).queryNode,Li(e,i))})}limit(e){return new z({...t(this,m),queryNode:qt.cloneWithLimit(t(this,m).queryNode,Ri.create(e))})}call(e){return e(this)}if(e,i){return e?i(this):new z({...t(this,m)})}castTo(){return new z(t(this,m))}withPlugin(e){return new z({...t(this,m),executor:t(this,m).executor.withPlugin(e)})}toOperationNode(){return t(this,m).executor.transformQuery(t(this,m).queryNode,t(this,m).queryId)}compile(){return t(this,m).executor.compileQuery(this.toOperationNode(),t(this,m).queryId)}async execute(){let e=this.compile(),i=e.query,n=await t(this,m).executor.executeQuery(e,t(this,m).queryId);return t(this,m).executor.adapter.supportsReturning&&i.returning?n.rows:[new Xi(n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Je){let i=await this.executeTakeFirst();if(i===void 0)throw new e(this.toOperationNode());return i}},Vr=z;m=new WeakMap;f(Vr,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var Pr,Zi=class{constructor(e){s(this,Pr,void 0);u(this,Pr,e)}get numUpdatedRows(){return t(this,Pr)}};Pr=new WeakMap;var p,J=class{constructor(e){s(this,p,void 0);u(this,p,o(e))}where(...e){return new J({...t(this,p),queryNode:l.cloneWithWhere(t(this,p).queryNode,me(e))})}whereRef(e,i,n){return new J({...t(this,p),queryNode:l.cloneWithWhere(t(this,p).queryNode,P(e,i,n))})}orWhere(...e){return new J({...t(this,p),queryNode:l.cloneWithOrWhere(t(this,p).queryNode,me(e))})}orWhereRef(e,i,n){return new J({...t(this,p),queryNode:l.cloneWithOrWhere(t(this,p).queryNode,P(e,i,n))})}whereExists(e){return new J({...t(this,p),queryNode:l.cloneWithWhere(t(this,p).queryNode,j(e))})}whereNotExists(e){return new J({...t(this,p),queryNode:l.cloneWithWhere(t(this,p).queryNode,H(e))})}orWhereExists(e){return new J({...t(this,p),queryNode:l.cloneWithOrWhere(t(this,p).queryNode,j(e))})}orWhereNotExists(e){return new J({...t(this,p),queryNode:l.cloneWithOrWhere(t(this,p).queryNode,H(e))})}from(e){return new J({...t(this,p),queryNode:Ot.cloneWithFromItems(t(this,p).queryNode,pt(e))})}innerJoin(...e){return new J({...t(this,p),queryNode:l.cloneWithJoin(t(this,p).queryNode,_("InnerJoin",e))})}leftJoin(...e){return new J({...t(this,p),queryNode:l.cloneWithJoin(t(this,p).queryNode,_("LeftJoin",e))})}rightJoin(...e){return new J({...t(this,p),queryNode:l.cloneWithJoin(t(this,p).queryNode,_("RightJoin",e))})}fullJoin(...e){return new J({...t(this,p),queryNode:l.cloneWithJoin(t(this,p).queryNode,_("FullJoin",e))})}set(e){return new J({...t(this,p),queryNode:Ot.cloneWithUpdates(t(this,p).queryNode,sr(e))})}returning(e){return new J({...t(this,p),queryNode:l.cloneWithReturning(t(this,p).queryNode,_e(e))})}returningAll(){return new J({...t(this,p),queryNode:l.cloneWithReturning(t(this,p).queryNode,dt())})}call(e){return e(this)}if(e,i){return e?i(this):new J({...t(this,p)})}castTo(){return new J(t(this,p))}withPlugin(e){return new J({...t(this,p),executor:t(this,p).executor.withPlugin(e)})}toOperationNode(){return t(this,p).executor.transformQuery(t(this,p).queryNode,t(this,p).queryId)}compile(){return t(this,p).executor.compileQuery(this.toOperationNode(),t(this,p).queryId)}async execute(){let e=this.compile(),i=e.query,n=await t(this,p).executor.executeQuery(e,t(this,p).queryId);return t(this,p).executor.adapter.supportsReturning&&i.returning?n.rows:[new Zi(n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Je){let i=await this.executeTakeFirst();if(i===void 0)throw new e(this.toOperationNode());return i}},Ur=J;p=new WeakMap;f(Ur,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var ls=o({is(r){return r.kind==="CommonTableExpressionNode"},create(r,e){return o({kind:"CommonTableExpressionNode",name:r,expression:e})}});var Cn=o({is(r){return r.kind==="CommonTableExpressionNameNode"},create(r,e){return o({kind:"CommonTableExpressionNameNode",table:ae.create(r),columns:e?o(e.map(v.create)):void 0})}});function bn(r,e){let i=e(ms());return ls.create(ba(r),i.toOperationNode())}function ba(r){if(r.includes("(")){let e=r.split(/[\(\)]/),i=e[0],n=e[1].split(",").map(a=>a.trim());return Cn.create(i,n)}else return Cn.create(r)}var zr=o({is(r){return r.kind==="WithNode"},create(r,e){return o({kind:"WithNode",expressions:o([r]),...e})},cloneWithExpression(r,e){return o({...r,expressions:o([...r.expressions,e])})}});var D,St=class{constructor(e){s(this,D,void 0);u(this,D,o(e))}selectFrom(e){return new et({queryId:q(),executor:t(this,D).executor,queryNode:W.create(pt(e),t(this,D).withNode)})}insertInto(e){return new Fr({queryId:q(),executor:t(this,D).executor,queryNode:be.create(Y(e),t(this,D).withNode)})}deleteFrom(e){return new Vr({queryId:q(),executor:t(this,D).executor,queryNode:qt.create(Ze(e),t(this,D).withNode)})}updateTable(e){return new Ur({queryId:q(),executor:t(this,D).executor,queryNode:Ot.create(Ze(e),t(this,D).withNode)})}with(e,i){let n=bn(e,i);return new St({...t(this,D),withNode:t(this,D).withNode?zr.cloneWithExpression(t(this,D).withNode,n):zr.create(n)})}withRecursive(e,i){let n=bn(e,i);return new St({...t(this,D),withNode:t(this,D).withNode?zr.cloneWithExpression(t(this,D).withNode,n):zr.create(n,{recursive:!0})})}withPlugin(e){return new St({...t(this,D),executor:t(this,D).executor.withPlugin(e)})}withoutPlugins(){return new St({...t(this,D),executor:t(this,D).executor.withoutPlugins()})}withSchema(e){return new St({...t(this,D),executor:t(this,D).executor.withPluginAtFront(new Me(e))})}},ar=St;D=new WeakMap;function dn(){return new et({queryId:q(),executor:At,queryNode:W.create(pt([]))})}function vn(){return new ji({executor:At})}function ms(){return new ar({executor:At})}function Di(r,e){return new Dr({joinNode:le.create(r,Ze(e))})}function Zt(r){if(ge(r))return r.toOperationNode();if(Ie(r))return r(vn()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(r)}`)}function Bi(r){if(ge(r))return r.toOperationNode();if(Ie(r))return r(vn()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(r)}`)}function Or(r){return ge(r)||Ie(r)}function pt(r){return ut(r)?r.map(e=>Ze(e)):[Ze(r)]}function Ze(r){return xe(r)?va(r):Bi(r)}function va(r){let e=" as ";if(r.includes(e)){let[i,n]=r.split(e).map(ps);return ze.create(Y(i),y.create(n))}else return Y(r)}function Y(r){let e=".";if(r.includes(e)){let[i,n]=r.split(e).map(ps);return ae.createWithSchema(i,n)}else return ae.create(r)}function ps(r){return r.trim()}var fs=o({is(r){return r.kind==="AddColumnNode"},create(r){return o({kind:"AddColumnNode",column:r})}});var Dt=o({is(r){return r.kind==="AlterColumnNode"},create(r){return o({kind:"AlterColumnNode",column:v.create(r)})},cloneWith(r,e){return o({...r,...e})}});var M=o({is(r){return r.kind==="ColumnDefinitionNode"},create(r,e){return o({kind:"ColumnDefinitionNode",column:v.create(r),dataType:e})},cloneWith(r,e){return o({...r,...e})}});var _i=o({is(r){return r.kind==="DataTypeNode"},create(r){return o({kind:"DataTypeNode",dataType:r})}});var Ns=o({is(r){return r.kind==="DropColumnNode"},create(r){return o({kind:"DropColumnNode",column:v.create(r)})}});var ys=o({is(r){return r.kind==="RenameColumnNode"},create(r,e){return o({kind:"RenameColumnNode",column:v.create(r),renameTo:v.create(e)})}});var ur=o({is(r){return r.kind==="CheckConstraintNode"},create(r,e){return o({kind:"CheckConstraintNode",expression:r,name:e?y.create(e):void 0})}});var dr=o({is(r){return r.kind==="ReferencesNode"},create(r,e){return o({kind:"ReferencesNode",table:r,columns:o([...e])})},cloneWithOnDelete(r,e){return o({...r,onDelete:e})},cloneWithOnUpdate(r,e){return o({...r,onUpdate:e})}});function eo(r){return r instanceof ee?r.toOperationNode():ke.createImmediate(r)}var Jr=o({is(r){return r.kind==="GeneratedNode"},create(r){return o({kind:"GeneratedNode",...r})},createWithExpression(r){return o({kind:"GeneratedNode",always:!0,expression:r})},cloneWith(r,e){return o({...r,...e})}});var ws=o({is(r){return r.kind==="DefaultValueNode"},create(r){return o({kind:"DefaultValueNode",defaultValue:r})}});var S,re=class{constructor(e){s(this,S,void 0);u(this,S,e)}autoIncrement(){return new re(M.cloneWith(t(this,S),{autoIncrement:!0}))}primaryKey(){return new re(M.cloneWith(t(this,S),{primaryKey:!0}))}references(e){let i=Ce(e);if(!Wt.is(i)||Yt.is(i.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new re(M.cloneWith(t(this,S),{references:dr.create(i.table,[i.column])}))}onDelete(e){if(!t(this,S).references)throw new Error("on delete constraint can only be added for foreign keys");return new re(M.cloneWith(t(this,S),{references:dr.cloneWithOnDelete(t(this,S).references,e)}))}onUpdate(e){if(!t(this,S).references)throw new Error("on update constraint can only be added for foreign keys");return new re(M.cloneWith(t(this,S),{references:dr.cloneWithOnUpdate(t(this,S).references,e)}))}unique(){return new re(M.cloneWith(t(this,S),{unique:!0}))}notNull(){return new re(M.cloneWith(t(this,S),{notNull:!0}))}unsigned(){return new re(M.cloneWith(t(this,S),{unsigned:!0}))}defaultTo(e){return new re(M.cloneWith(t(this,S),{defaultTo:ws.create(eo(e))}))}check(e){return new re(M.cloneWith(t(this,S),{check:ur.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new re(M.cloneWith(t(this,S),{generated:Jr.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new re(M.cloneWith(t(this,S),{generated:Jr.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new re(M.cloneWith(t(this,S),{generated:Jr.create({identity:!0,byDefault:!0})}))}stored(){if(!t(this,S).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new re(M.cloneWith(t(this,S),{generated:Jr.cloneWith(t(this,S).generated,{stored:!0})}))}toOperationNode(){return t(this,S)}},ft=re;S=new WeakMap;f(ft,"don't await ColumnDefinitionBuilder instances directly.");var xs=o({is(r){return r.kind==="ModifyColumnNode"},create(r){return o({kind:"ModifyColumnNode",column:r})}});function Mr(r){return ge(r)?r.toOperationNode():_i.create(r)}var Bt=o({is(r){return r.kind==="ForeignKeyConstraintNode"},create(r,e,i,n){return o({kind:"ForeignKeyConstraintNode",columns:r,references:dr.create(e,i),name:n?y.create(n):void 0})},cloneWith(r,e){return o({...r,...e})}});var Lt,to=class{constructor(e){s(this,Lt,void 0);u(this,Lt,e)}onDelete(e){return new to(Bt.cloneWith(t(this,Lt),{onDelete:e}))}onUpdate(e){return new to(Bt.cloneWith(t(this,Lt),{onUpdate:e}))}toOperationNode(){return t(this,Lt)}},Rt=to;Lt=new WeakMap;f(Rt,"don't await ForeignKeyConstraintBuilder instances directly.");var ro=o({is(r){return r.kind==="AddConstraintNode"},create(r){return o({kind:"AddConstraintNode",constraint:r})}});var io=o({is(r){return r.kind==="UniqueConstraintNode"},create(r,e){return o({kind:"UniqueConstraintNode",columns:o(r.map(v.create)),name:e?y.create(e):void 0})}});var Kr=o({is(r){return r.kind==="DropConstraintNode"},create(r){return o({kind:"DropConstraintNode",constraintName:y.create(r)})},cloneWith(r,e){return o({...r,...e})}});var Q,jr=class{constructor(e){s(this,Q,void 0);u(this,Q,o(e))}renameTo(e){return new ye({...t(this,Q),alterTableNode:V.cloneWith(t(this,Q).alterTableNode,{renameTo:Y(e)})})}setSchema(e){return new ye({...t(this,Q),alterTableNode:V.cloneWith(t(this,Q).alterTableNode,{setSchema:y.create(e)})})}alterColumn(e){return new oo({...t(this,Q),alterColumnNode:Dt.create(e)})}dropColumn(e){return new ye({...t(this,Q),alterTableNode:V.cloneWith(t(this,Q).alterTableNode,{dropColumn:Ns.create(e)})})}renameColumn(e,i){return new ye({...t(this,Q),alterTableNode:V.cloneWith(t(this,Q).alterTableNode,{renameColumn:ys.create(e,i)})})}addColumn(e,i,n=Cr){return n(new no({...t(this,Q),columnBuilder:new ft(M.create(e,Mr(i)))}))}modifyColumn(e,i){return new so({...t(this,Q),columnBuilder:new ft(M.create(e,Mr(i)))})}addUniqueConstraint(e,i){return new ye({...t(this,Q),alterTableNode:V.cloneWith(t(this,Q).alterTableNode,{addConstraint:ro.create(io.create(i,e))})})}addCheckConstraint(e,i){return new ye({...t(this,Q),alterTableNode:V.cloneWith(t(this,Q).alterTableNode,{addConstraint:ro.create(ur.create(i.toOperationNode(),e))})})}addForeignKeyConstraint(e,i,n,a){return new ao({...t(this,Q),constraintBuilder:new Rt(Bt.create(i.map(v.create),Y(n),a.map(v.create),e))})}dropConstraint(e){return new uo({...t(this,Q),alterTableNode:V.cloneWith(t(this,Q).alterTableNode,{dropConstraint:Kr.create(e)})})}};Q=new WeakMap;var $,oo=class{constructor(e){s(this,$,void 0);u(this,$,o(e))}setDataType(e){return new ye({...t(this,$),alterTableNode:V.cloneWith(t(this,$).alterTableNode,{alterColumn:Dt.cloneWith(t(this,$).alterColumnNode,{dataType:_i.create(e)})})})}setDefault(e){return new ye({...t(this,$),alterTableNode:V.cloneWith(t(this,$).alterTableNode,{alterColumn:Dt.cloneWith(t(this,$).alterColumnNode,{setDefault:eo(e)})})})}dropDefault(){return new ye({...t(this,$),alterTableNode:V.cloneWith(t(this,$).alterTableNode,{alterColumn:Dt.cloneWith(t(this,$).alterColumnNode,{dropDefault:!0})})})}setNotNull(){return new ye({...t(this,$),alterTableNode:V.cloneWith(t(this,$).alterTableNode,{alterColumn:Dt.cloneWith(t(this,$).alterColumnNode,{setNotNull:!0})})})}dropNotNull(){return new ye({...t(this,$),alterTableNode:V.cloneWith(t(this,$).alterTableNode,{alterColumn:Dt.cloneWith(t(this,$).alterColumnNode,{dropNotNull:!0})})})}};$=new WeakMap;var De,ye=class{constructor(e){s(this,De,void 0);u(this,De,o(e))}toOperationNode(){return t(this,De).executor.transformQuery(t(this,De).alterTableNode,t(this,De).queryId)}compile(){return t(this,De).executor.compileQuery(this.toOperationNode(),t(this,De).queryId)}async execute(){await t(this,De).executor.executeQuery(this.compile(),t(this,De).queryId)}};De=new WeakMap;var w,ie=class{constructor(e){s(this,w,void 0);u(this,w,o(e))}autoIncrement(){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.autoIncrement()})}primaryKey(){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.primaryKey()})}references(e){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.references(e)})}onDelete(e){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.onDelete(e)})}onUpdate(e){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.onUpdate(e)})}unique(){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.unique()})}notNull(){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.notNull()})}unsigned(){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.unsigned()})}defaultTo(e){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.defaultTo(e)})}check(e){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.check(e)})}generatedAlwaysAs(e){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.generatedAlwaysAs(e)})}generatedAlwaysAsIdentity(){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.generatedAlwaysAsIdentity()})}generatedByDefaultAsIdentity(){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.generatedByDefaultAsIdentity()})}stored(){return new ie({...t(this,w),columnBuilder:t(this,w).columnBuilder.stored()})}toOperationNode(){return t(this,w).executor.transformQuery(V.cloneWith(t(this,w).alterTableNode,{addColumn:fs.create(t(this,w).columnBuilder.toOperationNode())}),t(this,w).queryId)}compile(){return t(this,w).executor.compileQuery(this.toOperationNode(),t(this,w).queryId)}async execute(){await t(this,w).executor.executeQuery(this.compile(),t(this,w).queryId)}},no=ie;w=new WeakMap;var x,oe=class{constructor(e){s(this,x,void 0);u(this,x,o(e))}autoIncrement(){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.autoIncrement()})}primaryKey(){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.primaryKey()})}references(e){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.references(e)})}onDelete(e){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.onDelete(e)})}onUpdate(e){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.onUpdate(e)})}unique(){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.unique()})}notNull(){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.notNull()})}unsigned(){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.unsigned()})}defaultTo(e){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.defaultTo(e)})}check(e){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.check(e)})}generatedAlwaysAs(e){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.generatedAlwaysAs(e)})}generatedAlwaysAsIdentity(){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.generatedAlwaysAsIdentity()})}generatedByDefaultAsIdentity(){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.generatedByDefaultAsIdentity()})}stored(){return new oe({...t(this,x),columnBuilder:t(this,x).columnBuilder.stored()})}toOperationNode(){return t(this,x).executor.transformQuery(V.cloneWith(t(this,x).alterTableNode,{modifyColumn:xs.create(t(this,x).columnBuilder.toOperationNode())}),t(this,x).queryId)}compile(){return t(this,x).executor.compileQuery(this.toOperationNode(),t(this,x).queryId)}async execute(){await t(this,x).executor.executeQuery(this.compile(),t(this,x).queryId)}},so=oe;x=new WeakMap;var ne,co=class{constructor(e){s(this,ne,void 0);u(this,ne,o(e))}onDelete(e){return new co({...t(this,ne),constraintBuilder:t(this,ne).constraintBuilder.onDelete(e)})}onUpdate(e){return new co({...t(this,ne),constraintBuilder:t(this,ne).constraintBuilder.onUpdate(e)})}toOperationNode(){return t(this,ne).executor.transformQuery(V.cloneWith(t(this,ne).alterTableNode,{addConstraint:ro.create(t(this,ne).constraintBuilder.toOperationNode())}),t(this,ne).queryId)}compile(){return t(this,ne).executor.compileQuery(this.toOperationNode(),t(this,ne).queryId)}async execute(){await t(this,ne).executor.executeQuery(this.compile(),t(this,ne).queryId)}},ao=co;ne=new WeakMap;var K,Gr=class{constructor(e){s(this,K,void 0);u(this,K,o(e))}ifExists(){return new Gr({...t(this,K),alterTableNode:V.cloneWith(t(this,K).alterTableNode,{dropConstraint:Kr.cloneWith(t(this,K).alterTableNode.dropConstraint,{ifExists:!0})})})}cascade(){return new Gr({...t(this,K),alterTableNode:V.cloneWith(t(this,K).alterTableNode,{dropConstraint:Kr.cloneWith(t(this,K).alterTableNode.dropConstraint,{modifier:"cascade"})})})}restrict(){return new Gr({...t(this,K),alterTableNode:V.cloneWith(t(this,K).alterTableNode,{dropConstraint:Kr.cloneWith(t(this,K).alterTableNode.dropConstraint,{modifier:"restrict"})})})}toOperationNode(){return t(this,K).executor.transformQuery(t(this,K).alterTableNode,t(this,K).queryId)}compile(){return t(this,K).executor.compileQuery(this.toOperationNode(),t(this,K).queryId)}async execute(){await t(this,K).executor.executeQuery(this.compile(),t(this,K).queryId)}},uo=Gr;K=new WeakMap;f(jr,"don't await AlterTableBuilder instances");f(oo,"don't await AlterColumnBuilder instances");f(ye,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");f(no,"don't await AlterTableAddColumnBuilder instances directly. To execute the query you need to call `execute`");f(so,"don't await AlterTableModifyColumnBuilder instances directly. To execute the query you need to call `execute`");f(ao,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");f(uo,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");var gs=o({is(r){return r.kind==="ListNode"},create(r){return o({kind:"ListNode",items:o(r)})}});var R,Nt=class{constructor(e){s(this,R,void 0);u(this,R,o(e))}unique(){return new Nt({...t(this,R),createIndexNode:$e.cloneWith(t(this,R).createIndexNode,{unique:!0})})}on(e){return new Nt({...t(this,R),createIndexNode:$e.cloneWith(t(this,R).createIndexNode,{table:Y(e)})})}column(e){return new Nt({...t(this,R),createIndexNode:$e.cloneWith(t(this,R).createIndexNode,{expression:Wr(e)})})}columns(e){return new Nt({...t(this,R),createIndexNode:$e.cloneWith(t(this,R).createIndexNode,{expression:gs.create(e.map(Wr))})})}expression(e){return new Nt({...t(this,R),createIndexNode:$e.cloneWith(t(this,R).createIndexNode,{expression:e.toOperationNode()})})}using(e){return new Nt({...t(this,R),createIndexNode:$e.cloneWith(t(this,R).createIndexNode,{using:E.createWithSql(e)})})}toOperationNode(){return t(this,R).executor.transformQuery(t(this,R).createIndexNode,t(this,R).queryId)}compile(){return t(this,R).executor.compileQuery(this.toOperationNode(),t(this,R).queryId)}async execute(){await t(this,R).executor.executeQuery(this.compile(),t(this,R).queryId)}},Hr=Nt;R=new WeakMap;f(Hr,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var Te,Tn=class{constructor(e){s(this,Te,void 0);u(this,Te,o(e))}ifNotExists(){return new Tn({...t(this,Te),createSchemaNode:Wi.cloneWith(t(this,Te).createSchemaNode,{ifNotExists:!0})})}toOperationNode(){return t(this,Te).executor.transformQuery(t(this,Te).createSchemaNode,t(this,Te).queryId)}compile(){return t(this,Te).executor.compileQuery(this.toOperationNode(),t(this,Te).queryId)}async execute(){await t(this,Te).executor.executeQuery(this.compile(),t(this,Te).queryId)}},$r=Tn;Te=new WeakMap;f($r,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");var Cs=o({is(r){return r.kind==="PrimaryKeyConstraintNode"},create(r,e){return o({kind:"PrimaryKeyConstraintNode",columns:o(r.map(v.create)),name:e?y.create(e):void 0})}});var k,Ge=class{constructor(e){s(this,k,void 0);u(this,k,o(e))}temporary(){return new Ge({...t(this,k),createTableNode:Ae.cloneWith(t(this,k).createTableNode,{temporary:!0})})}onCommit(e){return new Ge({...t(this,k),createTableNode:Ae.cloneWith(t(this,k).createTableNode,{onCommit:e})})}ifNotExists(){return new Ge({...t(this,k),createTableNode:Ae.cloneWith(t(this,k).createTableNode,{ifNotExists:!0})})}addColumn(e,i,n=Cr){let a=n(new ft(M.create(e,Mr(i))));return new Ge({...t(this,k),createTableNode:Ae.cloneWithColumn(t(this,k).createTableNode,a.toOperationNode())})}addPrimaryKeyConstraint(e,i){return new Ge({...t(this,k),createTableNode:Ae.cloneWithConstraint(t(this,k).createTableNode,Cs.create(i,e))})}addUniqueConstraint(e,i){return new Ge({...t(this,k),createTableNode:Ae.cloneWithConstraint(t(this,k).createTableNode,io.create(i,e))})}addCheckConstraint(e,i){return new Ge({...t(this,k),createTableNode:Ae.cloneWithConstraint(t(this,k).createTableNode,ur.create(i.toOperationNode(),e))})}addForeignKeyConstraint(e,i,n,a,c=Cr){let C=c(new Rt(Bt.create(i.map(v.create),Y(n),a.map(v.create),e)));return new Ge({...t(this,k),createTableNode:Ae.cloneWithConstraint(t(this,k).createTableNode,C.toOperationNode())})}toOperationNode(){return t(this,k).executor.transformQuery(t(this,k).createTableNode,t(this,k).queryId)}compile(){return t(this,k).executor.compileQuery(this.toOperationNode(),t(this,k).queryId)}async execute(){await t(this,k).executor.executeQuery(this.compile(),t(this,k).queryId)}},Yr=Ge;k=new WeakMap;f(Yr,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var ue,ho=class{constructor(e){s(this,ue,void 0);u(this,ue,o(e))}on(e){return new ho({...t(this,ue),dropIndexNode:br.cloneWith(t(this,ue).dropIndexNode,{table:Y(e)})})}ifExists(){return new ho({...t(this,ue),dropIndexNode:br.cloneWith(t(this,ue).dropIndexNode,{ifExists:!0})})}toOperationNode(){return t(this,ue).executor.transformQuery(t(this,ue).dropIndexNode,t(this,ue).queryId)}compile(){return t(this,ue).executor.compileQuery(this.toOperationNode(),t(this,ue).queryId)}async execute(){await t(this,ue).executor.executeQuery(this.compile(),t(this,ue).queryId)}},Xr=ho;ue=new WeakMap;f(Xr,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var We,Wn=class{constructor(e){s(this,We,void 0);u(this,We,o(e))}ifExists(){return new Wn({...t(this,We),dropSchemaNode:Oi.cloneWith(t(this,We).dropSchemaNode,{ifExists:!0})})}toOperationNode(){return t(this,We).executor.transformQuery(t(this,We).dropSchemaNode,t(this,We).queryId)}compile(){return t(this,We).executor.compileQuery(this.toOperationNode(),t(this,We).queryId)}async execute(){await t(this,We).executor.executeQuery(this.compile(),t(this,We).queryId)}},Zr=Wn;We=new WeakMap;f(Zr,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var Oe,On=class{constructor(e){s(this,Oe,void 0);u(this,Oe,o(e))}ifExists(){return new On({...t(this,Oe),dropTableNode:qi.cloneWith(t(this,Oe).dropTableNode,{ifExists:!0})})}toOperationNode(){return t(this,Oe).executor.transformQuery(t(this,Oe).dropTableNode,t(this,Oe).queryId)}compile(){return t(this,Oe).executor.compileQuery(this.toOperationNode(),t(this,Oe).queryId)}async execute(){await t(this,Oe).executor.executeQuery(this.compile(),t(this,Oe).queryId)}},_r=On;Oe=new WeakMap;f(_r,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");var Be=o({is(r){return r.kind==="CreateViewNode"},create(r){return o({kind:"CreateViewNode",name:y.create(r)})},cloneWith(r,e){return o({...r,...e})}});var lo=class extends tr{transformValue(e){return{...super.transformValue(e),immediate:!0}}};var po,mo=class{constructor(){s(this,po,new lo)}transformQuery(e){return t(this,po).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}};po=new WeakMap;var F,yt=class{constructor(e){s(this,F,void 0);u(this,F,o(e))}temporary(){return new yt({...t(this,F),createViewNode:Be.cloneWith(t(this,F).createViewNode,{temporary:!0})})}materialized(){return new yt({...t(this,F),createViewNode:Be.cloneWith(t(this,F).createViewNode,{materialized:!0})})}ifNotExists(){return new yt({...t(this,F),createViewNode:Be.cloneWith(t(this,F).createViewNode,{ifNotExists:!0})})}orReplace(){return new yt({...t(this,F),createViewNode:Be.cloneWith(t(this,F).createViewNode,{orReplace:!0})})}columns(e){return new yt({...t(this,F),createViewNode:Be.cloneWith(t(this,F).createViewNode,{columns:e.map(Wr)})})}as(e){let i=e.withPlugin(new mo).toOperationNode();return new yt({...t(this,F),createViewNode:Be.cloneWith(t(this,F).createViewNode,{as:i})})}toOperationNode(){return t(this,F).executor.transformQuery(t(this,F).createViewNode,t(this,F).queryId)}compile(){return t(this,F).executor.compileQuery(this.toOperationNode(),t(this,F).queryId)}async execute(){await t(this,F).executor.executeQuery(this.compile(),t(this,F).queryId)}},ei=yt;F=new WeakMap;f(ei,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");var ti=o({is(r){return r.kind==="DropViewNode"},create(r){return o({kind:"DropViewNode",name:y.create(r)})},cloneWith(r,e){return o({...r,...e})}});var de,fo=class{constructor(e){s(this,de,void 0);u(this,de,o(e))}materialized(){return new fo({...t(this,de),dropViewNode:ti.cloneWith(t(this,de).dropViewNode,{materialized:!0})})}ifExists(){return new fo({...t(this,de),dropViewNode:ti.cloneWith(t(this,de).dropViewNode,{ifExists:!0})})}toOperationNode(){return t(this,de).executor.transformQuery(t(this,de).dropViewNode,t(this,de).queryId)}compile(){return t(this,de).executor.compileQuery(this.toOperationNode(),t(this,de).queryId)}async execute(){await t(this,de).executor.executeQuery(this.compile(),t(this,de).queryId)}},ri=fo;de=new WeakMap;f(ri,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");var se,ii=class{constructor(e){s(this,se,void 0);u(this,se,e)}createTable(e){return new Yr({queryId:q(),executor:t(this,se),createTableNode:Ae.create(Y(e))})}dropTable(e){return new _r({queryId:q(),executor:t(this,se),dropTableNode:qi.create(Y(e))})}createIndex(e){return new Hr({queryId:q(),executor:t(this,se),createIndexNode:$e.create(e)})}dropIndex(e){return new Xr({queryId:q(),executor:t(this,se),dropIndexNode:br.create(e)})}createSchema(e){return new $r({queryId:q(),executor:t(this,se),createSchemaNode:Wi.create(e)})}dropSchema(e){return new Zr({queryId:q(),executor:t(this,se),dropSchemaNode:Oi.create(e)})}alterTable(e){return new jr({queryId:q(),executor:t(this,se),alterTableNode:V.create(e)})}createView(e){return new ei({queryId:q(),executor:t(this,se),createViewNode:Be.create(e)})}dropView(e){return new ri({queryId:q(),executor:t(this,se),dropViewNode:ti.create(e)})}withPlugin(e){return new ii(t(this,se).withPlugin(e))}withoutPlugins(){return new ii(t(this,se).withoutPlugins())}withSchema(e){return new ii(t(this,se).withPluginAtFront(new Me(e)))}},No=ii;se=new WeakMap;var yo=class{ref(e){return new ki(e)}};var cr,wo=class{constructor(e){s(this,cr,void 0);u(this,cr,e)}async provideConnection(e){let i=await t(this,cr).acquireConnection();try{return await e(i)}finally{await t(this,cr).releaseConnection(i)}}};cr=new WeakMap;var je,He,tt,Ft=class extends ir{constructor(i,n,a,c=[]){super(c);s(this,je,void 0);s(this,He,void 0);s(this,tt,void 0);u(this,je,i),u(this,He,n),u(this,tt,a)}get adapter(){return t(this,He)}compileQuery(i){return t(this,je).compileQuery(i)}provideConnection(i){return t(this,tt).provideConnection(i)}withPlugins(i){return new Ft(t(this,je),t(this,He),t(this,tt),[...this.plugins,...i])}withPlugin(i){return new Ft(t(this,je),t(this,He),t(this,tt),[...this.plugins,i])}withPluginAtFront(i){return new Ft(t(this,je),t(this,He),t(this,tt),[i,...this.plugins])}withConnectionProvider(i){return new Ft(t(this,je),t(this,He),i,[...this.plugins])}withoutPlugins(){return new Ft(t(this,je),t(this,He),t(this,tt),[])}},xo=Ft;je=new WeakMap,He=new WeakMap,tt=new WeakMap;function qn(){return typeof performance<"u"&&Ie(performance.now)?performance.now():Date.now()}var Le,wt,rt,Qt,oi,Co,bs,bo,vs,vo,Ts,To,Ws,Wo,Os,go=class{constructor(e,i){s(this,Co);s(this,bo);s(this,vo);s(this,To);s(this,Wo);s(this,Le,void 0);s(this,wt,void 0);s(this,rt,void 0);s(this,Qt,void 0);s(this,oi,new WeakSet);u(this,Le,e),u(this,wt,i)}async init(){t(this,rt)||u(this,rt,t(this,Le).init().catch(e=>(u(this,rt,void 0),Promise.reject(e)))),await t(this,rt)}async acquireConnection(){await this.init();let e=await t(this,Le).acquireConnection();return t(this,oi).has(e)||(h(this,Co,bs).call(this)&&h(this,bo,vs).call(this,e),t(this,oi).add(e)),e}async releaseConnection(e){await t(this,Le).releaseConnection(e)}beginTransaction(e,i){return t(this,Le).beginTransaction(e,i)}commitTransaction(e){return t(this,Le).commitTransaction(e)}rollbackTransaction(e){return t(this,Le).rollbackTransaction(e)}async destroy(){!t(this,rt)||(await t(this,rt),t(this,Qt)||u(this,Qt,t(this,Le).destroy().catch(e=>(u(this,Qt,void 0),Promise.reject(e)))),await t(this,Qt))}};Le=new WeakMap,wt=new WeakMap,rt=new WeakMap,Qt=new WeakMap,oi=new WeakMap,Co=new WeakSet,bs=function(){return t(this,wt).isLevelEnabled("query")||t(this,wt).isLevelEnabled("error")},bo=new WeakSet,vs=function(e){let i=e.executeQuery;e.executeQuery=async n=>{let a=qn();try{return await i.call(e,n)}catch(c){throw h(this,vo,Ts).call(this,c),c}finally{h(this,To,Ws).call(this,n,a)}}},vo=new WeakSet,Ts=function(e){t(this,wt).error(()=>({level:"error",error:e}))},To=new WeakSet,Ws=function(e,i){t(this,wt).query(()=>({level:"query",query:e,queryDurationMillis:h(this,Wo,Os).call(this,i)}))},Wo=new WeakSet,Os=function(e){return qn()-e};var si,xt,Oo,qs,ni=class{constructor(e){s(this,Oo);s(this,si,void 0);s(this,xt,void 0);u(this,si,e)}async provideConnection(e){for(;t(this,xt);)await t(this,xt);let i=h(this,Oo,qs).call(this,e);return u(this,xt,i.then(()=>{u(this,xt,void 0)}).catch(()=>{u(this,xt,void 0)})),i}};si=new WeakMap,xt=new WeakMap,Oo=new WeakSet,qs=async function(e){return await e(t(this,si))};var Is=["read uncommitted","read committed","repeatable read","serializable"];var ky=o(["query","error"]),gt,Vt,qo=class{constructor(e){s(this,gt,void 0);s(this,Vt,void 0);Ie(e)?(u(this,Vt,e),u(this,gt,o({query:!0,error:!0}))):(u(this,Vt,Ta),u(this,gt,o({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return t(this,gt)[e]}query(e){t(this,gt).query&&t(this,Vt).call(this,e())}error(e){t(this,gt).error&&t(this,Vt).call(this,e())}};gt=new WeakMap,Vt=new WeakMap;function Ta(r){r.level==="query"?(console.log(`kysely:query: ${r.query.sql}`),console.log(`kysely:query: duration: ${r.queryDurationMillis.toFixed(1)}ms`)):r.level==="error"&&(r.error instanceof Error?console.error(`kysely:error: ${r.error.stack??r.error.message}`):console.error(`kysely:error: ${r}`))}var ce,ai=class extends ar{constructor(i){let n,a;if(Wa(i))n={executor:i.executor},a={...i};else{let c=i.dialect,C=c.createDriver(),B=c.createQueryCompiler(),Pe=c.createAdapter(),xi=new qo(i.log??[]),vt=new go(C,xi),xr=new wo(vt),gi=new xo(B,Pe,xr,i.plugins??[]);n={executor:gi},a={config:i,executor:gi,dialect:c,driver:vt}}super(n);s(this,ce,void 0);u(this,ce,o(a))}get schema(){return new No(t(this,ce).executor)}get dynamic(){return new yo}get introspection(){return t(this,ce).dialect.createIntrospector(this.withoutPlugins())}get fn(){return new nr}transaction(){return new ko({...t(this,ce)})}connection(){return new Io({...t(this,ce)})}withPlugin(i){return new ai({...t(this,ce),executor:t(this,ce).executor.withPlugin(i)})}withoutPlugins(){return new ai({...t(this,ce),executor:t(this,ce).executor.withoutPlugins()})}withTables(){return new ai({...t(this,ce)})}async destroy(){await t(this,ce).driver.destroy()}get isTransaction(){return!1}getExecutor(){return t(this,ce).executor}},hr=ai;ce=new WeakMap;var it,ui=class extends hr{constructor(i){super(i);s(this,it,void 0);u(this,it,i)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(i){return new ui({...t(this,it),executor:t(this,it).executor.withPlugin(i)})}withoutPlugins(){return new ui({...t(this,it),executor:t(this,it).executor.withoutPlugins()})}withTables(){return new ui({...t(this,it)})}},In=ui;it=new WeakMap;function Wa(r){return Ue(r)&&Ue(r.config)&&Ue(r.driver)&&Ue(r.executor)&&Ue(r.dialect)}var Pt,Io=class{constructor(e){s(this,Pt,void 0);u(this,Pt,o(e))}async execute(e){return t(this,Pt).executor.provideConnection(async i=>{let n=t(this,Pt).executor.withConnectionProvider(new ni(i)),a=new hr({...t(this,Pt),executor:n});return await e(a)})}};Pt=new WeakMap;f(Io,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var Re,kn=class{constructor(e){s(this,Re,void 0);u(this,Re,o(e))}setIsolationLevel(e){return new kn({...t(this,Re),isolationLevel:e})}async execute(e){let{isolationLevel:i,...n}=t(this,Re),a={isolationLevel:i};return Oa(a),t(this,Re).executor.provideConnection(async c=>{let C=t(this,Re).executor.withConnectionProvider(new ni(c)),B=new In({...n,executor:C});try{await t(this,Re).driver.beginTransaction(c,a);let Pe=await e(B);return await t(this,Re).driver.commitTransaction(c),Pe}catch(Pe){throw await t(this,Re).driver.rollbackTransaction(c),Pe}})}},ko=kn;Re=new WeakMap;f(ko,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function Oa(r){if(r.isolationLevel&&!Is.includes(r.isolationLevel))throw new Error(`invalid transaction isolation level ${r.isolationLevel}`)}var he=Object.assign((r,...e)=>new ee({queryId:q(),rawNode:E.create(r,(e==null?void 0:e.map(Xe))??[])}),{ref(r){return new ee({queryId:q(),rawNode:E.createWithChild(Ce(r))})},table(r){return new ee({queryId:q(),rawNode:E.createWithChild(Y(r))})},id(...r){let e=new Array(r.length+1).fill(".");return e[0]="",e[e.length-1]="",new ee({queryId:q(),rawNode:E.create(e,r.map(y.create))})},literal(r){return new ee({queryId:q(),rawNode:E.createWithChild(ke.createImmediate(r))})},raw(r){return new ee({queryId:q(),rawNode:E.createWithSql(r)})},join(r,e=he`, `){let i=new Array(2*r.length-1),n=e.toOperationNode();for(let a=0;a<r.length;++a)i[2*a]=Xe(r[a]),a!==r.length-1&&(i[2*a+1]=n);return new ee({queryId:q(),rawNode:E.createWithChildren(i)})}});var Ao,Eo=class{constructor(){Kt(this,"nodeStack",[]);s(this,Ao,o({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),FilterNode:this.visitFilter.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),UnionNode:this.visitUnion.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this)}));Kt(this,"visitNode",e=>{this.nodeStack.push(e),t(this,Ao)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}};Ao=new WeakMap;var lr,Ut,mr=class extends Eo{constructor(){super(...arguments);s(this,lr,"");s(this,Ut,[])}get numParameters(){return t(this,Ut).length}compileQuery(i){return u(this,lr,""),u(this,Ut,[]),this.visitNode(i),o({query:i,sql:this.getSql(),parameters:[...t(this,Ut)]})}getSql(){return t(this,lr)}visitSelectQuery(i){let n=this.parentNode!==void 0&&!be.is(this.parentNode)&&!Be.is(this.parentNode)&&!Fi.is(this.parentNode);n&&this.append("("),i.with&&(this.visitNode(i.with),this.append(" ")),this.append("select "),i.distinctOnSelections&&(this.compileDistinctOn(i.distinctOnSelections),this.append(" ")),i.distinct&&(this.append("distinct"),this.append(" ")),i.selections&&(this.compileList(i.selections),this.append(" ")),this.visitNode(i.from),i.joins&&(this.append(" "),this.compileList(i.joins," ")),i.where&&(this.append(" "),this.visitNode(i.where)),i.groupBy&&(this.append(" "),this.visitNode(i.groupBy)),i.having&&(this.append(" "),this.visitNode(i.having)),i.union&&(this.append(" "),this.compileList(i.union," ")),i.orderBy&&(this.append(" "),this.visitNode(i.orderBy)),i.limit&&(this.append(" "),this.visitNode(i.limit)),i.offset&&(this.append(" "),this.visitNode(i.offset)),i.modifiers&&i.modifiers.forEach(a=>{this.append(" "),this.append(qa[a])}),n&&this.append(")")}visitFrom(i){this.append("from "),this.compileList(i.froms)}visitSelection(i){this.visitNode(i.selection)}visitColumn(i){this.visitNode(i.column)}compileDistinctOn(i){this.append("distinct on ("),this.compileList(i),this.append(")")}compileList(i,n=", "){let a=Ti(i);for(let c of i)this.visitNode(c),c!==a&&this.append(n)}visitWhere(i){this.append("where "),this.visitNode(i.where)}visitHaving(i){this.append("having "),this.visitNode(i.having)}visitInsertQuery(i){let n=this.nodeStack.find(l.is)!==i;n&&this.append("("),i.with&&(this.visitNode(i.with),this.append(" ")),this.append("insert"),i.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(i.into),i.columns&&(this.append(" ("),this.compileList(i.columns),this.append(")")),i.values&&(this.append(" "),this.visitNode(i.values)),i.onConflict&&(this.append(" "),this.visitNode(i.onConflict)),i.onDuplicateKey&&(this.append(" "),this.visitNode(i.onDuplicateKey)),i.returning&&(this.append(" "),this.visitNode(i.returning)),n&&this.append(")")}visitValues(i){this.append("values "),this.compileList(i.values)}visitDeleteQuery(i){let n=this.nodeStack.find(l.is)!==i;n&&this.append("("),i.with&&(this.visitNode(i.with),this.append(" ")),this.append("delete "),this.visitNode(i.from),i.joins&&(this.append(" "),this.compileList(i.joins," ")),i.where&&(this.append(" "),this.visitNode(i.where)),i.orderBy&&(this.append(" "),this.visitNode(i.orderBy)),i.limit&&(this.append(" "),this.visitNode(i.limit)),i.returning&&(this.append(" "),this.visitNode(i.returning)),n&&this.append(")")}visitReturning(i){this.append("returning "),this.compileList(i.selections)}visitAlias(i){this.visitNode(i.node),this.append(" as "),this.visitNode(i.alias)}visitReference(i){this.visitNode(i.table),this.append("."),this.visitNode(i.column)}visitSelectAll(i){this.append("*")}visitIdentifier(i){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(i),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(i){this.append(i.identifier)}visitFilter(i){i.left&&(this.visitNode(i.left),this.append(" ")),this.visitNode(i.op),this.append(" "),this.visitNode(i.right)}visitAnd(i){this.visitNode(i.left),this.append(" and "),this.visitNode(i.right)}visitOr(i){this.visitNode(i.left),this.append(" or "),this.visitNode(i.right)}visitValue(i){i.immediate?this.appendImmediateValue(i.value):this.appendValue(i.value)}visitValueList(i){this.append("("),this.compileList(i.values),this.append(")")}visitPrimitiveValueList(i){this.append("(");let{values:n}=i;for(let a=0;a<n.length;++a)this.appendValue(n[a]),a!==n.length-1&&this.append(", ");this.append(")")}visitParens(i){this.append("("),this.visitNode(i.node),this.append(")")}visitJoin(i){this.append(Ia[i.joinType]),this.append(" "),this.visitNode(i.table),i.on&&(this.append(" "),this.visitNode(i.on))}visitOn(i){this.append("on "),this.visitNode(i.on)}visitRaw(i){let{sqlFragments:n,parameters:a}=i;for(let c=0;c<n.length;++c)this.append(n[c]),a.length>c&&this.visitNode(a[c])}visitOperator(i){this.append(i.operator)}visitTable(i){i.schema&&(this.visitNode(i.schema),this.append(".")),this.visitNode(i.table)}visitCreateTable(i){this.append("create "),i.temporary&&this.append("temporary "),this.append("table "),i.ifNotExists&&this.append("if not exists "),this.visitNode(i.table),this.append(" ("),this.compileList([...i.columns,...i.constraints??[]]),this.append(")"),i.onCommit&&(this.append(" on commit "),this.append(i.onCommit))}visitColumnDefinition(i){this.visitNode(i.column),this.append(" "),this.visitNode(i.dataType),i.unsigned&&this.append(" unsigned"),i.generated&&(this.append(" "),this.visitNode(i.generated)),i.defaultTo&&(this.append(" "),this.visitNode(i.defaultTo)),i.notNull&&this.append(" not null"),i.unique&&this.append(" unique"),i.primaryKey&&this.append(" primary key"),i.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),i.references&&(this.append(" "),this.visitNode(i.references)),i.check&&(this.append(" "),this.visitNode(i.check))}getAutoIncrement(){return"auto_increment"}visitReferences(i){this.append("references "),this.visitNode(i.table),this.append(" ("),this.compileList(i.columns),this.append(")"),i.onDelete&&(this.append(" on delete "),this.append(i.onDelete)),i.onUpdate&&(this.append(" on update "),this.append(i.onUpdate))}visitDropTable(i){this.append("drop table "),i.ifExists&&this.append("if exists "),this.visitNode(i.table)}visitDataType(i){this.append(i.dataType)}visitOrderBy(i){this.append("order by "),this.compileList(i.items)}visitOrderByItem(i){this.visitNode(i.orderBy),i.direction&&(this.append(" "),this.visitNode(i.direction))}visitGroupBy(i){this.append("group by "),this.compileList(i.items)}visitGroupByItem(i){this.visitNode(i.groupBy)}visitUpdateQuery(i){let n=this.nodeStack.find(l.is)!==i;n&&this.append("("),i.with&&(this.visitNode(i.with),this.append(" ")),this.append("update "),this.visitNode(i.table),this.append(" set "),i.updates&&this.compileList(i.updates),i.from&&(this.append(" "),this.visitNode(i.from)),i.joins&&(this.append(" "),this.compileList(i.joins," ")),i.where&&(this.append(" "),this.visitNode(i.where)),i.returning&&(this.append(" "),this.visitNode(i.returning)),n&&this.append(")")}visitColumnUpdate(i){this.visitNode(i.column),this.append(" = "),this.visitNode(i.value)}visitLimit(i){this.append("limit "),this.visitNode(i.limit)}visitOffset(i){this.append("offset "),this.visitNode(i.offset)}visitOnConflict(i){this.append("on conflict"),i.columns?(this.append(" ("),this.compileList(i.columns),this.append(")")):i.constraint?(this.append(" on constraint "),this.visitNode(i.constraint)):i.indexExpression&&(this.append(" ("),this.visitNode(i.indexExpression),this.append(")")),i.indexWhere&&(this.append(" "),this.visitNode(i.indexWhere)),i.doNothing===!0?this.append(" do nothing"):i.updates&&(this.append(" do update set "),this.compileList(i.updates),i.updateWhere&&(this.append(" "),this.visitNode(i.updateWhere)))}visitOnDuplicateKey(i){this.append("on duplicate key update "),this.compileList(i.updates)}visitCreateIndex(i){this.append("create "),i.unique&&this.append("unique "),this.append("index "),this.visitNode(i.name),i.table&&(this.append(" on "),this.visitNode(i.table)),i.using&&(this.append(" using "),this.visitNode(i.using)),i.expression&&(this.append(" ("),E.is(i.expression)&&this.append("("),this.visitNode(i.expression),E.is(i.expression)&&this.append(")"),this.append(")"))}visitDropIndex(i){this.append("drop index "),i.ifExists&&this.append("if exists "),this.visitNode(i.name),i.table&&(this.append(" on "),this.visitNode(i.table))}visitCreateSchema(i){this.append("create schema "),i.ifNotExists&&this.append("if not exists "),this.visitNode(i.schema)}visitDropSchema(i){this.append("drop schema "),i.ifExists&&this.append("if exists "),this.visitNode(i.schema)}visitPrimaryKeyConstraint(i){i.name&&(this.append("constraint "),this.visitNode(i.name),this.append(" ")),this.append("primary key ("),this.compileList(i.columns),this.append(")")}visitUniqueConstraint(i){i.name&&(this.append("constraint "),this.visitNode(i.name),this.append(" ")),this.append("unique ("),this.compileList(i.columns),this.append(")")}visitCheckConstraint(i){i.name&&(this.append("constraint "),this.visitNode(i.name),this.append(" ")),this.append("check ("),this.visitNode(i.expression),this.append(")")}visitForeignKeyConstraint(i){i.name&&(this.append("constraint "),this.visitNode(i.name),this.append(" ")),this.append("foreign key ("),this.compileList(i.columns),this.append(") "),this.visitNode(i.references),i.onDelete&&(this.append(" on delete "),this.append(i.onDelete)),i.onUpdate&&(this.append(" on update "),this.append(i.onUpdate))}visitList(i){this.compileList(i.items)}visitWith(i){this.append("with "),i.recursive&&this.append("recursive "),this.compileList(i.expressions)}visitCommonTableExpression(i){this.visitNode(i.name),this.append(" as "),this.visitNode(i.expression)}visitCommonTableExpressionName(i){this.visitNode(i.table),i.columns&&(this.append("("),this.compileList(i.columns),this.append(")"))}visitAlterTable(i){this.append("alter table "),this.visitNode(i.table),this.append(" "),i.renameTo&&(this.append("rename to "),this.visitNode(i.renameTo)),i.setSchema&&(this.append("set schema "),this.visitNode(i.setSchema)),i.addConstraint&&this.visitNode(i.addConstraint),i.dropConstraint&&this.visitNode(i.dropConstraint),i.renameColumn&&this.visitNode(i.renameColumn),i.addColumn&&this.visitNode(i.addColumn),i.dropColumn&&this.visitNode(i.dropColumn),i.alterColumn&&this.visitNode(i.alterColumn),i.modifyColumn&&this.visitNode(i.modifyColumn)}visitAddColumn(i){this.append("add column "),this.visitNode(i.column)}visitRenameColumn(i){this.append("rename column "),this.visitNode(i.column),this.append(" to "),this.visitNode(i.renameTo)}visitDropColumn(i){this.append("drop column "),this.visitNode(i.column)}visitAlterColumn(i){this.append("alter column "),this.visitNode(i.column),this.append(" "),i.dataType&&(this.append("type "),this.visitNode(i.dataType),i.dataTypeExpression&&(this.append("using "),this.visitNode(i.dataTypeExpression))),i.setDefault&&(this.append("set default "),this.visitNode(i.setDefault)),i.dropDefault&&this.append("drop default"),i.setNotNull&&this.append("set not null"),i.dropNotNull&&this.append("drop not null")}visitModifyColumn(i){this.append("modify column "),this.visitNode(i.column)}visitAddConstraint(i){this.append("add "),this.visitNode(i.constraint)}visitDropConstraint(i){this.append("drop constraint "),i.ifExists&&this.append("if exists "),this.visitNode(i.constraintName),i.modifier==="cascade"?this.append(" cascade"):i.modifier==="restrict"&&this.append(" restrict")}visitUnion(i){this.append("union "),i.all&&this.append("all "),this.visitNode(i.union)}visitCreateView(i){this.append("create "),i.orReplace&&this.append("or replace "),i.materialized&&this.append("materialized "),i.temporary&&this.append("temporary "),this.append("view "),i.ifNotExists&&this.append("if not exists "),this.visitNode(i.name),this.append(" "),i.columns&&(this.append("("),this.compileList(i.columns),this.append(") ")),i.as&&(this.append("as "),this.visitNode(i.as))}visitDropView(i){this.append("drop "),i.materialized&&this.append("materialized "),this.append("view "),i.ifExists&&this.append("if exists "),this.visitNode(i.name)}visitGenerated(i){this.append("generated "),i.always&&this.append("always "),i.byDefault&&this.append("by default "),this.append("as "),i.identity&&this.append("identity"),i.expression&&(this.append("("),this.visitNode(i.expression),this.append(")")),i.stored&&this.append(" stored")}visitDefaultValue(i){this.append("default "),this.visitNode(i.defaultValue)}append(i){u(this,lr,t(this,lr)+i)}appendValue(i){this.addParameter(i),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}addParameter(i){t(this,Ut).push(i)}appendImmediateValue(i){if(xe(i))this.append(`'${i}'`);else if(Vn(i)||bi(i))this.append(i.toString());else if(vi(i))this.append("null");else if(Pn(i))this.appendImmediateValue(i.toISOString());else if(Un(i))this.appendImmediateValue(i.toString());else throw new Error(`invalid immediate value ${i}`)}};lr=new WeakMap,Ut=new WeakMap;var qa=o({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked"}),Ia=o({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"});var pr=class{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}};var So=class{transformQuery(e){return e.node}async transformResult(e){return e.result}};var fi="kysely_migration",Ni="kysely_migration_lock",ks="migration_lock",ka=o({__noMigrations__:!0}),G,zt,di,Fe,ot,Qe,nt,Ct,fr,Ve,st,Do,As,Bo,Ss,Lo,Ds,Ro,Bs,Fo,Ls,hi,En,bt,Nr,li,An,Qo,Rs,Vo,Fs,mi,Sn,Po,Qs,Uo,Vs,zo,Ps,Jo,Us,Es=class{constructor(e){s(this,zt);s(this,Fe);s(this,Qe);s(this,Ct);s(this,Ve);s(this,Do);s(this,Bo);s(this,Lo);s(this,Ro);s(this,Fo);s(this,hi);s(this,bt);s(this,li);s(this,Qo);s(this,Vo);s(this,mi);s(this,Po);s(this,Uo);s(this,zo);s(this,Jo);s(this,G,void 0);u(this,G,o(e))}async getMigrations(){let e=await h(this,bt,Nr).call(this,t(this,Qe,nt))?await t(this,G).db.withPlugin(t(this,Ve,st)).selectFrom(t(this,Qe,nt)).select(["name","timestamp"]).execute():[];return(await h(this,mi,Sn).call(this)).map(({name:n,...a})=>{let c=e.find(C=>C.name===n);return{name:n,migration:a,executedAt:c?new Date(c.timestamp):void 0}})}async migrateToLatest(){return h(this,zt,di).call(this,({migrations:e})=>e.length-1)}async migrateTo(e){return h(this,zt,di).call(this,({migrations:i})=>{if(e===ka)return-1;let n=i.findIndex(a=>a.name===e);if(n===-1)throw new Error(`migration "${e}" doesn't exist`);return n})}async migrateUp(){return h(this,zt,di).call(this,({currentIndex:e,migrations:i})=>Math.min(e+1,i.length-1))}async migrateDown(){return h(this,zt,di).call(this,({currentIndex:e})=>Math.max(e-1,-1))}};G=new WeakMap,zt=new WeakSet,di=async function(e){try{return await h(this,Do,As).call(this),await h(this,Qo,Rs).call(this,e)}catch(i){return i instanceof ci?i.resultSet:{error:i}}},Fe=new WeakSet,ot=function(){return t(this,G).migrationTableSchema},Qe=new WeakSet,nt=function(){return t(this,G).migrationTableName??fi},Ct=new WeakSet,fr=function(){return t(this,G).migrationLockTableName??Ni},Ve=new WeakSet,st=function(){return t(this,Fe,ot)?new Me(t(this,Fe,ot)):new So},Do=new WeakSet,As=async function(){await h(this,Bo,Ss).call(this),await h(this,Lo,Ds).call(this),await h(this,Ro,Bs).call(this),await h(this,Fo,Ls).call(this)},Bo=new WeakSet,Ss=async function(){if(!!t(this,Fe,ot)&&!await h(this,hi,En).call(this))try{await t(this,G).db.schema.createSchema(t(this,Fe,ot)).ifNotExists().execute()}catch(e){if(!await h(this,hi,En).call(this))throw e}},Lo=new WeakSet,Ds=async function(){if(!await h(this,bt,Nr).call(this,t(this,Qe,nt)))try{t(this,Fe,ot)&&await t(this,G).db.schema.createSchema(t(this,Fe,ot)).ifNotExists().execute(),await t(this,G).db.schema.withPlugin(t(this,Ve,st)).createTable(t(this,Qe,nt)).ifNotExists().addColumn("name","varchar(255)",e=>e.notNull().primaryKey()).addColumn("timestamp","varchar(255)",e=>e.notNull()).execute()}catch(e){if(!await h(this,bt,Nr).call(this,t(this,Qe,nt)))throw e}},Ro=new WeakSet,Bs=async function(){if(!await h(this,bt,Nr).call(this,t(this,Ct,fr)))try{await t(this,G).db.schema.withPlugin(t(this,Ve,st)).createTable(t(this,Ct,fr)).ifNotExists().addColumn("id","varchar(255)",e=>e.notNull().primaryKey()).addColumn("is_locked","integer",e=>e.notNull().defaultTo(0)).execute()}catch(e){if(!await h(this,bt,Nr).call(this,t(this,Ct,fr)))throw e}},Fo=new WeakSet,Ls=async function(){if(!await h(this,li,An).call(this))try{await t(this,G).db.withPlugin(t(this,Ve,st)).insertInto(t(this,Ct,fr)).values({id:ks,is_locked:0}).execute()}catch(e){if(!await h(this,li,An).call(this))throw e}},hi=new WeakSet,En=async function(){return(await t(this,G).db.introspection.getSchemas()).some(i=>i.name===t(this,Fe,ot))},bt=new WeakSet,Nr=async function(e){let i=t(this,Fe,ot);return(await t(this,G).db.introspection.getTables({withInternalKyselyTables:!0})).some(a=>a.name===e&&(!i||a.schema===i))},li=new WeakSet,An=async function(){return!!await t(this,G).db.withPlugin(t(this,Ve,st)).selectFrom(t(this,Ct,fr)).where("id","=",ks).select("id").executeTakeFirst()},Qo=new WeakSet,Rs=async function(e){let i=t(this,G).db.getExecutor().adapter,n=async a=>{try{await i.acquireMigrationLock(a);let c=await h(this,Vo,Fs).call(this,a);if(c.migrations.length===0)return{results:[]};let C=e(c);return C===void 0?{results:[]}:C<c.currentIndex?await h(this,zo,Ps).call(this,a,c,C):C>c.currentIndex?await h(this,Jo,Us).call(this,a,c,C):{results:[]}}finally{await i.releaseMigrationLock(a)}};return i.supportsTransactionalDdl?t(this,G).db.transaction().execute(n):t(this,G).db.connection().execute(n)},Vo=new WeakSet,Fs=async function(e){let i=await h(this,mi,Sn).call(this),n=await h(this,Po,Qs).call(this,e);return h(this,Uo,Vs).call(this,i,n),o({migrations:i,currentIndex:i.findIndex(a=>a.name===Ti(n))})},mi=new WeakSet,Sn=async function(){let e=await t(this,G).provider.getMigrations();return Object.keys(e).sort().map(i=>({...e[i],name:i}))},Po=new WeakSet,Qs=async function(e){return(await e.withPlugin(t(this,Ve,st)).selectFrom(t(this,Qe,nt)).select("name").orderBy("name").execute()).map(n=>n.name)},Uo=new WeakSet,Vs=function(e,i){for(let n of i)if(!e.some(a=>a.name===n))throw new Error(`corrupted migrations: previously executed migration ${n} is missing`);for(let n=0;n<i.length;++n)if(e[n].name!==i[n])throw new Error(`corrupted migrations: expected previously executed migration ${i[n]} to be at index ${n} but ${e[n].name} was found in its place. New migrations must always have a name that comes alphabetically after the last executed migration.`)},zo=new WeakSet,Ps=async function(e,i,n){let a=[];for(let c=i.currentIndex;c>n;--c)a.push({migrationName:i.migrations[c].name,direction:"Down",status:"NotExecuted"});for(let c=0;c<a.length;++c){let C=i.migrations.find(B=>B.name===a[c].migrationName);try{C.down&&(await C.down(e),await e.withPlugin(t(this,Ve,st)).deleteFrom(t(this,Qe,nt)).where("name","=",C.name).execute(),a[c]={migrationName:C.name,direction:"Down",status:"Success"})}catch(B){throw a[c]={migrationName:C.name,direction:"Down",status:"Error"},new ci({error:B,results:a})}}return{results:a}},Jo=new WeakSet,Us=async function(e,i,n){let a=[];for(let c=i.currentIndex+1;c<=n;++c)a.push({migrationName:i.migrations[c].name,direction:"Up",status:"NotExecuted"});for(let c=0;c<a.length;++c){let C=i.migrations.find(B=>B.name===a[c].migrationName);try{await C.up(e),await e.withPlugin(t(this,Ve,st)).insertInto(t(this,Qe,nt)).values({name:C.name,timestamp:new Date().toISOString()}).execute(),a[c]={migrationName:C.name,direction:"Up",status:"Success"}}catch(B){throw a[c]={migrationName:C.name,direction:"Up",status:"Error"},new ci({error:B,results:a})}}return{results:a}};var pi,ci=class extends Error{constructor(i){super();s(this,pi,void 0);u(this,pi,i)}get resultSet(){return t(this,pi)}};pi=new WeakMap;var Mo=class extends mr{getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}};var Jt,Go,zs,Ko=class{constructor(e){s(this,Go);s(this,Jt,void 0);u(this,Jt,e)}async getSchemas(){return(await t(this,Jt).selectFrom("pg_catalog.pg_namespace").select("nspname").castTo().execute()).map(i=>({name:i.nspname}))}async getTables(e={withInternalKyselyTables:!1}){let i=t(this,Jt).selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_tables as t","t.tablename","c.relname").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","t.tablename as table","t.schemaname as schema","typ.typname as type",t(this,Jt).selectFrom("pg_class").select(he`true`.as("auto_incrementing")).where("relkind","=","S").where("relname","=",he`t.tablename || '_' || a.attname || '_seq'`).as("auto_incrementing")]).where("t.schemaname","!~","^pg_").where("t.schemaname","!=","information_schema").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).castTo();e.withInternalKyselyTables||(i=i.where("t.tablename","!=",fi).where("t.tablename","!=",Ni));let n=await i.execute();return h(this,Go,zs).call(this,n)}async getMetadata(e){return{tables:await this.getTables(e)}}};Jt=new WeakMap,Go=new WeakSet,zs=function(e){return e.reduce((i,n)=>{let a=i.find(c=>c.name===n.table&&c.schema===n.schema);return a||(a=o({name:n.table,schema:n.schema,columns:[]}),i.push(a)),a.columns.push(o({name:n.column,dataType:n.type,isNullable:!n.not_null,isAutoIncrementing:!!n.auto_incrementing,hasDefaultValue:n.has_default})),i},[])};var Ea=3853314791062309107n,jo=class extends pr{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(e){await he`select pg_advisory_xact_lock(${he.literal(Ea)})`.execute(e)}async releaseMigrationLock(){}};var Ho=class extends mr{getCurrentParameterPlaceholder(){return"?"}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}};var yr,Yo,Js,$o=class{constructor(e){s(this,Yo);s(this,yr,void 0);u(this,yr,e)}async getSchemas(){return(await t(this,yr).selectFrom("information_schema.schemata").select("schema_name").castTo().execute()).map(i=>({name:i.SCHEMA_NAME}))}async getTables(e={withInternalKyselyTables:!1}){let i=t(this,yr).selectFrom("information_schema.columns").select(["column_name","column_default","table_name","table_schema","is_nullable","data_type","extra"]).where("table_schema","=",he`database()`).castTo();e.withInternalKyselyTables||(i=i.where("table_name","!=",fi).where("table_name","!=",Ni));let n=await i.execute();return h(this,Yo,Js).call(this,n)}async getMetadata(e){return{tables:await this.getTables(e)}}};yr=new WeakMap,Yo=new WeakSet,Js=function(e){return e.reduce((i,n)=>{let a=i.find(c=>c.name===n.TABLE_NAME);return a||(a=o({name:n.TABLE_NAME,schema:n.TABLE_SCHEMA,columns:[]}),i.push(a)),a.columns.push(o({name:n.COLUMN_NAME,dataType:n.DATA_TYPE,isNullable:n.IS_NULLABLE==="YES",isAutoIncrementing:n.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:n.COLUMN_DEFAULT!==null})),i},[])};var Ms="ea586330-2c93-47c8-908d-981d9d270f9d",Aa=60*60,Xo=class extends pr{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(e){await he`select get_lock(${he.literal(Ms)}, ${he.literal(Aa)})`.execute(e)}async releaseMigrationLock(e){await he`select release_lock(${he.literal(Ms)})`.execute(e)}};var yi,Zo=class{constructor(e){s(this,yi,void 0);u(this,yi,e)}async init(){}async acquireConnection(){return new Dn(t(this,yi))}async beginTransaction(e){await e.beginTransaction()}async commitTransaction(e){await e.commitTransaction()}async rollbackTransaction(e){await e.rollbackTransaction()}async releaseConnection(e){}async destroy(){}};yi=new WeakMap;var X,at,Dn=class{constructor(e){s(this,X,void 0);s(this,at,void 0);u(this,X,e)}async beginTransaction(){let e=await t(this,X).client.beginTransaction({secretArn:t(this,X).secretArn,resourceArn:t(this,X).resourceArn,database:t(this,X).database}).promise();u(this,at,e.transactionId)}async commitTransaction(){if(!t(this,at))throw new Error("Cannot commit a transaction before creating it");await t(this,X).client.commitTransaction({secretArn:t(this,X).secretArn,resourceArn:t(this,X).resourceArn,transactionId:t(this,at)}).promise()}async rollbackTransaction(){if(!t(this,at))throw new Error("Cannot rollback a transaction before creating it");await t(this,X).client.rollbackTransaction({secretArn:t(this,X).secretArn,resourceArn:t(this,X).resourceArn,transactionId:t(this,at)}).promise()}async executeQuery(e){var c;let i=await t(this,X).client.executeStatement({transactionId:t(this,at),secretArn:t(this,X).secretArn,resourceArn:t(this,X).resourceArn,sql:e.sql,parameters:e.parameters,database:t(this,X).database,includeResultMetadata:!0}).promise();return i.columnMetadata?{rows:((c=i.records)==null?void 0:c.filter(C=>C.length!==0).map(C=>Object.fromEntries(C.map((B,Pe)=>[i.columnMetadata[Pe].name,B.stringValue??B.blobValue??B.longValue??B.arrayValue??B.doubleValue??(B.isNull?null:B.booleanValue)]))))||[]}:{numUpdatedOrDeletedRows:BigInt(i.numberOfRecordsUpdated||0),rows:[]}}};X=new WeakMap,at=new WeakMap;var _o=class extends Mo{appendValue(e){let i=this.numParameters;this.append(this.getCurrentParameterPlaceholder()),this.addParameter({name:i.toString(),value:Ks(e)})}getCurrentParameterPlaceholder(){return":"+this.numParameters}},en=class extends Ho{appendValue(e){let i=this.numParameters;this.append(this.getCurrentParameterPlaceholder()),this.addParameter({name:i.toString(),value:Ks(e)})}getCurrentParameterPlaceholder(){return":"+this.numParameters}};function Ks(r){if(r==null)return{isNull:!0};switch(typeof r){case"number":return Number.isInteger(r)?{longValue:r}:{doubleValue:r};case"bigint":return{doubleValue:Number(r)};case"string":return{stringValue:r};case"boolean":return{booleanValue:r};case"object":if(Buffer.isBuffer(r))return{blobValue:r};break}throw"wtf"}var we,tn=class{constructor(e){s(this,we,void 0);u(this,we,e)}createAdapter(){if(t(this,we).mode==="postgres")return new jo;if(t(this,we).mode==="mysql")return new Xo;throw new Error("Unknown mode "+t(this,we).mode)}createDriver(){return new Zo(t(this,we).driver)}createQueryCompiler(){if(t(this,we).mode==="postgres")return new _o;if(t(this,we).mode==="mysql")return new en;throw new Error("Unknown mode "+t(this,we).mode)}createIntrospector(e){if(t(this,we).mode==="postgres")return new Ko(e);if(t(this,we).mode==="mysql")return new $o(e);throw new Error("Unknown mode "+t(this,we).mode)}};we=new WeakMap;var Sa=new hr({dialect:new tn({mode:"postgres",driver:{secretArn:process.env.RDS_SECRET_ARN,resourceArn:process.env.RDS_ARN,database:process.env.RDS_DATABASE,client:new Gs.default}})});var js="todos";async function Da(r){let[e]=await wr.DB.insertInto(js).values({id:r.id,name:r.name,description:r.description}).returningAll().execute();return e}async function Ba(){return await wr.DB.selectFrom(js).selectAll().execute()}async function La(r){let e=JSON.parse(r.body),i={id:(0,Hs.ulid)(),name:e.name,description:e.description};return await wi.create(i),{statusCode:201,body:JSON.stringify({success:"ok"})}}0&&(module.exports={main});
