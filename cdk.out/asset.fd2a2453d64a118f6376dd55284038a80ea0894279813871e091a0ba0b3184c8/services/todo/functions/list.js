"use strict";var Rs=Object.create;var lr=Object.defineProperty;var Fs=Object.getOwnPropertyDescriptor;var Qs=Object.getOwnPropertyNames;var Vs=Object.getPrototypeOf,Ps=Object.prototype.hasOwnProperty;var Us=(r,e,i)=>e in r?lr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i;var Mo=(r,e)=>{for(var i in e)lr(r,i,{get:e[i],enumerable:!0})},Tn=(r,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Qs(e))!Ps.call(r,a)&&a!==i&&lr(r,a,{get:()=>e[a],enumerable:!(n=Fs(e,a))||n.enumerable});return r};var zs=(r,e,i)=>(i=r!=null?Rs(Vs(r)):{},Tn(e||!r||!r.__esModule?lr(i,"default",{value:r,enumerable:!0}):i,r)),Js=r=>Tn(lr({},"__esModule",{value:!0}),r);var Qt=(r,e,i)=>(Us(r,typeof e!="symbol"?e+"":e,i),i),Go=(r,e,i)=>{if(!e.has(r))throw TypeError("Cannot "+i)};var t=(r,e,i)=>(Go(r,e,"read from private field"),i?i.call(r):e.get(r)),s=(r,e,i)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,i)},u=(r,e,i,n)=>(Go(r,e,"write to private field"),n?n.call(r,i):e.set(r,i),i);var h=(r,e,i)=>(Go(r,e,"access private method"),i);var ga={};Mo(ga,{main:()=>xa});module.exports=Js(ga);var hi={};Mo(hi,{Todo:()=>hi,create:()=>ya,list:()=>wa});var cr={};Mo(cr,{DB:()=>Na,SQL:()=>cr});var Ss=zs(require("aws-sdk/clients/rdsdataservice"),1);function fe(r){return typeof r=="string"}function Wn(r){return typeof r=="number"}function ci(r){return typeof r=="boolean"}function li(r){return r===null}function On(r){return r instanceof Date}function qn(r){return typeof r=="bigint"}function ve(r){return typeof r=="function"}function Le(r){return typeof r=="object"&&r!==null}function mi(r){return r[r.length-1]}function o(r){return Object.freeze(r)}function rt(r){return Array.isArray(r)}function mr(r){return r}var y=o({is(r){return r.kind==="IdentifierNode"},create(r){return o({kind:"IdentifierNode",identifier:r})}});var ie=o({is(r){return r.kind==="TableNode"},create(r){return o({kind:"TableNode",table:y.create(r)})},createWithSchema(r,e){return o({kind:"TableNode",schema:y.create(r),table:y.create(e)})}});var L=o({is(r){return r.kind==="AlterTableNode"},create(r){return o({kind:"AlterTableNode",table:ie.create(r)})},cloneWith(r,e){return o({...r,...e})}});var Je=o({is(r){return r.kind==="CreateIndexNode"},create(r){return o({kind:"CreateIndexNode",name:y.create(r)})},cloneWith(r,e){return o({...r,...e})}});var pi=o({is(r){return r.kind==="CreateSchemaNode"},create(r,e){return o({kind:"CreateSchemaNode",schema:y.create(r),...e})},cloneWith(r,e){return o({...r,...e})}});var Oe=o({is(r){return r.kind==="CreateTableNode"},create(r){return o({kind:"CreateTableNode",table:r,columns:o([])})},cloneWithColumn(r,e){return o({...r,columns:o([...r.columns,e])})},cloneWithConstraint(r,e){return o({...r,constraints:r.constraints?o([...r.constraints,e]):o([e])})},cloneWith(r,e){return o({...r,...e})}});var pr=o({is(r){return r.kind==="DropIndexNode"},create(r,e){return o({kind:"DropIndexNode",name:y.create(r),...e})},cloneWith(r,e){return o({...r,...e})}});var fi=o({is(r){return r.kind==="DropSchemaNode"},create(r,e){return o({kind:"DropSchemaNode",schema:y.create(r),...e})},cloneWith(r,e){return o({...r,...e})}});var Ni=o({is(r){return r.kind==="DropTableNode"},create(r,e){return o({kind:"DropTableNode",table:r,...e})},cloneWith(r,e){return o({...r,...e})}});var Re=o({is(r){return r.kind==="AliasNode"},create(r,e){return o({kind:"AliasNode",node:r,alias:e})}});function Ne(r){return Le(r)&&ve(r.toOperationNode)}var Vt=o({is(r){return r.kind==="AndNode"},create(r,e){return o({kind:"AndNode",left:r,right:e})}});var Pt=o({is(r){return r.kind==="OrNode"},create(r,e){return o({kind:"OrNode",left:r,right:e})}});var Ut=o({is(r){return r.kind==="OnNode"},create(r){return o({kind:"OnNode",on:r})},cloneWithFilter(r,e,i){return o({...r,on:e==="And"?Vt.create(r.on,i):Pt.create(r.on,i)})}});var ue=o({is(r){return r.kind==="JoinNode"},create(r,e){return o({kind:"JoinNode",joinType:r,table:e,on:void 0})},createWithOn(r,e,i){return o({kind:"JoinNode",joinType:r,table:e,on:Ut.create(i)})},cloneWithOn(r,e){return o({...r,on:r.on?Ut.cloneWithFilter(r.on,"And",e):Ut.create(e)})},cloneWithOrOn(r,e){return o({...r,on:r.on?Ut.cloneWithFilter(r.on,"Or",e):Ut.create(e)})}});var wt=o({is(r){return r.kind==="FromNode"},create(r){return o({kind:"FromNode",froms:o(r)})},cloneWithFroms(r,e){return o({...r,froms:o([...r.froms,...e])})}});var jo=o({is(r){return r.kind==="GroupByNode"},create(r){return o({kind:"GroupByNode",items:o(r)})},cloneWithItems(r,e){return o({...r,items:o([...r.items,...e])})}});var fr=o({is(r){return r.kind==="HavingNode"},create(r){return o({kind:"HavingNode",having:r})},cloneWithFilter(r,e,i){return o({...r,having:e==="And"?Vt.create(r.having,i):Pt.create(r.having,i)})}});var zt=o({is(r){return r.kind==="OrderByNode"},create(r){return o({kind:"OrderByNode",items:o([r])})},cloneWithItem(r,e){return o({...r,items:o([...r.items,e])})}});var v=o({is(r){return r.kind==="SelectQueryNode"},create(r,e){return o({kind:"SelectQueryNode",from:wt.create(r),...e&&{with:e}})},cloneWithSelections(r,e){return o({...r,selections:r.selections?o([...r.selections,...e]):o(e)})},cloneWithDistinctOnSelections(r,e){return o({...r,distinctOnSelections:r.distinctOnSelections?o([...r.distinctOnSelections,...e]):o(e)})},cloneWithModifier(r,e){return o({...r,modifiers:r.modifiers?o([...r.modifiers,e]):o([e])})},cloneWithOrderByItem(r,e){return o({...r,orderBy:r.orderBy?zt.cloneWithItem(r.orderBy,e):zt.create(e)})},cloneWithGroupByItems(r,e){return o({...r,groupBy:r.groupBy?jo.cloneWithItems(r.groupBy,e):jo.create(e)})},cloneWithLimit(r,e){return o({...r,limit:e})},cloneWithOffset(r,e){return o({...r,offset:e})},cloneWithHaving(r,e){return o({...r,having:r.having?fr.cloneWithFilter(r.having,"And",e):fr.create(e)})},cloneWithOrHaving(r,e){return o({...r,having:r.having?fr.cloneWithFilter(r.having,"Or",e):fr.create(e)})},cloneWithDistinct(r){return o({...r,distinct:!0})},cloneWithUnion(r,e){return o({...r,union:r.union?o([...r.union,e]):o([e])})}});var Nr=o({is(r){return r.kind==="FilterNode"},create(r,e,i){return o({kind:"FilterNode",left:r,op:e,right:i})}});var q=o({is(r){return r.kind==="RawNode"},create(r,e){return o({kind:"RawNode",sqlFragments:o(r),parameters:o(e)})},createWithSql(r){return q.create([r],[])},createWithChild(r){return q.create(["",""],[r])},createWithChildren(r){return q.create(new Array(r.length+1).fill(""),r)}});var In=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","ilike","not ilike","@>","<@","?","?","?&","!<","!>","<=>","!~","~","~*","!~*","exists","not exists","&&","||","@@","@@@","!!","<->"],Ho=o({is(r){return r.kind==="OperatorNode"},create(r){return o({kind:"OperatorNode",operator:r})}});var yi=o({is(r){return r.kind==="ParensNode"},create(r){return o({kind:"ParensNode",node:r})}});var C=o({is(r){return r.kind==="ColumnNode"},create(r){return o({kind:"ColumnNode",column:y.create(r)})}});var Jt=o({is(r){return r.kind==="SelectAllNode"},create(){return o({kind:"SelectAllNode"})}});var xt=o({is(r){return r.kind==="ReferenceNode"},create(r,e){return o({kind:"ReferenceNode",table:r,column:e})},createSelectAll(r){return o({kind:"ReferenceNode",table:ie.create(r),column:Jt.create()})}});var Kt,wi=class{constructor(e){s(this,Kt,void 0);u(this,Kt,e)}get dynamicReference(){return t(this,Kt)}get refType(){}toOperationNode(){return ye(t(this,Kt))}};Kt=new WeakMap;function xi(r){return Le(r)&&Ne(r)&&fe(r.dynamicReference)}function kn(r){return rt(r)?r.map(e=>Ke(e)):[Ke(r)]}function Ke(r){return fe(r)?ye(r):xi(r)?r.toOperationNode():Mt(r)}function ye(r){let e=".";if(r.includes(e)){let i=r.split(e).map(An);if(i.length===3)return Ks(i);if(i.length===2)return Ms(i);throw new Error(`invalid column reference ${r}`)}else return C.create(r)}function En(r){let e=" as ";if(r.includes(e)){let[i,n]=r.split(e).map(An);return Re.create(ye(i),y.create(n))}else return ye(r)}function yr(r){return C.create(r)}function Ks(r){let[e,i,n]=r;return xt.create(ie.createWithSchema(e,i),C.create(n))}function Ms(r){let[e,i]=r;return xt.create(ie.create(e),C.create(i))}function An(r){return r.trim()}var gi=o({is(r){return r.kind==="PrimitiveValueListNode"},create(r){return o({kind:"PrimitiveValueListNode",values:o([...r])})}});var Ci=o({is(r){return r.kind==="ValueListNode"},create(r){return o({kind:"ValueListNode",values:o(r)})}});var Te=o({is(r){return r.kind==="ValueNode"},create(r){return o({kind:"ValueNode",value:r})},createImmediate(r){return o({kind:"ValueNode",value:r,immediate:!0})}});function $o(r){return rt(r)?Gs(r):Me(r)}function Me(r){return wr(r)?Mt(r):Te.create(r)}function Gs(r){return r.some(wr)?Ci.create(r.map(e=>Me(e))):gi.create(r)}function de(r){return _o("where",r)}function Xo(r){return _o("having",r)}function Zo(r){return _o("on",r)}function R(r,e,i){return Nr.create(Ke(r),en(e),Ke(i))}function K(r){return Sn("exists",r)}function M(r){return Sn("not exists",r)}function _o(r,e){if(e.length===3)return js(e[0],e[1],e[2]);if(e.length===1)return $s(r,e[0]);throw Dn(r,e)}function js(r,e,i){return(e==="is"||e==="is not")&&(li(i)||ci(i))?Hs(r,e,i):Nr.create(Ke(r),en(e),$o(i))}function Hs(r,e,i){return Nr.create(Ke(r),en(e),Te.createImmediate(i))}function en(r){if(fe(r)&&In.includes(r))return Ho.create(r);if(Ne(r))return r.toOperationNode();throw new Error(`invalid comparison operator ${JSON.stringify(r)} passed to a filter method`)}function Sn(r,e){return Nr.create(void 0,Ho.create(r),$o(e))}function $s(r,e){if(ve(e))return Ys[r](e);if(Ne(e)){let i=e.toOperationNode();if(q.is(i))return i}throw Dn(r,e)}function Dn(r,e){return new Error(`invalid arguments passed to a '${r}' method: ${JSON.stringify(e)}`)}var Ys=o({where(r){let i=r(Yo()).toOperationNode();if(!i.where)throw new Error("no `where` methods called insided a group callback");return yi.create(i.where.where)},having(r){let i=r(Yo()).toOperationNode();if(!i.having)throw new Error("no `having` methods called insided a group callback");return yi.create(i.having.having)},on(r){let i=r(bi("InnerJoin","table")).toOperationNode();if(!i.on)throw new Error("no `on` methods called insided a group callback");return yi.create(i.on.on)}});function $(r,e){if(e.length===3)return Zs(r,e[0],e[1],e[2]);if(e.length===2)return Xs(r,e[0],e[1]);throw new Error("not implemented")}function Xs(r,e,i){return i(bi(r,e)).toOperationNode()}function Zs(r,e,i,n){return ue.createWithOn(r,Ge(e),R(i,"=",n))}var Gt=o({is(r){return r.kind==="SelectionNode"},create(r){return o({kind:"SelectionNode",selection:r})},createSelectAll(){return o({kind:"SelectionNode",selection:Jt.create()})},createSelectAllFromTable(r){return o({kind:"SelectionNode",selection:xt.createSelectAll(r)})}});function je(r){return rt(r)?r.map(e=>Bn(e)):[Bn(r)]}function Bn(r){return fe(r)?Gt.create(En(r)):xi(r)?Gt.create(r.toOperationNode()):Gt.create(vi(r))}function it(r){return r?Array.isArray(r)?r.map(Ln):[Ln(r)]:[Gt.createSelectAll()]}function Ln(r){if(fe(r))return Gt.createSelectAllFromTable(r);throw new Error(`invalid value selectAll expression: ${JSON.stringify(r)}`)}var we=o({is(r){return r.kind==="InsertQueryNode"},create(r,e){return o({kind:"InsertQueryNode",into:r,...e&&{with:e}})},cloneWith(r,e){return o({...r,...e})}});var gt=o({is(r){return r.kind==="UpdateQueryNode"},create(r,e){return o({kind:"UpdateQueryNode",table:r,...e&&{with:e}})},cloneWithFromItems(r,e){return o({...r,from:r.from?wt.cloneWithFroms(r.from,e):wt.create(e)})},cloneWithUpdates(r,e){return o({...r,updates:r.updates?o([...r.updates,...e]):e})}});var Ct=o({is(r){return r.kind==="DeleteQueryNode"},create(r,e){return o({kind:"DeleteQueryNode",from:wt.create([r]),...e&&{with:e}})},cloneWithOrderByItem(r,e){return o({...r,orderBy:r.orderBy?zt.cloneWithItem(r.orderBy,e):zt.create(e)})},cloneWithLimit(r,e){return o({...r,limit:e})}});var he=o({is(r){return r.kind==="WhereNode"},create(r){return o({kind:"WhereNode",where:r})},cloneWithFilter(r,e,i){return o({...r,where:e==="And"?Vt.create(r.where,i):Pt.create(r.where,i)})}});var tn=o({is(r){return r.kind==="ReturningNode"},create(r){return o({kind:"ReturningNode",selections:o(r)})},cloneWithSelections(r,e){return o({...r,selections:r.selections?o([...r.selections,...e]):o(e)})}});var l=o({is(r){return Ct.is(r)||we.is(r)||gt.is(r)||v.is(r)},cloneWithWhere(r,e){return o({...r,where:r.where?he.cloneWithFilter(r.where,"And",e):he.create(e)})},cloneWithOrWhere(r,e){return o({...r,where:r.where?he.cloneWithFilter(r.where,"Or",e):he.create(e)})},cloneWithJoin(r,e){return o({...r,joins:r.joins?o([...r.joins,e]):o([e])})},cloneWithReturning(r,e){return o({...r,returning:r.returning?tn.cloneWithSelections(r.returning,e):tn.create(e)})}});var Rn=o({is(r){return r.kind==="OrderByItemNode"},create(r,e){return o({kind:"OrderByItemNode",orderBy:r,direction:e})}});function Ti(r,e){return Rn.create(_s(r),ea(e))}function _s(r){return Ke(r)}function ea(r){if(!!r)return r==="asc"||r==="desc"?q.createWithSql(r):r.toOperationNode()}function f(r,e){Object.defineProperties(r.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var Wi=o({is(r){return r.kind==="LimitNode"},create(r){return o({kind:"LimitNode",limit:Te.create(r)})}});var Fn=o({is(r){return r.kind==="OffsetNode"},create(r){return o({kind:"OffsetNode",offset:Te.create(r)})}});var Qn=o({is(r){return r.kind==="GroupByItemNode"},create(r){return o({kind:"GroupByItemNode",groupBy:r})}});function Vn(r){return kn(r).map(Qn.create)}var Oi=o({is(r){return r.kind==="UnionNode"},create(r,e){return o({kind:"UnionNode",union:r,all:e})}});function rn(r,e){return Oi.create(r.toOperationNode(),e)}var Fe=class extends Error{node;constructor(e){super("no result"),this.node=e}};var d,N=class{constructor(e){s(this,d,void 0);u(this,d,o(e))}where(...e){return new N({...t(this,d),queryNode:l.cloneWithWhere(t(this,d).queryNode,de(e))})}whereRef(e,i,n){return new N({...t(this,d),queryNode:l.cloneWithWhere(t(this,d).queryNode,R(e,i,n))})}orWhere(...e){return new N({...t(this,d),queryNode:l.cloneWithOrWhere(t(this,d).queryNode,de(e))})}orWhereRef(e,i,n){return new N({...t(this,d),queryNode:l.cloneWithOrWhere(t(this,d).queryNode,R(e,i,n))})}whereExists(e){return new N({...t(this,d),queryNode:l.cloneWithWhere(t(this,d).queryNode,K(e))})}whereNotExists(e){return new N({...t(this,d),queryNode:l.cloneWithWhere(t(this,d).queryNode,M(e))})}orWhereExists(e){return new N({...t(this,d),queryNode:l.cloneWithOrWhere(t(this,d).queryNode,K(e))})}orWhereNotExists(e){return new N({...t(this,d),queryNode:l.cloneWithOrWhere(t(this,d).queryNode,M(e))})}having(...e){return new N({...t(this,d),queryNode:v.cloneWithHaving(t(this,d).queryNode,Xo(e))})}havingRef(e,i,n){return new N({...t(this,d),queryNode:v.cloneWithHaving(t(this,d).queryNode,R(e,i,n))})}orHaving(...e){return new N({...t(this,d),queryNode:v.cloneWithOrHaving(t(this,d).queryNode,Xo(e))})}orHavingRef(e,i,n){return new N({...t(this,d),queryNode:v.cloneWithOrHaving(t(this,d).queryNode,R(e,i,n))})}havingExists(e){return new N({...t(this,d),queryNode:v.cloneWithHaving(t(this,d).queryNode,K(e))})}havingNotExist(e){return new N({...t(this,d),queryNode:v.cloneWithHaving(t(this,d).queryNode,M(e))})}orHavingExists(e){return new N({...t(this,d),queryNode:v.cloneWithOrHaving(t(this,d).queryNode,K(e))})}orHavingNotExists(e){return new N({...t(this,d),queryNode:v.cloneWithOrHaving(t(this,d).queryNode,M(e))})}select(e){return new N({...t(this,d),queryNode:v.cloneWithSelections(t(this,d).queryNode,je(e))})}distinctOn(e){return new N({...t(this,d),queryNode:v.cloneWithDistinctOnSelections(t(this,d).queryNode,je(e))})}distinct(){return new N({...t(this,d),queryNode:v.cloneWithDistinct(t(this,d).queryNode)})}forUpdate(){return new N({...t(this,d),queryNode:v.cloneWithModifier(t(this,d).queryNode,"ForUpdate")})}forShare(){return new N({...t(this,d),queryNode:v.cloneWithModifier(t(this,d).queryNode,"ForShare")})}forKeyShare(){return new N({...t(this,d),queryNode:v.cloneWithModifier(t(this,d).queryNode,"ForKeyShare")})}forNoKeyUpdate(){return new N({...t(this,d),queryNode:v.cloneWithModifier(t(this,d).queryNode,"ForNoKeyUpdate")})}skipLocked(){return new N({...t(this,d),queryNode:v.cloneWithModifier(t(this,d).queryNode,"SkipLocked")})}noWait(){return new N({...t(this,d),queryNode:v.cloneWithModifier(t(this,d).queryNode,"NoWait")})}selectAll(e){return new N({...t(this,d),queryNode:v.cloneWithSelections(t(this,d).queryNode,it(e))})}innerJoin(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,$("InnerJoin",e))})}leftJoin(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,$("LeftJoin",e))})}rightJoin(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,$("RightJoin",e))})}fullJoin(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,$("FullJoin",e))})}innerJoinLateral(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,$("LateralInnerJoin",e))})}leftJoinLateral(...e){return new N({...t(this,d),queryNode:l.cloneWithJoin(t(this,d).queryNode,$("LateralLeftJoin",e))})}orderBy(e,i){return new N({...t(this,d),queryNode:v.cloneWithOrderByItem(t(this,d).queryNode,Ti(e,i))})}groupBy(e){return new N({...t(this,d),queryNode:v.cloneWithGroupByItems(t(this,d).queryNode,Vn(e))})}limit(e){return new N({...t(this,d),queryNode:v.cloneWithLimit(t(this,d).queryNode,Wi.create(e))})}offset(e){return new N({...t(this,d),queryNode:v.cloneWithOffset(t(this,d).queryNode,Fn.create(e))})}union(e){return new N({...t(this,d),queryNode:v.cloneWithUnion(t(this,d).queryNode,rn(e,!1))})}unionAll(e){return new N({...t(this,d),queryNode:v.cloneWithUnion(t(this,d).queryNode,rn(e,!0))})}call(e){return e(this)}if(e,i){return e?i(this):new N({...t(this,d)})}as(e){return new on(this,e)}castTo(){return new N(t(this,d))}withPlugin(e){return new N({...t(this,d),executor:t(this,d).executor.withPlugin(e)})}toOperationNode(){return t(this,d).executor.transformQuery(t(this,d).queryNode,t(this,d).queryId)}compile(){return t(this,d).executor.compileQuery(this.toOperationNode(),t(this,d).queryId)}async execute(){let e=this.compile(),i=e.query;return(await t(this,d).executor.executeQuery(e,t(this,d).queryId)).rows}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Fe){let i=await this.executeTakeFirst();if(i===void 0)throw new e(this.toOperationNode());return i}},He=N;d=new WeakMap;f(He,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var xr,jt,on=class{constructor(e,i){s(this,xr,void 0);s(this,jt,void 0);u(this,xr,e),u(this,jt,i)}get alias(){return t(this,jt)}toOperationNode(){let e=t(this,xr).toOperationNode();return Re.create(e,y.create(t(this,jt)))}};xr=new WeakMap,jt=new WeakMap;var qi,Ht=class{constructor(){Qt(this,"nodeStack",[]);s(this,qi,o({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),FilterNode:this.transformFilter.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),UnionNode:this.transformUnion.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this)}));Qt(this,"transformNode",e=>{if(!e)return;this.nodeStack.push(e);let i=t(this,qi)[e.kind](e);return this.nodeStack.pop(),o(i)})}transformNodeList(e){return e&&o(e.map(this.transformNode))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOnSelections:this.transformNodeList(e.distinctOnSelections),distinct:e.distinct,joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),modifiers:e.modifiers,limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),union:this.transformNodeList(e.union)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",schema:this.transformNode(e.schema),table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",table:this.transformNode(e.table),column:this.transformNode(e.column)}}transformFilter(e){return{kind:"FilterNode",left:this.transformNode(e.left),op:this.transformNode(e.op),right:this.transformNode(e.right)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:o([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated)}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),expression:this.transformNode(e.expression),unique:e.unique,using:this.transformNode(e.using)}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformUnion(e){return{kind:"UnionNode",union:this.transformNode(e.union),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema)}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),renameColumn:this.transformNode(e.renameColumn),addColumn:this.transformNode(e.addColumn),dropColumn:this.transformNode(e.dropColumn),alterColumn:this.transformNode(e.alterColumn),modifyColumn:this.transformNode(e.modifyColumn),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}};qi=new WeakMap;var Cr,bt,ce,We,ki,Pn,Ei,Un,Ai,zn,vt,gr,Si,Jn,Ii=class extends Ht{constructor(i){super();s(this,ce);s(this,ki);s(this,Ei);s(this,Ai);s(this,vt);s(this,Si);s(this,Cr,void 0);s(this,bt,new Set);u(this,Cr,i)}transformSelectQuery(i){return h(this,ce,We).call(this,i,n=>super.transformSelectQuery(n))}transformInsertQuery(i){return h(this,ce,We).call(this,i,n=>super.transformInsertQuery(n))}transformUpdateQuery(i){return h(this,ce,We).call(this,i,n=>super.transformUpdateQuery(n))}transformDeleteQuery(i){return h(this,ce,We).call(this,i,n=>super.transformDeleteQuery(n))}transformCreateTable(i){return h(this,ce,We).call(this,i,n=>super.transformCreateTable(n))}transformDropTable(i){return h(this,ce,We).call(this,i,n=>super.transformDropTable(n))}transformCreateIndex(i){return h(this,ce,We).call(this,i,n=>super.transformCreateIndex(n))}transformDropIndex(i){return h(this,ce,We).call(this,i,n=>super.transformDropIndex(n))}transformCreateView(i){return h(this,ce,We).call(this,i,n=>super.transformCreateView(n))}transformDropView(i){return h(this,ce,We).call(this,i,n=>super.transformDropView(n))}transformAlterTable(i){return h(this,ce,We).call(this,i,n=>super.transformAlterTable(n))}transformTable(i){let n=super.transformTable(i);return n.schema||!t(this,bt).has(i.table.identifier)?n:{...n,schema:{kind:"IdentifierNode",identifier:t(this,Cr)}}}};Cr=new WeakMap,bt=new WeakMap,ce=new WeakSet,We=function(i,n){let a=h(this,ki,Pn).call(this,i);for(let b of a)t(this,bt).add(b);let c=n(i);for(let b of a)t(this,bt).delete(b);return c},ki=new WeakSet,Pn=function(i){let n=new Set;return"from"in i&&i.from&&h(this,Ei,Un).call(this,i.from.froms,n),"into"in i&&i.into&&h(this,vt,gr).call(this,i.into,n),"table"in i&&i.table&&h(this,vt,gr).call(this,i.table,n),"joins"in i&&i.joins&&h(this,Ai,zn).call(this,i.joins,n),"with"in i&&i.with&&h(this,Si,Jn).call(this,i.with,n),n},Ei=new WeakSet,Un=function(i,n){for(let a of i)h(this,vt,gr).call(this,a,n)},Ai=new WeakSet,zn=function(i,n){for(let a of i)h(this,vt,gr).call(this,a.table,n)},vt=new WeakSet,gr=function(i,n){let a=ie.is(i)?i:Re.is(i)&&ie.is(i.node)?i.node:null;a&&!t(this,bt).has(a.table.identifier)&&n.add(a.table.identifier)},Si=new WeakSet,Jn=function(i,n){for(let a of i.expressions)n.delete(a.name.table.table.identifier)};var br,Qe=class{constructor(e){s(this,br,void 0);u(this,br,new Ii(e))}transformQuery(e){return t(this,br).transformNode(e.node)}async transformResult(e){return e.result}};br=new WeakMap;var Kn=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function Mn(r){let e="";for(let i=0;i<r;++i)e+=ta();return e}function ta(){return Kn[~~(Math.random()*Kn.length)]}function W(){return new nn}var $t,nn=class{constructor(){s(this,$t,void 0)}get queryId(){return t(this,$t)===void 0&&u(this,$t,Mn(8)),t(this,$t)}};$t=new WeakMap;var ra=o([]),Tt,Di,Gn,Yt=class{constructor(e=ra){s(this,Di);s(this,Tt,void 0);u(this,Tt,e)}get plugins(){return t(this,Tt)}transformQuery(e,i){for(let n of t(this,Tt)){let a=n.transformQuery({node:e,queryId:i});if(a.kind===e.kind)e=a;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${a.kind}`].join(" "))}return e}async executeQuery(e,i){return await this.provideConnection(async n=>{let a=await n.executeQuery(e);return h(this,Di,Gn).call(this,a,i)})}};Tt=new WeakMap,Di=new WeakSet,Gn=async function(e,i){for(let n of t(this,Tt))e=await n.transformResult({result:e,queryId:i});return e};var ot=class extends Yt{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new ot([...this.plugins,e])}withPlugins(e){return new ot([...this.plugins,...e])}withPluginAtFront(e){return new ot([e,...this.plugins])}withoutPlugins(){return new ot([])}},Wt=new ot;var X,vr,sn,Bi,jn,Li=class{constructor(e){s(this,vr);s(this,Bi);s(this,X,void 0);u(this,X,o(e))}as(e){return new an(this,e)}castTo(){return new Li({...t(this,X)})}withPlugin(e){return new Li({...t(this,X),plugins:t(this,X).plugins!==void 0?o([...t(this,X).plugins,e]):o([e])})}toOperationNode(){let e=t(this,X).plugins!==void 0?Wt.withPlugins(t(this,X).plugins):Wt;return h(this,vr,sn).call(this,e)}async execute(e){let i=t(this,X).plugins!==void 0?e.getExecutor().withPlugins(t(this,X).plugins):e.getExecutor();return i.executeQuery(h(this,Bi,jn).call(this,i),t(this,X).queryId)}},Y=Li;X=new WeakMap,vr=new WeakSet,sn=function(e){return e.transformQuery(t(this,X).rawNode,t(this,X).queryId)},Bi=new WeakSet,jn=function(e){return e.compileQuery(h(this,vr,sn).call(this,e),t(this,X).queryId)};f(Y,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var Tr,nt,an=class{constructor(e,i){s(this,Tr,void 0);s(this,nt,void 0);u(this,Tr,e),u(this,nt,i)}get alias(){return t(this,nt)}toOperationNode(){return Re.create(t(this,Tr).toOperationNode(),Ne(t(this,nt))?t(this,nt).toOperationNode():y.create(t(this,nt)))}};Tr=new WeakMap,nt=new WeakMap;var st,Xt,Zt=class{constructor(){s(this,st);this.min=this.min.bind(this),this.max=this.max.bind(this),this.avg=this.avg.bind(this),this.sum=this.sum.bind(this),this.count=this.count.bind(this)}max(e){return h(this,st,Xt).call(this,"max",e)}min(e){return h(this,st,Xt).call(this,"min",e)}avg(e){return h(this,st,Xt).call(this,"avg",e)}sum(e){return h(this,st,Xt).call(this,"sum",e)}count(e){return h(this,st,Xt).call(this,"count",e)}};st=new WeakSet,Xt=function(e,i){return new Y({queryId:W(),rawNode:q.create([`${e}(`,")"],[ye(i)])})};var at,un=class{constructor(e){s(this,at,void 0);u(this,at,o(e))}get fn(){return new Zt}selectFrom(e){return new He({queryId:W(),executor:t(this,at).executor,queryNode:v.create(ut(e))})}withSchema(e){return new un({...t(this,at),executor:t(this,at).executor.withPluginAtFront(new Qe(e))})}ref(e){return new Y({queryId:W(),plugins:t(this,at).executor.plugins,rawNode:q.createWithChild(ye(e))})}},Ri=un;at=new WeakMap;var A,qe=class{constructor(e){s(this,A,void 0);u(this,A,o(e))}on(...e){return new qe({...t(this,A),joinNode:ue.cloneWithOn(t(this,A).joinNode,Zo(e))})}orOn(...e){return new qe({...t(this,A),joinNode:ue.cloneWithOrOn(t(this,A).joinNode,Zo(e))})}onRef(e,i,n){return new qe({...t(this,A),joinNode:ue.cloneWithOn(t(this,A).joinNode,R(e,i,n))})}orOnRef(e,i,n){return new qe({...t(this,A),joinNode:ue.cloneWithOrOn(t(this,A).joinNode,R(e,i,n))})}onExists(e){return new qe({...t(this,A),joinNode:ue.cloneWithOn(t(this,A).joinNode,K(e))})}onNotExists(e){return new qe({...t(this,A),joinNode:ue.cloneWithOn(t(this,A).joinNode,M(e))})}orOnExists(e){return new qe({...t(this,A),joinNode:ue.cloneWithOrOn(t(this,A).joinNode,K(e))})}orOnNotExists(e){return new qe({...t(this,A),joinNode:ue.cloneWithOrOn(t(this,A).joinNode,M(e))})}onTrue(){return new qe({...t(this,A),joinNode:ue.cloneWithOn(t(this,A).joinNode,q.createWithSql("true"))})}toOperationNode(){return t(this,A).joinNode}},Wr=qe;A=new WeakMap;f(Wr,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");var Hn=o({is(r){return r.kind==="ValuesNode"},create(r){return o({kind:"ValuesNode",values:o(r)})}});function $n(r){return ia(Array.isArray(r)?r:[r])}function ia(r){let e=oa(r);return[o([...e.keys()].map(C.create)),Hn.create(r.map(i=>na(i,e)))]}function oa(r){let e=new Map;for(let i of r){let n=Object.keys(i);for(let a of n)!e.has(a)&&i[a]!==void 0&&e.set(a,e.size)}return e}function na(r,e){let i=Object.keys(r),n=new Array(e.size).fill(null);for(let a of i){let c=e.get(a),b=r[a];c!==void 0&&(n[c]=b)}return n.some(wr)?Ci.create(n.map(a=>Me(a))):gi.create(n)}var Yn=o({is(r){return r.kind==="ColumnUpdateNode"},create(r,e){return o({kind:"ColumnUpdateNode",column:r,value:e})}});function _t(r){return Object.entries(r).filter(([e,i])=>i!==void 0).map(([e,i])=>Yn.create(C.create(e),Me(i)))}var Xn=o({is(r){return r.kind==="OnDuplicateKeyNode"},create(r){return o({kind:"OnDuplicateKeyNode",updates:r})}});var Or,Fi=class{constructor(e){s(this,Or,void 0);u(this,Or,e)}get insertId(){return t(this,Or)}};Or=new WeakMap;var I=o({is(r){return r.kind==="OnConflictNode"},create(){return o({kind:"OnConflictNode"})},cloneWith(r,e){return o({...r,...e})},cloneWithIndexWhere(r,e){return o({...r,indexWhere:r.indexWhere?he.cloneWithFilter(r.indexWhere,"And",e):he.create(e)})},cloneWithIndexOrWhere(r,e){return o({...r,indexWhere:r.indexWhere?he.cloneWithFilter(r.indexWhere,"Or",e):he.create(e)})},cloneWithUpdateWhere(r,e){return o({...r,updateWhere:r.updateWhere?he.cloneWithFilter(r.updateWhere,"And",e):he.create(e)})},cloneWithUpdateOrWhere(r,e){return o({...r,updateWhere:r.updateWhere?he.cloneWithFilter(r.updateWhere,"Or",e):he.create(e)})}});var g,le=class{constructor(e){s(this,g,void 0);u(this,g,o(e))}column(e){let i=C.create(e);return new le({...t(this,g),onConflictNode:I.cloneWith(t(this,g).onConflictNode,{columns:t(this,g).onConflictNode.columns?o([...t(this,g).onConflictNode.columns,i]):o([i])})})}columns(e){let i=e.map(C.create);return new le({...t(this,g),onConflictNode:I.cloneWith(t(this,g).onConflictNode,{columns:t(this,g).onConflictNode.columns?o([...t(this,g).onConflictNode.columns,...i]):o(i)})})}constraint(e){return new le({...t(this,g),onConflictNode:I.cloneWith(t(this,g).onConflictNode,{constraint:y.create(e)})})}expression(e){return new le({...t(this,g),onConflictNode:I.cloneWith(t(this,g).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new le({...t(this,g),onConflictNode:I.cloneWithIndexWhere(t(this,g).onConflictNode,de(e))})}whereRef(e,i,n){return new le({...t(this,g),onConflictNode:I.cloneWithIndexWhere(t(this,g).onConflictNode,R(e,i,n))})}orWhere(...e){return new le({...t(this,g),onConflictNode:I.cloneWithIndexOrWhere(t(this,g).onConflictNode,de(e))})}orWhereRef(e,i,n){return new le({...t(this,g),onConflictNode:I.cloneWithIndexOrWhere(t(this,g).onConflictNode,R(e,i,n))})}whereExists(e){return new le({...t(this,g),onConflictNode:I.cloneWithIndexWhere(t(this,g).onConflictNode,K(e))})}whereNotExists(e){return new le({...t(this,g),onConflictNode:I.cloneWithIndexWhere(t(this,g).onConflictNode,M(e))})}orWhereExists(e){return new le({...t(this,g),onConflictNode:I.cloneWithIndexOrWhere(t(this,g).onConflictNode,K(e))})}orWhereNotExists(e){return new le({...t(this,g),onConflictNode:I.cloneWithIndexOrWhere(t(this,g).onConflictNode,M(e))})}doNothing(){return new Qi({...t(this,g),onConflictNode:I.cloneWith(t(this,g).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new Vi({...t(this,g),onConflictNode:I.cloneWith(t(this,g).onConflictNode,{updates:_t(e)})})}},qr=le;g=new WeakMap;f(qr,"don't await OnConflictBuilder instances.");var Ir,Qi=class{constructor(e){s(this,Ir,void 0);u(this,Ir,o(e))}toOperationNode(){return t(this,Ir).onConflictNode}};Ir=new WeakMap;f(Qi,"don't await OnConflictDoNothingBuilder instances.");var F,Ve=class{constructor(e){s(this,F,void 0);u(this,F,o(e))}where(...e){return new Ve({...t(this,F),onConflictNode:I.cloneWithUpdateWhere(t(this,F).onConflictNode,de(e))})}whereRef(e,i,n){return new Ve({...t(this,F),onConflictNode:I.cloneWithUpdateWhere(t(this,F).onConflictNode,R(e,i,n))})}orWhere(...e){return new Ve({...t(this,F),onConflictNode:I.cloneWithUpdateOrWhere(t(this,F).onConflictNode,de(e))})}orWhereRef(e,i,n){return new Ve({...t(this,F),onConflictNode:I.cloneWithUpdateOrWhere(t(this,F).onConflictNode,R(e,i,n))})}whereExists(e){return new Ve({...t(this,F),onConflictNode:I.cloneWithUpdateWhere(t(this,F).onConflictNode,K(e))})}whereNotExists(e){return new Ve({...t(this,F),onConflictNode:I.cloneWithUpdateWhere(t(this,F).onConflictNode,M(e))})}orWhereExists(e){return new Ve({...t(this,F),onConflictNode:I.cloneWithUpdateOrWhere(t(this,F).onConflictNode,K(e))})}orWhereNotExists(e){return new Ve({...t(this,F),onConflictNode:I.cloneWithUpdateOrWhere(t(this,F).onConflictNode,M(e))})}toOperationNode(){return t(this,F).onConflictNode}},Vi=Ve;F=new WeakMap;f(Vi,"don't await OnConflictUpdateBuilder instances.");var T,xe=class{constructor(e){s(this,T,void 0);u(this,T,o(e))}values(e){let[i,n]=$n(e);return new xe({...t(this,T),queryNode:we.cloneWith(t(this,T).queryNode,{columns:i,values:n})})}columns(e){return new xe({...t(this,T),queryNode:we.cloneWith(t(this,T).queryNode,{columns:o(e.map(C.create))})})}expression(e){return new xe({...t(this,T),queryNode:we.cloneWith(t(this,T).queryNode,{values:Mt(e)})})}ignore(){return new xe({...t(this,T),queryNode:we.cloneWith(t(this,T).queryNode,{ignore:!0})})}onConflict(e){return new xe({...t(this,T),queryNode:we.cloneWith(t(this,T).queryNode,{onConflict:e(new qr({onConflictNode:I.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new xe({...t(this,T),queryNode:we.cloneWith(t(this,T).queryNode,{onDuplicateKey:Xn.create(_t(e))})})}returning(e){return new xe({...t(this,T),queryNode:l.cloneWithReturning(t(this,T).queryNode,je(e))})}returningAll(){return new xe({...t(this,T),queryNode:l.cloneWithReturning(t(this,T).queryNode,it())})}call(e){return e(this)}if(e,i){return e?i(this):new xe({...t(this,T)})}castTo(){return new xe(t(this,T))}withPlugin(e){return new xe({...t(this,T),executor:t(this,T).executor.withPlugin(e)})}toOperationNode(){return t(this,T).executor.transformQuery(t(this,T).queryNode,t(this,T).queryId)}compile(){return t(this,T).executor.compileQuery(this.toOperationNode(),t(this,T).queryId)}async execute(){let e=this.compile(),i=e.query,n=await t(this,T).executor.executeQuery(e,t(this,T).queryId);return t(this,T).executor.adapter.supportsReturning&&i.returning?n.rows:[new Fi(n.insertId)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Fe){let i=await this.executeTakeFirst();if(i===void 0)throw new e(this.toOperationNode());return i}},kr=xe;T=new WeakMap;f(kr,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var Er,Pi=class{constructor(e){s(this,Er,void 0);u(this,Er,e)}get numDeletedRows(){return t(this,Er)}};Er=new WeakMap;var m,Q=class{constructor(e){s(this,m,void 0);u(this,m,o(e))}where(...e){return new Q({...t(this,m),queryNode:l.cloneWithWhere(t(this,m).queryNode,de(e))})}whereRef(e,i,n){return new Q({...t(this,m),queryNode:l.cloneWithWhere(t(this,m).queryNode,R(e,i,n))})}orWhere(...e){return new Q({...t(this,m),queryNode:l.cloneWithOrWhere(t(this,m).queryNode,de(e))})}orWhereRef(e,i,n){return new Q({...t(this,m),queryNode:l.cloneWithOrWhere(t(this,m).queryNode,R(e,i,n))})}whereExists(e){return new Q({...t(this,m),queryNode:l.cloneWithWhere(t(this,m).queryNode,K(e))})}whereNotExists(e){return new Q({...t(this,m),queryNode:l.cloneWithWhere(t(this,m).queryNode,M(e))})}orWhereExists(e){return new Q({...t(this,m),queryNode:l.cloneWithOrWhere(t(this,m).queryNode,K(e))})}orWhereNotExists(e){return new Q({...t(this,m),queryNode:l.cloneWithOrWhere(t(this,m).queryNode,M(e))})}innerJoin(...e){return new Q({...t(this,m),queryNode:l.cloneWithJoin(t(this,m).queryNode,$("InnerJoin",e))})}leftJoin(...e){return new Q({...t(this,m),queryNode:l.cloneWithJoin(t(this,m).queryNode,$("LeftJoin",e))})}rightJoin(...e){return new Q({...t(this,m),queryNode:l.cloneWithJoin(t(this,m).queryNode,$("RightJoin",e))})}fullJoin(...e){return new Q({...t(this,m),queryNode:l.cloneWithJoin(t(this,m).queryNode,$("FullJoin",e))})}returning(e){return new Q({...t(this,m),queryNode:l.cloneWithReturning(t(this,m).queryNode,je(e))})}returningAll(){return new Q({...t(this,m),queryNode:l.cloneWithReturning(t(this,m).queryNode,it())})}orderBy(e,i){return new Q({...t(this,m),queryNode:Ct.cloneWithOrderByItem(t(this,m).queryNode,Ti(e,i))})}limit(e){return new Q({...t(this,m),queryNode:Ct.cloneWithLimit(t(this,m).queryNode,Wi.create(e))})}call(e){return e(this)}if(e,i){return e?i(this):new Q({...t(this,m)})}castTo(){return new Q(t(this,m))}withPlugin(e){return new Q({...t(this,m),executor:t(this,m).executor.withPlugin(e)})}toOperationNode(){return t(this,m).executor.transformQuery(t(this,m).queryNode,t(this,m).queryId)}compile(){return t(this,m).executor.compileQuery(this.toOperationNode(),t(this,m).queryId)}async execute(){let e=this.compile(),i=e.query,n=await t(this,m).executor.executeQuery(e,t(this,m).queryId);return t(this,m).executor.adapter.supportsReturning&&i.returning?n.rows:[new Pi(n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Fe){let i=await this.executeTakeFirst();if(i===void 0)throw new e(this.toOperationNode());return i}},Ar=Q;m=new WeakMap;f(Ar,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var Sr,Ui=class{constructor(e){s(this,Sr,void 0);u(this,Sr,e)}get numUpdatedRows(){return t(this,Sr)}};Sr=new WeakMap;var p,V=class{constructor(e){s(this,p,void 0);u(this,p,o(e))}where(...e){return new V({...t(this,p),queryNode:l.cloneWithWhere(t(this,p).queryNode,de(e))})}whereRef(e,i,n){return new V({...t(this,p),queryNode:l.cloneWithWhere(t(this,p).queryNode,R(e,i,n))})}orWhere(...e){return new V({...t(this,p),queryNode:l.cloneWithOrWhere(t(this,p).queryNode,de(e))})}orWhereRef(e,i,n){return new V({...t(this,p),queryNode:l.cloneWithOrWhere(t(this,p).queryNode,R(e,i,n))})}whereExists(e){return new V({...t(this,p),queryNode:l.cloneWithWhere(t(this,p).queryNode,K(e))})}whereNotExists(e){return new V({...t(this,p),queryNode:l.cloneWithWhere(t(this,p).queryNode,M(e))})}orWhereExists(e){return new V({...t(this,p),queryNode:l.cloneWithOrWhere(t(this,p).queryNode,K(e))})}orWhereNotExists(e){return new V({...t(this,p),queryNode:l.cloneWithOrWhere(t(this,p).queryNode,M(e))})}from(e){return new V({...t(this,p),queryNode:gt.cloneWithFromItems(t(this,p).queryNode,ut(e))})}innerJoin(...e){return new V({...t(this,p),queryNode:l.cloneWithJoin(t(this,p).queryNode,$("InnerJoin",e))})}leftJoin(...e){return new V({...t(this,p),queryNode:l.cloneWithJoin(t(this,p).queryNode,$("LeftJoin",e))})}rightJoin(...e){return new V({...t(this,p),queryNode:l.cloneWithJoin(t(this,p).queryNode,$("RightJoin",e))})}fullJoin(...e){return new V({...t(this,p),queryNode:l.cloneWithJoin(t(this,p).queryNode,$("FullJoin",e))})}set(e){return new V({...t(this,p),queryNode:gt.cloneWithUpdates(t(this,p).queryNode,_t(e))})}returning(e){return new V({...t(this,p),queryNode:l.cloneWithReturning(t(this,p).queryNode,je(e))})}returningAll(){return new V({...t(this,p),queryNode:l.cloneWithReturning(t(this,p).queryNode,it())})}call(e){return e(this)}if(e,i){return e?i(this):new V({...t(this,p)})}castTo(){return new V(t(this,p))}withPlugin(e){return new V({...t(this,p),executor:t(this,p).executor.withPlugin(e)})}toOperationNode(){return t(this,p).executor.transformQuery(t(this,p).queryNode,t(this,p).queryId)}compile(){return t(this,p).executor.compileQuery(this.toOperationNode(),t(this,p).queryId)}async execute(){let e=this.compile(),i=e.query,n=await t(this,p).executor.executeQuery(e,t(this,p).queryId);return t(this,p).executor.adapter.supportsReturning&&i.returning?n.rows:[new Ui(n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Fe){let i=await this.executeTakeFirst();if(i===void 0)throw new e(this.toOperationNode());return i}},Dr=V;p=new WeakMap;f(Dr,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var Zn=o({is(r){return r.kind==="CommonTableExpressionNode"},create(r,e){return o({kind:"CommonTableExpressionNode",name:r,expression:e})}});var dn=o({is(r){return r.kind==="CommonTableExpressionNameNode"},create(r,e){return o({kind:"CommonTableExpressionNameNode",table:ie.create(r),columns:e?o(e.map(C.create)):void 0})}});function hn(r,e){let i=e(_n());return Zn.create(sa(r),i.toOperationNode())}function sa(r){if(r.includes("(")){let e=r.split(/[\(\)]/),i=e[0],n=e[1].split(",").map(a=>a.trim());return dn.create(i,n)}else return dn.create(r)}var Br=o({is(r){return r.kind==="WithNode"},create(r,e){return o({kind:"WithNode",expressions:o([r]),...e})},cloneWithExpression(r,e){return o({...r,expressions:o([...r.expressions,e])})}});var E,Ot=class{constructor(e){s(this,E,void 0);u(this,E,o(e))}selectFrom(e){return new He({queryId:W(),executor:t(this,E).executor,queryNode:v.create(ut(e),t(this,E).withNode)})}insertInto(e){return new kr({queryId:W(),executor:t(this,E).executor,queryNode:we.create(j(e),t(this,E).withNode)})}deleteFrom(e){return new Ar({queryId:W(),executor:t(this,E).executor,queryNode:Ct.create(Ge(e),t(this,E).withNode)})}updateTable(e){return new Dr({queryId:W(),executor:t(this,E).executor,queryNode:gt.create(Ge(e),t(this,E).withNode)})}with(e,i){let n=hn(e,i);return new Ot({...t(this,E),withNode:t(this,E).withNode?Br.cloneWithExpression(t(this,E).withNode,n):Br.create(n)})}withRecursive(e,i){let n=hn(e,i);return new Ot({...t(this,E),withNode:t(this,E).withNode?Br.cloneWithExpression(t(this,E).withNode,n):Br.create(n,{recursive:!0})})}withPlugin(e){return new Ot({...t(this,E),executor:t(this,E).executor.withPlugin(e)})}withoutPlugins(){return new Ot({...t(this,E),executor:t(this,E).executor.withoutPlugins()})}withSchema(e){return new Ot({...t(this,E),executor:t(this,E).executor.withPluginAtFront(new Qe(e))})}},er=Ot;E=new WeakMap;function Yo(){return new He({queryId:W(),executor:Wt,queryNode:v.create(ut([]))})}function cn(){return new Ri({executor:Wt})}function _n(){return new er({executor:Wt})}function bi(r,e){return new Wr({joinNode:ue.create(r,Ge(e))})}function Mt(r){if(Ne(r))return r.toOperationNode();if(ve(r))return r(cn()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(r)}`)}function vi(r){if(Ne(r))return r.toOperationNode();if(ve(r))return r(cn()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(r)}`)}function wr(r){return Ne(r)||ve(r)}function ut(r){return rt(r)?r.map(e=>Ge(e)):[Ge(r)]}function Ge(r){return fe(r)?aa(r):vi(r)}function aa(r){let e=" as ";if(r.includes(e)){let[i,n]=r.split(e).map(es);return Re.create(j(i),y.create(n))}else return j(r)}function j(r){let e=".";if(r.includes(e)){let[i,n]=r.split(e).map(es);return ie.createWithSchema(i,n)}else return ie.create(r)}function es(r){return r.trim()}var ts=o({is(r){return r.kind==="AddColumnNode"},create(r){return o({kind:"AddColumnNode",column:r})}});var qt=o({is(r){return r.kind==="AlterColumnNode"},create(r){return o({kind:"AlterColumnNode",column:C.create(r)})},cloneWith(r,e){return o({...r,...e})}});var P=o({is(r){return r.kind==="ColumnDefinitionNode"},create(r,e){return o({kind:"ColumnDefinitionNode",column:C.create(r),dataType:e})},cloneWith(r,e){return o({...r,...e})}});var zi=o({is(r){return r.kind==="DataTypeNode"},create(r){return o({kind:"DataTypeNode",dataType:r})}});var rs=o({is(r){return r.kind==="DropColumnNode"},create(r){return o({kind:"DropColumnNode",column:C.create(r)})}});var is=o({is(r){return r.kind==="RenameColumnNode"},create(r,e){return o({kind:"RenameColumnNode",column:C.create(r),renameTo:C.create(e)})}});var tr=o({is(r){return r.kind==="CheckConstraintNode"},create(r,e){return o({kind:"CheckConstraintNode",expression:r,name:e?y.create(e):void 0})}});var rr=o({is(r){return r.kind==="ReferencesNode"},create(r,e){return o({kind:"ReferencesNode",table:r,columns:o([...e])})},cloneWithOnDelete(r,e){return o({...r,onDelete:e})},cloneWithOnUpdate(r,e){return o({...r,onUpdate:e})}});function Ji(r){return r instanceof Y?r.toOperationNode():Te.createImmediate(r)}var Lr=o({is(r){return r.kind==="GeneratedNode"},create(r){return o({kind:"GeneratedNode",...r})},createWithExpression(r){return o({kind:"GeneratedNode",always:!0,expression:r})},cloneWith(r,e){return o({...r,...e})}});var os=o({is(r){return r.kind==="DefaultValueNode"},create(r){return o({kind:"DefaultValueNode",defaultValue:r})}});var k,Z=class{constructor(e){s(this,k,void 0);u(this,k,e)}autoIncrement(){return new Z(P.cloneWith(t(this,k),{autoIncrement:!0}))}primaryKey(){return new Z(P.cloneWith(t(this,k),{primaryKey:!0}))}references(e){let i=ye(e);if(!xt.is(i)||Jt.is(i.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new Z(P.cloneWith(t(this,k),{references:rr.create(i.table,[i.column])}))}onDelete(e){if(!t(this,k).references)throw new Error("on delete constraint can only be added for foreign keys");return new Z(P.cloneWith(t(this,k),{references:rr.cloneWithOnDelete(t(this,k).references,e)}))}onUpdate(e){if(!t(this,k).references)throw new Error("on update constraint can only be added for foreign keys");return new Z(P.cloneWith(t(this,k),{references:rr.cloneWithOnUpdate(t(this,k).references,e)}))}unique(){return new Z(P.cloneWith(t(this,k),{unique:!0}))}notNull(){return new Z(P.cloneWith(t(this,k),{notNull:!0}))}unsigned(){return new Z(P.cloneWith(t(this,k),{unsigned:!0}))}defaultTo(e){return new Z(P.cloneWith(t(this,k),{defaultTo:os.create(Ji(e))}))}check(e){return new Z(P.cloneWith(t(this,k),{check:tr.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new Z(P.cloneWith(t(this,k),{generated:Lr.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new Z(P.cloneWith(t(this,k),{generated:Lr.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new Z(P.cloneWith(t(this,k),{generated:Lr.create({identity:!0,byDefault:!0})}))}stored(){if(!t(this,k).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new Z(P.cloneWith(t(this,k),{generated:Lr.cloneWith(t(this,k).generated,{stored:!0})}))}toOperationNode(){return t(this,k)}},dt=Z;k=new WeakMap;f(dt,"don't await ColumnDefinitionBuilder instances directly.");var ns=o({is(r){return r.kind==="ModifyColumnNode"},create(r){return o({kind:"ModifyColumnNode",column:r})}});function Rr(r){return Ne(r)?r.toOperationNode():zi.create(r)}var It=o({is(r){return r.kind==="ForeignKeyConstraintNode"},create(r,e,i,n){return o({kind:"ForeignKeyConstraintNode",columns:r,references:rr.create(e,i),name:n?y.create(n):void 0})},cloneWith(r,e){return o({...r,...e})}});var kt,Ki=class{constructor(e){s(this,kt,void 0);u(this,kt,e)}onDelete(e){return new Ki(It.cloneWith(t(this,kt),{onDelete:e}))}onUpdate(e){return new Ki(It.cloneWith(t(this,kt),{onUpdate:e}))}toOperationNode(){return t(this,kt)}},Et=Ki;kt=new WeakMap;f(Et,"don't await ForeignKeyConstraintBuilder instances directly.");var Mi=o({is(r){return r.kind==="AddConstraintNode"},create(r){return o({kind:"AddConstraintNode",constraint:r})}});var Gi=o({is(r){return r.kind==="UniqueConstraintNode"},create(r,e){return o({kind:"UniqueConstraintNode",columns:o(r.map(C.create)),name:e?y.create(e):void 0})}});var Fr=o({is(r){return r.kind==="DropConstraintNode"},create(r){return o({kind:"DropConstraintNode",constraintName:y.create(r)})},cloneWith(r,e){return o({...r,...e})}});var B,Vr=class{constructor(e){s(this,B,void 0);u(this,B,o(e))}renameTo(e){return new me({...t(this,B),alterTableNode:L.cloneWith(t(this,B).alterTableNode,{renameTo:j(e)})})}setSchema(e){return new me({...t(this,B),alterTableNode:L.cloneWith(t(this,B).alterTableNode,{setSchema:y.create(e)})})}alterColumn(e){return new ji({...t(this,B),alterColumnNode:qt.create(e)})}dropColumn(e){return new me({...t(this,B),alterTableNode:L.cloneWith(t(this,B).alterTableNode,{dropColumn:rs.create(e)})})}renameColumn(e,i){return new me({...t(this,B),alterTableNode:L.cloneWith(t(this,B).alterTableNode,{renameColumn:is.create(e,i)})})}addColumn(e,i,n=mr){return n(new Hi({...t(this,B),columnBuilder:new dt(P.create(e,Rr(i)))}))}modifyColumn(e,i){return new $i({...t(this,B),columnBuilder:new dt(P.create(e,Rr(i)))})}addUniqueConstraint(e,i){return new me({...t(this,B),alterTableNode:L.cloneWith(t(this,B).alterTableNode,{addConstraint:Mi.create(Gi.create(i,e))})})}addCheckConstraint(e,i){return new me({...t(this,B),alterTableNode:L.cloneWith(t(this,B).alterTableNode,{addConstraint:Mi.create(tr.create(i.toOperationNode(),e))})})}addForeignKeyConstraint(e,i,n,a){return new Yi({...t(this,B),constraintBuilder:new Et(It.create(i.map(C.create),j(n),a.map(C.create),e))})}dropConstraint(e){return new Xi({...t(this,B),alterTableNode:L.cloneWith(t(this,B).alterTableNode,{dropConstraint:Fr.create(e)})})}};B=new WeakMap;var G,ji=class{constructor(e){s(this,G,void 0);u(this,G,o(e))}setDataType(e){return new me({...t(this,G),alterTableNode:L.cloneWith(t(this,G).alterTableNode,{alterColumn:qt.cloneWith(t(this,G).alterColumnNode,{dataType:zi.create(e)})})})}setDefault(e){return new me({...t(this,G),alterTableNode:L.cloneWith(t(this,G).alterTableNode,{alterColumn:qt.cloneWith(t(this,G).alterColumnNode,{setDefault:Ji(e)})})})}dropDefault(){return new me({...t(this,G),alterTableNode:L.cloneWith(t(this,G).alterTableNode,{alterColumn:qt.cloneWith(t(this,G).alterColumnNode,{dropDefault:!0})})})}setNotNull(){return new me({...t(this,G),alterTableNode:L.cloneWith(t(this,G).alterTableNode,{alterColumn:qt.cloneWith(t(this,G).alterColumnNode,{setNotNull:!0})})})}dropNotNull(){return new me({...t(this,G),alterTableNode:L.cloneWith(t(this,G).alterTableNode,{alterColumn:qt.cloneWith(t(this,G).alterColumnNode,{dropNotNull:!0})})})}};G=new WeakMap;var Ie,me=class{constructor(e){s(this,Ie,void 0);u(this,Ie,o(e))}toOperationNode(){return t(this,Ie).executor.transformQuery(t(this,Ie).alterTableNode,t(this,Ie).queryId)}compile(){return t(this,Ie).executor.compileQuery(this.toOperationNode(),t(this,Ie).queryId)}async execute(){await t(this,Ie).executor.executeQuery(this.compile(),t(this,Ie).queryId)}};Ie=new WeakMap;var w,_=class{constructor(e){s(this,w,void 0);u(this,w,o(e))}autoIncrement(){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.autoIncrement()})}primaryKey(){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.primaryKey()})}references(e){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.references(e)})}onDelete(e){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.onDelete(e)})}onUpdate(e){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.onUpdate(e)})}unique(){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.unique()})}notNull(){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.notNull()})}unsigned(){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.unsigned()})}defaultTo(e){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.defaultTo(e)})}check(e){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.check(e)})}generatedAlwaysAs(e){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.generatedAlwaysAs(e)})}generatedAlwaysAsIdentity(){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.generatedAlwaysAsIdentity()})}generatedByDefaultAsIdentity(){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.generatedByDefaultAsIdentity()})}stored(){return new _({...t(this,w),columnBuilder:t(this,w).columnBuilder.stored()})}toOperationNode(){return t(this,w).executor.transformQuery(L.cloneWith(t(this,w).alterTableNode,{addColumn:ts.create(t(this,w).columnBuilder.toOperationNode())}),t(this,w).queryId)}compile(){return t(this,w).executor.compileQuery(this.toOperationNode(),t(this,w).queryId)}async execute(){await t(this,w).executor.executeQuery(this.compile(),t(this,w).queryId)}},Hi=_;w=new WeakMap;var x,ee=class{constructor(e){s(this,x,void 0);u(this,x,o(e))}autoIncrement(){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.autoIncrement()})}primaryKey(){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.primaryKey()})}references(e){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.references(e)})}onDelete(e){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.onDelete(e)})}onUpdate(e){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.onUpdate(e)})}unique(){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.unique()})}notNull(){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.notNull()})}unsigned(){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.unsigned()})}defaultTo(e){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.defaultTo(e)})}check(e){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.check(e)})}generatedAlwaysAs(e){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.generatedAlwaysAs(e)})}generatedAlwaysAsIdentity(){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.generatedAlwaysAsIdentity()})}generatedByDefaultAsIdentity(){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.generatedByDefaultAsIdentity()})}stored(){return new ee({...t(this,x),columnBuilder:t(this,x).columnBuilder.stored()})}toOperationNode(){return t(this,x).executor.transformQuery(L.cloneWith(t(this,x).alterTableNode,{modifyColumn:ns.create(t(this,x).columnBuilder.toOperationNode())}),t(this,x).queryId)}compile(){return t(this,x).executor.compileQuery(this.toOperationNode(),t(this,x).queryId)}async execute(){await t(this,x).executor.executeQuery(this.compile(),t(this,x).queryId)}},$i=ee;x=new WeakMap;var te,Zi=class{constructor(e){s(this,te,void 0);u(this,te,o(e))}onDelete(e){return new Zi({...t(this,te),constraintBuilder:t(this,te).constraintBuilder.onDelete(e)})}onUpdate(e){return new Zi({...t(this,te),constraintBuilder:t(this,te).constraintBuilder.onUpdate(e)})}toOperationNode(){return t(this,te).executor.transformQuery(L.cloneWith(t(this,te).alterTableNode,{addConstraint:Mi.create(t(this,te).constraintBuilder.toOperationNode())}),t(this,te).queryId)}compile(){return t(this,te).executor.compileQuery(this.toOperationNode(),t(this,te).queryId)}async execute(){await t(this,te).executor.executeQuery(this.compile(),t(this,te).queryId)}},Yi=Zi;te=new WeakMap;var U,Qr=class{constructor(e){s(this,U,void 0);u(this,U,o(e))}ifExists(){return new Qr({...t(this,U),alterTableNode:L.cloneWith(t(this,U).alterTableNode,{dropConstraint:Fr.cloneWith(t(this,U).alterTableNode.dropConstraint,{ifExists:!0})})})}cascade(){return new Qr({...t(this,U),alterTableNode:L.cloneWith(t(this,U).alterTableNode,{dropConstraint:Fr.cloneWith(t(this,U).alterTableNode.dropConstraint,{modifier:"cascade"})})})}restrict(){return new Qr({...t(this,U),alterTableNode:L.cloneWith(t(this,U).alterTableNode,{dropConstraint:Fr.cloneWith(t(this,U).alterTableNode.dropConstraint,{modifier:"restrict"})})})}toOperationNode(){return t(this,U).executor.transformQuery(t(this,U).alterTableNode,t(this,U).queryId)}compile(){return t(this,U).executor.compileQuery(this.toOperationNode(),t(this,U).queryId)}async execute(){await t(this,U).executor.executeQuery(this.compile(),t(this,U).queryId)}},Xi=Qr;U=new WeakMap;f(Vr,"don't await AlterTableBuilder instances");f(ji,"don't await AlterColumnBuilder instances");f(me,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");f(Hi,"don't await AlterTableAddColumnBuilder instances directly. To execute the query you need to call `execute`");f($i,"don't await AlterTableModifyColumnBuilder instances directly. To execute the query you need to call `execute`");f(Yi,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");f(Xi,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");var ss=o({is(r){return r.kind==="ListNode"},create(r){return o({kind:"ListNode",items:o(r)})}});var S,ht=class{constructor(e){s(this,S,void 0);u(this,S,o(e))}unique(){return new ht({...t(this,S),createIndexNode:Je.cloneWith(t(this,S).createIndexNode,{unique:!0})})}on(e){return new ht({...t(this,S),createIndexNode:Je.cloneWith(t(this,S).createIndexNode,{table:j(e)})})}column(e){return new ht({...t(this,S),createIndexNode:Je.cloneWith(t(this,S).createIndexNode,{expression:yr(e)})})}columns(e){return new ht({...t(this,S),createIndexNode:Je.cloneWith(t(this,S).createIndexNode,{expression:ss.create(e.map(yr))})})}expression(e){return new ht({...t(this,S),createIndexNode:Je.cloneWith(t(this,S).createIndexNode,{expression:e.toOperationNode()})})}using(e){return new ht({...t(this,S),createIndexNode:Je.cloneWith(t(this,S).createIndexNode,{using:q.createWithSql(e)})})}toOperationNode(){return t(this,S).executor.transformQuery(t(this,S).createIndexNode,t(this,S).queryId)}compile(){return t(this,S).executor.compileQuery(this.toOperationNode(),t(this,S).queryId)}async execute(){await t(this,S).executor.executeQuery(this.compile(),t(this,S).queryId)}},Pr=ht;S=new WeakMap;f(Pr,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var ge,ln=class{constructor(e){s(this,ge,void 0);u(this,ge,o(e))}ifNotExists(){return new ln({...t(this,ge),createSchemaNode:pi.cloneWith(t(this,ge).createSchemaNode,{ifNotExists:!0})})}toOperationNode(){return t(this,ge).executor.transformQuery(t(this,ge).createSchemaNode,t(this,ge).queryId)}compile(){return t(this,ge).executor.compileQuery(this.toOperationNode(),t(this,ge).queryId)}async execute(){await t(this,ge).executor.executeQuery(this.compile(),t(this,ge).queryId)}},Ur=ln;ge=new WeakMap;f(Ur,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");var as=o({is(r){return r.kind==="PrimaryKeyConstraintNode"},create(r,e){return o({kind:"PrimaryKeyConstraintNode",columns:o(r.map(C.create)),name:e?y.create(e):void 0})}});var O,Pe=class{constructor(e){s(this,O,void 0);u(this,O,o(e))}temporary(){return new Pe({...t(this,O),createTableNode:Oe.cloneWith(t(this,O).createTableNode,{temporary:!0})})}onCommit(e){return new Pe({...t(this,O),createTableNode:Oe.cloneWith(t(this,O).createTableNode,{onCommit:e})})}ifNotExists(){return new Pe({...t(this,O),createTableNode:Oe.cloneWith(t(this,O).createTableNode,{ifNotExists:!0})})}addColumn(e,i,n=mr){let a=n(new dt(P.create(e,Rr(i))));return new Pe({...t(this,O),createTableNode:Oe.cloneWithColumn(t(this,O).createTableNode,a.toOperationNode())})}addPrimaryKeyConstraint(e,i){return new Pe({...t(this,O),createTableNode:Oe.cloneWithConstraint(t(this,O).createTableNode,as.create(i,e))})}addUniqueConstraint(e,i){return new Pe({...t(this,O),createTableNode:Oe.cloneWithConstraint(t(this,O).createTableNode,Gi.create(i,e))})}addCheckConstraint(e,i){return new Pe({...t(this,O),createTableNode:Oe.cloneWithConstraint(t(this,O).createTableNode,tr.create(i.toOperationNode(),e))})}addForeignKeyConstraint(e,i,n,a,c=mr){let b=c(new Et(It.create(i.map(C.create),j(n),a.map(C.create),e)));return new Pe({...t(this,O),createTableNode:Oe.cloneWithConstraint(t(this,O).createTableNode,b.toOperationNode())})}toOperationNode(){return t(this,O).executor.transformQuery(t(this,O).createTableNode,t(this,O).queryId)}compile(){return t(this,O).executor.compileQuery(this.toOperationNode(),t(this,O).queryId)}async execute(){await t(this,O).executor.executeQuery(this.compile(),t(this,O).queryId)}},zr=Pe;O=new WeakMap;f(zr,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var oe,_i=class{constructor(e){s(this,oe,void 0);u(this,oe,o(e))}on(e){return new _i({...t(this,oe),dropIndexNode:pr.cloneWith(t(this,oe).dropIndexNode,{table:j(e)})})}ifExists(){return new _i({...t(this,oe),dropIndexNode:pr.cloneWith(t(this,oe).dropIndexNode,{ifExists:!0})})}toOperationNode(){return t(this,oe).executor.transformQuery(t(this,oe).dropIndexNode,t(this,oe).queryId)}compile(){return t(this,oe).executor.compileQuery(this.toOperationNode(),t(this,oe).queryId)}async execute(){await t(this,oe).executor.executeQuery(this.compile(),t(this,oe).queryId)}},Jr=_i;oe=new WeakMap;f(Jr,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var Ce,mn=class{constructor(e){s(this,Ce,void 0);u(this,Ce,o(e))}ifExists(){return new mn({...t(this,Ce),dropSchemaNode:fi.cloneWith(t(this,Ce).dropSchemaNode,{ifExists:!0})})}toOperationNode(){return t(this,Ce).executor.transformQuery(t(this,Ce).dropSchemaNode,t(this,Ce).queryId)}compile(){return t(this,Ce).executor.compileQuery(this.toOperationNode(),t(this,Ce).queryId)}async execute(){await t(this,Ce).executor.executeQuery(this.compile(),t(this,Ce).queryId)}},Kr=mn;Ce=new WeakMap;f(Kr,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var be,pn=class{constructor(e){s(this,be,void 0);u(this,be,o(e))}ifExists(){return new pn({...t(this,be),dropTableNode:Ni.cloneWith(t(this,be).dropTableNode,{ifExists:!0})})}toOperationNode(){return t(this,be).executor.transformQuery(t(this,be).dropTableNode,t(this,be).queryId)}compile(){return t(this,be).executor.compileQuery(this.toOperationNode(),t(this,be).queryId)}async execute(){await t(this,be).executor.executeQuery(this.compile(),t(this,be).queryId)}},Mr=pn;be=new WeakMap;f(Mr,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");var ke=o({is(r){return r.kind==="CreateViewNode"},create(r){return o({kind:"CreateViewNode",name:y.create(r)})},cloneWith(r,e){return o({...r,...e})}});var eo=class extends Ht{transformValue(e){return{...super.transformValue(e),immediate:!0}}};var ro,to=class{constructor(){s(this,ro,new eo)}transformQuery(e){return t(this,ro).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}};ro=new WeakMap;var D,ct=class{constructor(e){s(this,D,void 0);u(this,D,o(e))}temporary(){return new ct({...t(this,D),createViewNode:ke.cloneWith(t(this,D).createViewNode,{temporary:!0})})}materialized(){return new ct({...t(this,D),createViewNode:ke.cloneWith(t(this,D).createViewNode,{materialized:!0})})}ifNotExists(){return new ct({...t(this,D),createViewNode:ke.cloneWith(t(this,D).createViewNode,{ifNotExists:!0})})}orReplace(){return new ct({...t(this,D),createViewNode:ke.cloneWith(t(this,D).createViewNode,{orReplace:!0})})}columns(e){return new ct({...t(this,D),createViewNode:ke.cloneWith(t(this,D).createViewNode,{columns:e.map(yr)})})}as(e){let i=e.withPlugin(new to).toOperationNode();return new ct({...t(this,D),createViewNode:ke.cloneWith(t(this,D).createViewNode,{as:i})})}toOperationNode(){return t(this,D).executor.transformQuery(t(this,D).createViewNode,t(this,D).queryId)}compile(){return t(this,D).executor.compileQuery(this.toOperationNode(),t(this,D).queryId)}async execute(){await t(this,D).executor.executeQuery(this.compile(),t(this,D).queryId)}},Gr=ct;D=new WeakMap;f(Gr,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");var jr=o({is(r){return r.kind==="DropViewNode"},create(r){return o({kind:"DropViewNode",name:y.create(r)})},cloneWith(r,e){return o({...r,...e})}});var ne,io=class{constructor(e){s(this,ne,void 0);u(this,ne,o(e))}materialized(){return new io({...t(this,ne),dropViewNode:jr.cloneWith(t(this,ne).dropViewNode,{materialized:!0})})}ifExists(){return new io({...t(this,ne),dropViewNode:jr.cloneWith(t(this,ne).dropViewNode,{ifExists:!0})})}toOperationNode(){return t(this,ne).executor.transformQuery(t(this,ne).dropViewNode,t(this,ne).queryId)}compile(){return t(this,ne).executor.compileQuery(this.toOperationNode(),t(this,ne).queryId)}async execute(){await t(this,ne).executor.executeQuery(this.compile(),t(this,ne).queryId)}},Hr=io;ne=new WeakMap;f(Hr,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");var re,$r=class{constructor(e){s(this,re,void 0);u(this,re,e)}createTable(e){return new zr({queryId:W(),executor:t(this,re),createTableNode:Oe.create(j(e))})}dropTable(e){return new Mr({queryId:W(),executor:t(this,re),dropTableNode:Ni.create(j(e))})}createIndex(e){return new Pr({queryId:W(),executor:t(this,re),createIndexNode:Je.create(e)})}dropIndex(e){return new Jr({queryId:W(),executor:t(this,re),dropIndexNode:pr.create(e)})}createSchema(e){return new Ur({queryId:W(),executor:t(this,re),createSchemaNode:pi.create(e)})}dropSchema(e){return new Kr({queryId:W(),executor:t(this,re),dropSchemaNode:fi.create(e)})}alterTable(e){return new Vr({queryId:W(),executor:t(this,re),alterTableNode:L.create(e)})}createView(e){return new Gr({queryId:W(),executor:t(this,re),createViewNode:ke.create(e)})}dropView(e){return new Hr({queryId:W(),executor:t(this,re),dropViewNode:jr.create(e)})}withPlugin(e){return new $r(t(this,re).withPlugin(e))}withoutPlugins(){return new $r(t(this,re).withoutPlugins())}withSchema(e){return new $r(t(this,re).withPluginAtFront(new Qe(e)))}},oo=$r;re=new WeakMap;var no=class{ref(e){return new wi(e)}};var ir,so=class{constructor(e){s(this,ir,void 0);u(this,ir,e)}async provideConnection(e){let i=await t(this,ir).acquireConnection();try{return await e(i)}finally{await t(this,ir).releaseConnection(i)}}};ir=new WeakMap;var Ue,ze,$e,At=class extends Yt{constructor(i,n,a,c=[]){super(c);s(this,Ue,void 0);s(this,ze,void 0);s(this,$e,void 0);u(this,Ue,i),u(this,ze,n),u(this,$e,a)}get adapter(){return t(this,ze)}compileQuery(i){return t(this,Ue).compileQuery(i)}provideConnection(i){return t(this,$e).provideConnection(i)}withPlugins(i){return new At(t(this,Ue),t(this,ze),t(this,$e),[...this.plugins,...i])}withPlugin(i){return new At(t(this,Ue),t(this,ze),t(this,$e),[...this.plugins,i])}withPluginAtFront(i){return new At(t(this,Ue),t(this,ze),t(this,$e),[i,...this.plugins])}withConnectionProvider(i){return new At(t(this,Ue),t(this,ze),i,[...this.plugins])}withoutPlugins(){return new At(t(this,Ue),t(this,ze),t(this,$e),[])}},ao=At;Ue=new WeakMap,ze=new WeakMap,$e=new WeakMap;function fn(){return typeof performance<"u"&&ve(performance.now)?performance.now():Date.now()}var Ee,lt,Ye,St,Yr,ho,us,co,ds,lo,hs,mo,cs,po,ls,uo=class{constructor(e,i){s(this,ho);s(this,co);s(this,lo);s(this,mo);s(this,po);s(this,Ee,void 0);s(this,lt,void 0);s(this,Ye,void 0);s(this,St,void 0);s(this,Yr,new WeakSet);u(this,Ee,e),u(this,lt,i)}async init(){t(this,Ye)||u(this,Ye,t(this,Ee).init().catch(e=>(u(this,Ye,void 0),Promise.reject(e)))),await t(this,Ye)}async acquireConnection(){await this.init();let e=await t(this,Ee).acquireConnection();return t(this,Yr).has(e)||(h(this,ho,us).call(this)&&h(this,co,ds).call(this,e),t(this,Yr).add(e)),e}async releaseConnection(e){await t(this,Ee).releaseConnection(e)}beginTransaction(e,i){return t(this,Ee).beginTransaction(e,i)}commitTransaction(e){return t(this,Ee).commitTransaction(e)}rollbackTransaction(e){return t(this,Ee).rollbackTransaction(e)}async destroy(){!t(this,Ye)||(await t(this,Ye),t(this,St)||u(this,St,t(this,Ee).destroy().catch(e=>(u(this,St,void 0),Promise.reject(e)))),await t(this,St))}};Ee=new WeakMap,lt=new WeakMap,Ye=new WeakMap,St=new WeakMap,Yr=new WeakMap,ho=new WeakSet,us=function(){return t(this,lt).isLevelEnabled("query")||t(this,lt).isLevelEnabled("error")},co=new WeakSet,ds=function(e){let i=e.executeQuery;e.executeQuery=async n=>{let a=fn();try{return await i.call(e,n)}catch(c){throw h(this,lo,hs).call(this,c),c}finally{h(this,mo,cs).call(this,n,a)}}},lo=new WeakSet,hs=function(e){t(this,lt).error(()=>({level:"error",error:e}))},mo=new WeakSet,cs=function(e,i){t(this,lt).query(()=>({level:"query",query:e,queryDurationMillis:h(this,po,ls).call(this,i)}))},po=new WeakSet,ls=function(e){return fn()-e};var Zr,mt,fo,ms,Xr=class{constructor(e){s(this,fo);s(this,Zr,void 0);s(this,mt,void 0);u(this,Zr,e)}async provideConnection(e){for(;t(this,mt);)await t(this,mt);let i=h(this,fo,ms).call(this,e);return u(this,mt,i.then(()=>{u(this,mt,void 0)}).catch(()=>{u(this,mt,void 0)})),i}};Zr=new WeakMap,mt=new WeakMap,fo=new WeakSet,ms=async function(e){return await e(t(this,Zr))};var ps=["read uncommitted","read committed","repeatable read","serializable"];var my=o(["query","error"]),pt,Dt,No=class{constructor(e){s(this,pt,void 0);s(this,Dt,void 0);ve(e)?(u(this,Dt,e),u(this,pt,o({query:!0,error:!0}))):(u(this,Dt,ua),u(this,pt,o({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return t(this,pt)[e]}query(e){t(this,pt).query&&t(this,Dt).call(this,e())}error(e){t(this,pt).error&&t(this,Dt).call(this,e())}};pt=new WeakMap,Dt=new WeakMap;function ua(r){r.level==="query"?(console.log(`kysely:query: ${r.query.sql}`),console.log(`kysely:query: duration: ${r.queryDurationMillis.toFixed(1)}ms`)):r.level==="error"&&(r.error instanceof Error?console.error(`kysely:error: ${r.error.stack??r.error.message}`):console.error(`kysely:error: ${r}`))}var se,_r=class extends er{constructor(i){let n,a;if(da(i))n={executor:i.executor},a={...i};else{let c=i.dialect,b=c.createDriver(),J=c.createQueryCompiler(),yt=c.createAdapter(),Bs=new No(i.log??[]),bn=new uo(b,Bs),Ls=new so(bn),vn=new ao(J,yt,Ls,i.plugins??[]);n={executor:vn},a={config:i,executor:vn,dialect:c,driver:bn}}super(n);s(this,se,void 0);u(this,se,o(a))}get schema(){return new oo(t(this,se).executor)}get dynamic(){return new no}get introspection(){return t(this,se).dialect.createIntrospector(this.withoutPlugins())}get fn(){return new Zt}transaction(){return new wo({...t(this,se)})}connection(){return new yo({...t(this,se)})}withPlugin(i){return new _r({...t(this,se),executor:t(this,se).executor.withPlugin(i)})}withoutPlugins(){return new _r({...t(this,se),executor:t(this,se).executor.withoutPlugins()})}withTables(){return new _r({...t(this,se)})}async destroy(){await t(this,se).driver.destroy()}get isTransaction(){return!1}getExecutor(){return t(this,se).executor}},or=_r;se=new WeakMap;var Xe,ei=class extends or{constructor(i){super(i);s(this,Xe,void 0);u(this,Xe,i)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(i){return new ei({...t(this,Xe),executor:t(this,Xe).executor.withPlugin(i)})}withoutPlugins(){return new ei({...t(this,Xe),executor:t(this,Xe).executor.withoutPlugins()})}withTables(){return new ei({...t(this,Xe)})}},Nn=ei;Xe=new WeakMap;function da(r){return Le(r)&&Le(r.config)&&Le(r.driver)&&Le(r.executor)&&Le(r.dialect)}var Bt,yo=class{constructor(e){s(this,Bt,void 0);u(this,Bt,o(e))}async execute(e){return t(this,Bt).executor.provideConnection(async i=>{let n=t(this,Bt).executor.withConnectionProvider(new Xr(i)),a=new or({...t(this,Bt),executor:n});return await e(a)})}};Bt=new WeakMap;f(yo,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var Ae,yn=class{constructor(e){s(this,Ae,void 0);u(this,Ae,o(e))}setIsolationLevel(e){return new yn({...t(this,Ae),isolationLevel:e})}async execute(e){let{isolationLevel:i,...n}=t(this,Ae),a={isolationLevel:i};return ha(a),t(this,Ae).executor.provideConnection(async c=>{let b=t(this,Ae).executor.withConnectionProvider(new Xr(c)),J=new Nn({...n,executor:b});try{await t(this,Ae).driver.beginTransaction(c,a);let yt=await e(J);return await t(this,Ae).driver.commitTransaction(c),yt}catch(yt){throw await t(this,Ae).driver.rollbackTransaction(c),yt}})}},wo=yn;Ae=new WeakMap;f(wo,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function ha(r){if(r.isolationLevel&&!ps.includes(r.isolationLevel))throw new Error(`invalid transaction isolation level ${r.isolationLevel}`)}var ae=Object.assign((r,...e)=>new Y({queryId:W(),rawNode:q.create(r,(e==null?void 0:e.map(Me))??[])}),{ref(r){return new Y({queryId:W(),rawNode:q.createWithChild(ye(r))})},table(r){return new Y({queryId:W(),rawNode:q.createWithChild(j(r))})},id(...r){let e=new Array(r.length+1).fill(".");return e[0]="",e[e.length-1]="",new Y({queryId:W(),rawNode:q.create(e,r.map(y.create))})},literal(r){return new Y({queryId:W(),rawNode:q.createWithChild(Te.createImmediate(r))})},raw(r){return new Y({queryId:W(),rawNode:q.createWithSql(r)})},join(r,e=ae`, `){let i=new Array(2*r.length-1),n=e.toOperationNode();for(let a=0;a<r.length;++a)i[2*a]=Me(r[a]),a!==r.length-1&&(i[2*a+1]=n);return new Y({queryId:W(),rawNode:q.createWithChildren(i)})}});var go,xo=class{constructor(){Qt(this,"nodeStack",[]);s(this,go,o({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),FilterNode:this.visitFilter.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),UnionNode:this.visitUnion.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this)}));Qt(this,"visitNode",e=>{this.nodeStack.push(e),t(this,go)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}};go=new WeakMap;var nr,Lt,sr=class extends xo{constructor(){super(...arguments);s(this,nr,"");s(this,Lt,[])}get numParameters(){return t(this,Lt).length}compileQuery(i){return u(this,nr,""),u(this,Lt,[]),this.visitNode(i),o({query:i,sql:this.getSql(),parameters:[...t(this,Lt)]})}getSql(){return t(this,nr)}visitSelectQuery(i){let n=this.parentNode!==void 0&&!we.is(this.parentNode)&&!ke.is(this.parentNode)&&!Oi.is(this.parentNode);n&&this.append("("),i.with&&(this.visitNode(i.with),this.append(" ")),this.append("select "),i.distinctOnSelections&&(this.compileDistinctOn(i.distinctOnSelections),this.append(" ")),i.distinct&&(this.append("distinct"),this.append(" ")),i.selections&&(this.compileList(i.selections),this.append(" ")),this.visitNode(i.from),i.joins&&(this.append(" "),this.compileList(i.joins," ")),i.where&&(this.append(" "),this.visitNode(i.where)),i.groupBy&&(this.append(" "),this.visitNode(i.groupBy)),i.having&&(this.append(" "),this.visitNode(i.having)),i.union&&(this.append(" "),this.compileList(i.union," ")),i.orderBy&&(this.append(" "),this.visitNode(i.orderBy)),i.limit&&(this.append(" "),this.visitNode(i.limit)),i.offset&&(this.append(" "),this.visitNode(i.offset)),i.modifiers&&i.modifiers.forEach(a=>{this.append(" "),this.append(ca[a])}),n&&this.append(")")}visitFrom(i){this.append("from "),this.compileList(i.froms)}visitSelection(i){this.visitNode(i.selection)}visitColumn(i){this.visitNode(i.column)}compileDistinctOn(i){this.append("distinct on ("),this.compileList(i),this.append(")")}compileList(i,n=", "){let a=mi(i);for(let c of i)this.visitNode(c),c!==a&&this.append(n)}visitWhere(i){this.append("where "),this.visitNode(i.where)}visitHaving(i){this.append("having "),this.visitNode(i.having)}visitInsertQuery(i){let n=this.nodeStack.find(l.is)!==i;n&&this.append("("),i.with&&(this.visitNode(i.with),this.append(" ")),this.append("insert"),i.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(i.into),i.columns&&(this.append(" ("),this.compileList(i.columns),this.append(")")),i.values&&(this.append(" "),this.visitNode(i.values)),i.onConflict&&(this.append(" "),this.visitNode(i.onConflict)),i.onDuplicateKey&&(this.append(" "),this.visitNode(i.onDuplicateKey)),i.returning&&(this.append(" "),this.visitNode(i.returning)),n&&this.append(")")}visitValues(i){this.append("values "),this.compileList(i.values)}visitDeleteQuery(i){let n=this.nodeStack.find(l.is)!==i;n&&this.append("("),i.with&&(this.visitNode(i.with),this.append(" ")),this.append("delete "),this.visitNode(i.from),i.joins&&(this.append(" "),this.compileList(i.joins," ")),i.where&&(this.append(" "),this.visitNode(i.where)),i.orderBy&&(this.append(" "),this.visitNode(i.orderBy)),i.limit&&(this.append(" "),this.visitNode(i.limit)),i.returning&&(this.append(" "),this.visitNode(i.returning)),n&&this.append(")")}visitReturning(i){this.append("returning "),this.compileList(i.selections)}visitAlias(i){this.visitNode(i.node),this.append(" as "),this.visitNode(i.alias)}visitReference(i){this.visitNode(i.table),this.append("."),this.visitNode(i.column)}visitSelectAll(i){this.append("*")}visitIdentifier(i){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(i),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(i){this.append(i.identifier)}visitFilter(i){i.left&&(this.visitNode(i.left),this.append(" ")),this.visitNode(i.op),this.append(" "),this.visitNode(i.right)}visitAnd(i){this.visitNode(i.left),this.append(" and "),this.visitNode(i.right)}visitOr(i){this.visitNode(i.left),this.append(" or "),this.visitNode(i.right)}visitValue(i){i.immediate?this.appendImmediateValue(i.value):this.appendValue(i.value)}visitValueList(i){this.append("("),this.compileList(i.values),this.append(")")}visitPrimitiveValueList(i){this.append("(");let{values:n}=i;for(let a=0;a<n.length;++a)this.appendValue(n[a]),a!==n.length-1&&this.append(", ");this.append(")")}visitParens(i){this.append("("),this.visitNode(i.node),this.append(")")}visitJoin(i){this.append(la[i.joinType]),this.append(" "),this.visitNode(i.table),i.on&&(this.append(" "),this.visitNode(i.on))}visitOn(i){this.append("on "),this.visitNode(i.on)}visitRaw(i){let{sqlFragments:n,parameters:a}=i;for(let c=0;c<n.length;++c)this.append(n[c]),a.length>c&&this.visitNode(a[c])}visitOperator(i){this.append(i.operator)}visitTable(i){i.schema&&(this.visitNode(i.schema),this.append(".")),this.visitNode(i.table)}visitCreateTable(i){this.append("create "),i.temporary&&this.append("temporary "),this.append("table "),i.ifNotExists&&this.append("if not exists "),this.visitNode(i.table),this.append(" ("),this.compileList([...i.columns,...i.constraints??[]]),this.append(")"),i.onCommit&&(this.append(" on commit "),this.append(i.onCommit))}visitColumnDefinition(i){this.visitNode(i.column),this.append(" "),this.visitNode(i.dataType),i.unsigned&&this.append(" unsigned"),i.generated&&(this.append(" "),this.visitNode(i.generated)),i.defaultTo&&(this.append(" "),this.visitNode(i.defaultTo)),i.notNull&&this.append(" not null"),i.unique&&this.append(" unique"),i.primaryKey&&this.append(" primary key"),i.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),i.references&&(this.append(" "),this.visitNode(i.references)),i.check&&(this.append(" "),this.visitNode(i.check))}getAutoIncrement(){return"auto_increment"}visitReferences(i){this.append("references "),this.visitNode(i.table),this.append(" ("),this.compileList(i.columns),this.append(")"),i.onDelete&&(this.append(" on delete "),this.append(i.onDelete)),i.onUpdate&&(this.append(" on update "),this.append(i.onUpdate))}visitDropTable(i){this.append("drop table "),i.ifExists&&this.append("if exists "),this.visitNode(i.table)}visitDataType(i){this.append(i.dataType)}visitOrderBy(i){this.append("order by "),this.compileList(i.items)}visitOrderByItem(i){this.visitNode(i.orderBy),i.direction&&(this.append(" "),this.visitNode(i.direction))}visitGroupBy(i){this.append("group by "),this.compileList(i.items)}visitGroupByItem(i){this.visitNode(i.groupBy)}visitUpdateQuery(i){let n=this.nodeStack.find(l.is)!==i;n&&this.append("("),i.with&&(this.visitNode(i.with),this.append(" ")),this.append("update "),this.visitNode(i.table),this.append(" set "),i.updates&&this.compileList(i.updates),i.from&&(this.append(" "),this.visitNode(i.from)),i.joins&&(this.append(" "),this.compileList(i.joins," ")),i.where&&(this.append(" "),this.visitNode(i.where)),i.returning&&(this.append(" "),this.visitNode(i.returning)),n&&this.append(")")}visitColumnUpdate(i){this.visitNode(i.column),this.append(" = "),this.visitNode(i.value)}visitLimit(i){this.append("limit "),this.visitNode(i.limit)}visitOffset(i){this.append("offset "),this.visitNode(i.offset)}visitOnConflict(i){this.append("on conflict"),i.columns?(this.append(" ("),this.compileList(i.columns),this.append(")")):i.constraint?(this.append(" on constraint "),this.visitNode(i.constraint)):i.indexExpression&&(this.append(" ("),this.visitNode(i.indexExpression),this.append(")")),i.indexWhere&&(this.append(" "),this.visitNode(i.indexWhere)),i.doNothing===!0?this.append(" do nothing"):i.updates&&(this.append(" do update set "),this.compileList(i.updates),i.updateWhere&&(this.append(" "),this.visitNode(i.updateWhere)))}visitOnDuplicateKey(i){this.append("on duplicate key update "),this.compileList(i.updates)}visitCreateIndex(i){this.append("create "),i.unique&&this.append("unique "),this.append("index "),this.visitNode(i.name),i.table&&(this.append(" on "),this.visitNode(i.table)),i.using&&(this.append(" using "),this.visitNode(i.using)),i.expression&&(this.append(" ("),q.is(i.expression)&&this.append("("),this.visitNode(i.expression),q.is(i.expression)&&this.append(")"),this.append(")"))}visitDropIndex(i){this.append("drop index "),i.ifExists&&this.append("if exists "),this.visitNode(i.name),i.table&&(this.append(" on "),this.visitNode(i.table))}visitCreateSchema(i){this.append("create schema "),i.ifNotExists&&this.append("if not exists "),this.visitNode(i.schema)}visitDropSchema(i){this.append("drop schema "),i.ifExists&&this.append("if exists "),this.visitNode(i.schema)}visitPrimaryKeyConstraint(i){i.name&&(this.append("constraint "),this.visitNode(i.name),this.append(" ")),this.append("primary key ("),this.compileList(i.columns),this.append(")")}visitUniqueConstraint(i){i.name&&(this.append("constraint "),this.visitNode(i.name),this.append(" ")),this.append("unique ("),this.compileList(i.columns),this.append(")")}visitCheckConstraint(i){i.name&&(this.append("constraint "),this.visitNode(i.name),this.append(" ")),this.append("check ("),this.visitNode(i.expression),this.append(")")}visitForeignKeyConstraint(i){i.name&&(this.append("constraint "),this.visitNode(i.name),this.append(" ")),this.append("foreign key ("),this.compileList(i.columns),this.append(") "),this.visitNode(i.references),i.onDelete&&(this.append(" on delete "),this.append(i.onDelete)),i.onUpdate&&(this.append(" on update "),this.append(i.onUpdate))}visitList(i){this.compileList(i.items)}visitWith(i){this.append("with "),i.recursive&&this.append("recursive "),this.compileList(i.expressions)}visitCommonTableExpression(i){this.visitNode(i.name),this.append(" as "),this.visitNode(i.expression)}visitCommonTableExpressionName(i){this.visitNode(i.table),i.columns&&(this.append("("),this.compileList(i.columns),this.append(")"))}visitAlterTable(i){this.append("alter table "),this.visitNode(i.table),this.append(" "),i.renameTo&&(this.append("rename to "),this.visitNode(i.renameTo)),i.setSchema&&(this.append("set schema "),this.visitNode(i.setSchema)),i.addConstraint&&this.visitNode(i.addConstraint),i.dropConstraint&&this.visitNode(i.dropConstraint),i.renameColumn&&this.visitNode(i.renameColumn),i.addColumn&&this.visitNode(i.addColumn),i.dropColumn&&this.visitNode(i.dropColumn),i.alterColumn&&this.visitNode(i.alterColumn),i.modifyColumn&&this.visitNode(i.modifyColumn)}visitAddColumn(i){this.append("add column "),this.visitNode(i.column)}visitRenameColumn(i){this.append("rename column "),this.visitNode(i.column),this.append(" to "),this.visitNode(i.renameTo)}visitDropColumn(i){this.append("drop column "),this.visitNode(i.column)}visitAlterColumn(i){this.append("alter column "),this.visitNode(i.column),this.append(" "),i.dataType&&(this.append("type "),this.visitNode(i.dataType),i.dataTypeExpression&&(this.append("using "),this.visitNode(i.dataTypeExpression))),i.setDefault&&(this.append("set default "),this.visitNode(i.setDefault)),i.dropDefault&&this.append("drop default"),i.setNotNull&&this.append("set not null"),i.dropNotNull&&this.append("drop not null")}visitModifyColumn(i){this.append("modify column "),this.visitNode(i.column)}visitAddConstraint(i){this.append("add "),this.visitNode(i.constraint)}visitDropConstraint(i){this.append("drop constraint "),i.ifExists&&this.append("if exists "),this.visitNode(i.constraintName),i.modifier==="cascade"?this.append(" cascade"):i.modifier==="restrict"&&this.append(" restrict")}visitUnion(i){this.append("union "),i.all&&this.append("all "),this.visitNode(i.union)}visitCreateView(i){this.append("create "),i.orReplace&&this.append("or replace "),i.materialized&&this.append("materialized "),i.temporary&&this.append("temporary "),this.append("view "),i.ifNotExists&&this.append("if not exists "),this.visitNode(i.name),this.append(" "),i.columns&&(this.append("("),this.compileList(i.columns),this.append(") ")),i.as&&(this.append("as "),this.visitNode(i.as))}visitDropView(i){this.append("drop "),i.materialized&&this.append("materialized "),this.append("view "),i.ifExists&&this.append("if exists "),this.visitNode(i.name)}visitGenerated(i){this.append("generated "),i.always&&this.append("always "),i.byDefault&&this.append("by default "),this.append("as "),i.identity&&this.append("identity"),i.expression&&(this.append("("),this.visitNode(i.expression),this.append(")")),i.stored&&this.append(" stored")}visitDefaultValue(i){this.append("default "),this.visitNode(i.defaultValue)}append(i){u(this,nr,t(this,nr)+i)}appendValue(i){this.addParameter(i),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}addParameter(i){t(this,Lt).push(i)}appendImmediateValue(i){if(fe(i))this.append(`'${i}'`);else if(Wn(i)||ci(i))this.append(i.toString());else if(li(i))this.append("null");else if(On(i))this.appendImmediateValue(i.toISOString());else if(qn(i))this.appendImmediateValue(i.toString());else throw new Error(`invalid immediate value ${i}`)}};nr=new WeakMap,Lt=new WeakMap;var ca=o({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked"}),la=o({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"});var ar=class{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}};var Co=class{transformQuery(e){return e.node}async transformResult(e){return e.result}};var ai="kysely_migration",ui="kysely_migration_lock",fs="migration_lock",ma=o({__noMigrations__:!0}),z,Rt,ti,Se,Ze,De,_e,ft,ur,Be,et,bo,ys,vo,ws,To,xs,Wo,gs,Oo,Cs,ii,wn,Nt,dr,oi,xn,qo,bs,Io,vs,ni,gn,ko,Ts,Eo,Ws,Ao,Os,So,qs,Ns=class{constructor(e){s(this,Rt);s(this,Se);s(this,De);s(this,ft);s(this,Be);s(this,bo);s(this,vo);s(this,To);s(this,Wo);s(this,Oo);s(this,ii);s(this,Nt);s(this,oi);s(this,qo);s(this,Io);s(this,ni);s(this,ko);s(this,Eo);s(this,Ao);s(this,So);s(this,z,void 0);u(this,z,o(e))}async getMigrations(){let e=await h(this,Nt,dr).call(this,t(this,De,_e))?await t(this,z).db.withPlugin(t(this,Be,et)).selectFrom(t(this,De,_e)).select(["name","timestamp"]).execute():[];return(await h(this,ni,gn).call(this)).map(({name:n,...a})=>{let c=e.find(b=>b.name===n);return{name:n,migration:a,executedAt:c?new Date(c.timestamp):void 0}})}async migrateToLatest(){return h(this,Rt,ti).call(this,({migrations:e})=>e.length-1)}async migrateTo(e){return h(this,Rt,ti).call(this,({migrations:i})=>{if(e===ma)return-1;let n=i.findIndex(a=>a.name===e);if(n===-1)throw new Error(`migration "${e}" doesn't exist`);return n})}async migrateUp(){return h(this,Rt,ti).call(this,({currentIndex:e,migrations:i})=>Math.min(e+1,i.length-1))}async migrateDown(){return h(this,Rt,ti).call(this,({currentIndex:e})=>Math.max(e-1,-1))}};z=new WeakMap,Rt=new WeakSet,ti=async function(e){try{return await h(this,bo,ys).call(this),await h(this,qo,bs).call(this,e)}catch(i){return i instanceof ri?i.resultSet:{error:i}}},Se=new WeakSet,Ze=function(){return t(this,z).migrationTableSchema},De=new WeakSet,_e=function(){return t(this,z).migrationTableName??ai},ft=new WeakSet,ur=function(){return t(this,z).migrationLockTableName??ui},Be=new WeakSet,et=function(){return t(this,Se,Ze)?new Qe(t(this,Se,Ze)):new Co},bo=new WeakSet,ys=async function(){await h(this,vo,ws).call(this),await h(this,To,xs).call(this),await h(this,Wo,gs).call(this),await h(this,Oo,Cs).call(this)},vo=new WeakSet,ws=async function(){if(!!t(this,Se,Ze)&&!await h(this,ii,wn).call(this))try{await t(this,z).db.schema.createSchema(t(this,Se,Ze)).ifNotExists().execute()}catch(e){if(!await h(this,ii,wn).call(this))throw e}},To=new WeakSet,xs=async function(){if(!await h(this,Nt,dr).call(this,t(this,De,_e)))try{t(this,Se,Ze)&&await t(this,z).db.schema.createSchema(t(this,Se,Ze)).ifNotExists().execute(),await t(this,z).db.schema.withPlugin(t(this,Be,et)).createTable(t(this,De,_e)).ifNotExists().addColumn("name","varchar(255)",e=>e.notNull().primaryKey()).addColumn("timestamp","varchar(255)",e=>e.notNull()).execute()}catch(e){if(!await h(this,Nt,dr).call(this,t(this,De,_e)))throw e}},Wo=new WeakSet,gs=async function(){if(!await h(this,Nt,dr).call(this,t(this,ft,ur)))try{await t(this,z).db.schema.withPlugin(t(this,Be,et)).createTable(t(this,ft,ur)).ifNotExists().addColumn("id","varchar(255)",e=>e.notNull().primaryKey()).addColumn("is_locked","integer",e=>e.notNull().defaultTo(0)).execute()}catch(e){if(!await h(this,Nt,dr).call(this,t(this,ft,ur)))throw e}},Oo=new WeakSet,Cs=async function(){if(!await h(this,oi,xn).call(this))try{await t(this,z).db.withPlugin(t(this,Be,et)).insertInto(t(this,ft,ur)).values({id:fs,is_locked:0}).execute()}catch(e){if(!await h(this,oi,xn).call(this))throw e}},ii=new WeakSet,wn=async function(){return(await t(this,z).db.introspection.getSchemas()).some(i=>i.name===t(this,Se,Ze))},Nt=new WeakSet,dr=async function(e){let i=t(this,Se,Ze);return(await t(this,z).db.introspection.getTables({withInternalKyselyTables:!0})).some(a=>a.name===e&&(!i||a.schema===i))},oi=new WeakSet,xn=async function(){return!!await t(this,z).db.withPlugin(t(this,Be,et)).selectFrom(t(this,ft,ur)).where("id","=",fs).select("id").executeTakeFirst()},qo=new WeakSet,bs=async function(e){let i=t(this,z).db.getExecutor().adapter,n=async a=>{try{await i.acquireMigrationLock(a);let c=await h(this,Io,vs).call(this,a);if(c.migrations.length===0)return{results:[]};let b=e(c);return b===void 0?{results:[]}:b<c.currentIndex?await h(this,Ao,Os).call(this,a,c,b):b>c.currentIndex?await h(this,So,qs).call(this,a,c,b):{results:[]}}finally{await i.releaseMigrationLock(a)}};return i.supportsTransactionalDdl?t(this,z).db.transaction().execute(n):t(this,z).db.connection().execute(n)},Io=new WeakSet,vs=async function(e){let i=await h(this,ni,gn).call(this),n=await h(this,ko,Ts).call(this,e);return h(this,Eo,Ws).call(this,i,n),o({migrations:i,currentIndex:i.findIndex(a=>a.name===mi(n))})},ni=new WeakSet,gn=async function(){let e=await t(this,z).provider.getMigrations();return Object.keys(e).sort().map(i=>({...e[i],name:i}))},ko=new WeakSet,Ts=async function(e){return(await e.withPlugin(t(this,Be,et)).selectFrom(t(this,De,_e)).select("name").orderBy("name").execute()).map(n=>n.name)},Eo=new WeakSet,Ws=function(e,i){for(let n of i)if(!e.some(a=>a.name===n))throw new Error(`corrupted migrations: previously executed migration ${n} is missing`);for(let n=0;n<i.length;++n)if(e[n].name!==i[n])throw new Error(`corrupted migrations: expected previously executed migration ${i[n]} to be at index ${n} but ${e[n].name} was found in its place. New migrations must always have a name that comes alphabetically after the last executed migration.`)},Ao=new WeakSet,Os=async function(e,i,n){let a=[];for(let c=i.currentIndex;c>n;--c)a.push({migrationName:i.migrations[c].name,direction:"Down",status:"NotExecuted"});for(let c=0;c<a.length;++c){let b=i.migrations.find(J=>J.name===a[c].migrationName);try{b.down&&(await b.down(e),await e.withPlugin(t(this,Be,et)).deleteFrom(t(this,De,_e)).where("name","=",b.name).execute(),a[c]={migrationName:b.name,direction:"Down",status:"Success"})}catch(J){throw a[c]={migrationName:b.name,direction:"Down",status:"Error"},new ri({error:J,results:a})}}return{results:a}},So=new WeakSet,qs=async function(e,i,n){let a=[];for(let c=i.currentIndex+1;c<=n;++c)a.push({migrationName:i.migrations[c].name,direction:"Up",status:"NotExecuted"});for(let c=0;c<a.length;++c){let b=i.migrations.find(J=>J.name===a[c].migrationName);try{await b.up(e),await e.withPlugin(t(this,Be,et)).insertInto(t(this,De,_e)).values({name:b.name,timestamp:new Date().toISOString()}).execute(),a[c]={migrationName:b.name,direction:"Up",status:"Success"}}catch(J){throw a[c]={migrationName:b.name,direction:"Up",status:"Error"},new ri({error:J,results:a})}}return{results:a}};var si,ri=class extends Error{constructor(i){super();s(this,si,void 0);u(this,si,i)}get resultSet(){return t(this,si)}};si=new WeakMap;var Do=class extends sr{getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}};var Ft,Lo,Is,Bo=class{constructor(e){s(this,Lo);s(this,Ft,void 0);u(this,Ft,e)}async getSchemas(){return(await t(this,Ft).selectFrom("pg_catalog.pg_namespace").select("nspname").castTo().execute()).map(i=>({name:i.nspname}))}async getTables(e={withInternalKyselyTables:!1}){let i=t(this,Ft).selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_tables as t","t.tablename","c.relname").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","t.tablename as table","t.schemaname as schema","typ.typname as type",t(this,Ft).selectFrom("pg_class").select(ae`true`.as("auto_incrementing")).where("relkind","=","S").where("relname","=",ae`t.tablename || '_' || a.attname || '_seq'`).as("auto_incrementing")]).where("t.schemaname","!~","^pg_").where("t.schemaname","!=","information_schema").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).castTo();e.withInternalKyselyTables||(i=i.where("t.tablename","!=",ai).where("t.tablename","!=",ui));let n=await i.execute();return h(this,Lo,Is).call(this,n)}async getMetadata(e){return{tables:await this.getTables(e)}}};Ft=new WeakMap,Lo=new WeakSet,Is=function(e){return e.reduce((i,n)=>{let a=i.find(c=>c.name===n.table&&c.schema===n.schema);return a||(a=o({name:n.table,schema:n.schema,columns:[]}),i.push(a)),a.columns.push(o({name:n.column,dataType:n.type,isNullable:!n.not_null,isAutoIncrementing:!!n.auto_incrementing,hasDefaultValue:n.has_default})),i},[])};var pa=3853314791062309107n,Ro=class extends ar{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(e){await ae`select pg_advisory_xact_lock(${ae.literal(pa)})`.execute(e)}async releaseMigrationLock(){}};var Fo=class extends sr{getCurrentParameterPlaceholder(){return"?"}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}};var hr,Vo,ks,Qo=class{constructor(e){s(this,Vo);s(this,hr,void 0);u(this,hr,e)}async getSchemas(){return(await t(this,hr).selectFrom("information_schema.schemata").select("schema_name").castTo().execute()).map(i=>({name:i.SCHEMA_NAME}))}async getTables(e={withInternalKyselyTables:!1}){let i=t(this,hr).selectFrom("information_schema.columns").select(["column_name","column_default","table_name","table_schema","is_nullable","data_type","extra"]).where("table_schema","=",ae`database()`).castTo();e.withInternalKyselyTables||(i=i.where("table_name","!=",ai).where("table_name","!=",ui));let n=await i.execute();return h(this,Vo,ks).call(this,n)}async getMetadata(e){return{tables:await this.getTables(e)}}};hr=new WeakMap,Vo=new WeakSet,ks=function(e){return e.reduce((i,n)=>{let a=i.find(c=>c.name===n.TABLE_NAME);return a||(a=o({name:n.TABLE_NAME,schema:n.TABLE_SCHEMA,columns:[]}),i.push(a)),a.columns.push(o({name:n.COLUMN_NAME,dataType:n.DATA_TYPE,isNullable:n.IS_NULLABLE==="YES",isAutoIncrementing:n.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:n.COLUMN_DEFAULT!==null})),i},[])};var Es="ea586330-2c93-47c8-908d-981d9d270f9d",fa=60*60,Po=class extends ar{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(e){await ae`select get_lock(${ae.literal(Es)}, ${ae.literal(fa)})`.execute(e)}async releaseMigrationLock(e){await ae`select release_lock(${ae.literal(Es)})`.execute(e)}};var di,Uo=class{constructor(e){s(this,di,void 0);u(this,di,e)}async init(){}async acquireConnection(){return new Cn(t(this,di))}async beginTransaction(e){await e.beginTransaction()}async commitTransaction(e){await e.commitTransaction()}async rollbackTransaction(e){await e.rollbackTransaction()}async releaseConnection(e){}async destroy(){}};di=new WeakMap;var H,tt,Cn=class{constructor(e){s(this,H,void 0);s(this,tt,void 0);u(this,H,e)}async beginTransaction(){let e=await t(this,H).client.beginTransaction({secretArn:t(this,H).secretArn,resourceArn:t(this,H).resourceArn,database:t(this,H).database}).promise();u(this,tt,e.transactionId)}async commitTransaction(){if(!t(this,tt))throw new Error("Cannot commit a transaction before creating it");await t(this,H).client.commitTransaction({secretArn:t(this,H).secretArn,resourceArn:t(this,H).resourceArn,transactionId:t(this,tt)}).promise()}async rollbackTransaction(){if(!t(this,tt))throw new Error("Cannot rollback a transaction before creating it");await t(this,H).client.rollbackTransaction({secretArn:t(this,H).secretArn,resourceArn:t(this,H).resourceArn,transactionId:t(this,tt)}).promise()}async executeQuery(e){var c;let i=await t(this,H).client.executeStatement({transactionId:t(this,tt),secretArn:t(this,H).secretArn,resourceArn:t(this,H).resourceArn,sql:e.sql,parameters:e.parameters,database:t(this,H).database,includeResultMetadata:!0}).promise();return i.columnMetadata?{rows:((c=i.records)==null?void 0:c.filter(b=>b.length!==0).map(b=>Object.fromEntries(b.map((J,yt)=>[i.columnMetadata[yt].name,J.stringValue??J.blobValue??J.longValue??J.arrayValue??J.doubleValue??(J.isNull?null:J.booleanValue)]))))||[]}:{numUpdatedOrDeletedRows:BigInt(i.numberOfRecordsUpdated||0),rows:[]}}};H=new WeakMap,tt=new WeakMap;var zo=class extends Do{appendValue(e){let i=this.numParameters;this.append(this.getCurrentParameterPlaceholder()),this.addParameter({name:i.toString(),value:As(e)})}getCurrentParameterPlaceholder(){return":"+this.numParameters}},Jo=class extends Fo{appendValue(e){let i=this.numParameters;this.append(this.getCurrentParameterPlaceholder()),this.addParameter({name:i.toString(),value:As(e)})}getCurrentParameterPlaceholder(){return":"+this.numParameters}};function As(r){if(r==null)return{isNull:!0};switch(typeof r){case"number":return Number.isInteger(r)?{longValue:r}:{doubleValue:r};case"bigint":return{doubleValue:Number(r)};case"string":return{stringValue:r};case"boolean":return{booleanValue:r};case"object":if(Buffer.isBuffer(r))return{blobValue:r};break}throw"wtf"}var pe,Ko=class{constructor(e){s(this,pe,void 0);u(this,pe,e)}createAdapter(){if(t(this,pe).mode==="postgres")return new Ro;if(t(this,pe).mode==="mysql")return new Po;throw new Error("Unknown mode "+t(this,pe).mode)}createDriver(){return new Uo(t(this,pe).driver)}createQueryCompiler(){if(t(this,pe).mode==="postgres")return new zo;if(t(this,pe).mode==="mysql")return new Jo;throw new Error("Unknown mode "+t(this,pe).mode)}createIntrospector(e){if(t(this,pe).mode==="postgres")return new Bo(e);if(t(this,pe).mode==="mysql")return new Qo(e);throw new Error("Unknown mode "+t(this,pe).mode)}};pe=new WeakMap;var Na=new or({dialect:new Ko({mode:"postgres",driver:{secretArn:process.env.RDS_SECRET_ARN,resourceArn:process.env.RDS_ARN,database:process.env.RDS_DATABASE,client:new Ss.default}})});var Ds="todos";async function ya(r){let[e]=await cr.DB.insertInto(Ds).values({id:r.id,name:r.name,description:r.description}).returningAll().execute();return e}async function wa(){return await cr.DB.selectFrom(Ds).selectAll().execute()}async function xa(){return{statusCode:200,body:JSON.stringify(await hi.list())}}0&&(module.exports={main});
